<div style="color:blue" align=center>java工程积累——saas之multitenancy解析</div><br><div id="article_content" class="article_content tracking-ad" data-mod="popu_307" data-dsm="post">

<p><span style="font-family:SimSun; font-size:18px">&nbsp; &nbsp; &nbsp; &nbsp; 最近做的项目涉及到比较深入的一部分，就是定义客户关系，在我们的商讨中，我们决定，采用服务商的模式，就是我们是基础服务商，由客户组合服务，向客户提供基于云端的服务支持！这就自然引出了以下概念：</span></p>
<p><span style="font-family:SimSun; font-size:18px"><br>
</span></p>
<p>
<h1><span style="font-family:SimSun; font-size:18px">saas百科：&nbsp;</span></h1>
<span style="font-family:SimSun; font-size:18px">&nbsp; &nbsp; &nbsp; &nbsp; SaaS是Software-as-a-Service（软件即服务）的简称，随着互联网技术的发展和应用软件的成熟， 在21世纪开始兴起的一种完全创新的软件应用模式。它与“on-demand software”（按需软件)，the application service provider(ASP，应用服务提供商)，hosted software(托管软件)所具有相&#20284;的含义。它是一种通过Internet提供软件的模式，厂商将应用软件统一部署在自己的服务器上，客户可以根据自己实际需求，通过互联网向厂商定购所需的应用软件服务，按定购的服务多少和时间长短向厂商支付费用，并通过互联网获得厂商提供的服务。用户不用再购买软件，而改用向提供商租用基于Web的软件，来管理企业经营活动，且无需对软件进行维护，服务提供商会全权管理和维护软件，软件厂商在向客户提供互联网应用的同时，也提供软件的离线操作和本地数据存储，让用户随时随地都可以使用其定购的软件和服务。对于许多小型企业来说，SaaS是采用先进技术的最好途径，它消除了企业购买、构建和维护基础设施和应用程序的需要。<br>
</span>
<p>
<p><span style="font-family:SimSun; font-size:18px"><br>
</span></p>
<p><span style="font-family:SimSun; font-size:18px">那么，问题来了，怎么针对不同的用户提供一种高效，安全的基础数据服务呢？本着我们想到的问题，肯定有人遇到过的原则，我们搜索到了一个解决方案：</span></p>
<p><span style="font-family:SimSun; font-size:18px"><br>
</span></p>
<h1><span style="font-family:SimSun; font-size:18px">多租户（multi-tenancy）</span></h1>
<p><span style="font-family:SimSun; font-size:18px">　　意指在其中一个应用程序的运行实例同时服务多个客户端(租户)体系结构。这是非常常见的SaaS解决方案。</span></p>
<p><span style="font-family:SimSun; font-size:18px"><br>
</span></p>
<p><span style="font-family:SimSun; font-size:18px">关于多租户的实现，大概有三种：“N个租户N个数据库”，“N个租户1个数据库N个Schema”，“N个租租户1个数据库1个Schema”</span></p>
<h2><span style="font-family:SimSun; font-size:18px"><br>
1.分离数据库(Separate Databases)</span></h2>
<p><span style="font-family:SimSun; font-size:18px">“N个租户N个数据库”</span></p>
<span style="font-family:SimSun; font-size:18px">每个租户的数据保存在一个物理上独立的数据库实例。JDBC连接会特别指出每个数据库。一个通用的应用程序的方法是定义一个JDBC连接池,当前登录的用户关联的&quot;租客标识符&quot;来选择JDBC连接.<br>
好处:可以轻松地扩展应用程序的数据模型(稍后讨论)以满足住户的个别需求，而且在失败时从备份恢复租客的数据是一个相对简单的过程。<br>
坏处:导致更高的设备成本，以及维护和备份租客数据方面的成本。<br>
相对较高的硬件,维护成本使它适合于愿意额外支付增加的安全性和可定制性的客户。例如，在银行或医疗记录管理等领域的客户往往有很强的数据隔离的要求，甚至不得不不为每个租客提供具有其自己单独的数据库。<br>
<br>
<br>
</span>
<h2><span style="font-family:SimSun; font-size:18px">2.共享数据库，彼此独立的Schema(Shared Database, Separate Schemas)</span></h2>
<span style="font-family:SimSun; font-size:18px">“N个租户1个数据库N个Schema”<br>
每个租客有它自己的表,可以理解为为每个租客分表.每个租客在共享的数据库中具有其自己单独的一组表.当客户第一次订阅该服务时，资源调配子系统为租客创建一组离散的表，并将它与租客的Schema关联。您可以使用 SQL 创建命令创建一个架构，并授权用户帐户来访问它。应用程序然后可以创建和访问表内的租户的架构使用SchemaName.TableName公约：<br>
CREATE TABLE ContosoSchema.Resumes (EmployeeID int identity primary key,Resume nvarchar(MAX));<br>
创建Schema后，它是作为租客帐户的默认Schema设置：<br>
ALTER USER Contoso WITH DEFAULT_SCHEMA = ContosoSchema<br>
租客帐户可以访问其默认架构内的表，只是通过指定TableName，而不是使用SchemaName.TableName.这种方式，一组 SQL 语句可以给所有的租客使用来访问其自己的数据,例如：SELECT * FROM Resumes<br>
<br>
</span>
<p><span style="font-family:SimSun; font-size:18px">优点:</span></p>
<p><span style="font-family:SimSun; font-size:18px">&nbsp; &nbsp; &nbsp; &nbsp; 这样是容易实现的一种方法,租户可以与单独的数据库方法一样扩展数据模型。(创建的表但一旦不符合需求,租客可添加,修改表)</span></p>
<span style="font-family:SimSun; font-size:18px">&nbsp; &nbsp; &nbsp; &nbsp; 这种方法提供了中等程度的逻辑数据隔离安全，虽然比不上作为一个完全独立的数据库，但却可以在每个数据库服务器支持大量的租户。<br>
</span>
<p><span style="font-family:SimSun; font-size:18px">缺点:</span></p>
<p><span style="font-family:SimSun; font-size:18px">&nbsp; &nbsp; &nbsp; &nbsp; 数据出现故障时是难以恢复某租客。如果每个租客有其自己的数据库，则还原单个租户的数据意味着简单地从最近的备份还原数据库。而这个方法则意味着用备份的数据还原整个数据库，而不管在同一数据库上的每个租客的数据是否遭到损失。因此，要还原单个客户的数据，数据库管理员可能需要将数据库还原到一个临时的服务器，然后将客户的表导入到生产服务器上 — — 一个复杂和可能很耗时的任务。</span></p>
<span style="font-family:SimSun; font-size:18px"><br>
<br>
</span>
<h2><span style="font-family:SimSun; font-size:18px">3.共享数据库，共享Schema(Shared Database, Shared Schema)</span></h2>
<span style="font-family:SimSun; font-size:18px">“N个租租户1个数据库1个Schema”<br>
这个方法就是最简单的一种了.每个表使用租客的一个标识符.所有租户都共享一组相同的表，一个租客 标识符ID 将每个租客与它拥有的行相关联.<br>
</span>
<p><span style="font-family:SimSun; font-size:18px">优点:</span></p>
<p><span style="font-family:SimSun; font-size:18px">&nbsp; &nbsp; &nbsp; &nbsp; 最低硬件和备份成本，因为它允许每个数据库服务器服务更多的租户。然而，因为多个租户共享相同的数据库表，这种方法可能会导致安全问题，你必须努力确保租户始终不能访问其他租户的数据，即使在发生意外。</span></p>
<p><span style="font-family:SimSun; font-size:18px">缺点:</span></p>
<p><span style="font-family:SimSun; font-size:18px">&nbsp; &nbsp; &nbsp; &nbsp; 对于租客还原数据的过程是类&#20284;于共享架构方法，要重新插入临时数据库单个行到生产数据库中。如果有非常大量的受影响的表中的行，这可能导致性能明显降低数据库服务的所有住户。共享架构方法能够用少量的服务器，服务一大批租户和潜在客户,如果他们愿意用更低的费用获取安全性.</span></p>
<p><span style="font-family:SimSun; font-size:18px">每次CRUD都需要使用对应租客 标识符ID.SQL变得复杂.</span></p>
<p><span style="font-family:SimSun; font-size:18px"><br>
</span></p>
<h1><span style="font-family:SimSun; font-size:18px">总结：</span></h1>
<p><span style="font-family:SimSun; font-size:18px">&nbsp; &nbsp; &nbsp; &nbsp; SaaS的概念在很久以前，是我们通过部署N个程序来完成的为多个用户服务，但是在咱们程序的维护上，增加了太多的成本，本着硬件能解决的问题，软件都能解决，有了这个概念，实际这不是全新的概念，而是为了解决一组问题而提出的解决方案！今天咱们充足了弹药，在下一篇博客，咱们一起将它实现吧！</span></p>
   
</div><div class="ArcitleLink"><a href='http://blog.csdn.net/xvshu/article/details/44758119'>原文链接</a>