<div class="articleLocationOnion"><a href='../../index.html'>首页: </a> &gt; <a href='../index_s.html'>未分类</a> &gt; lucene4103入门</div><div style="color:blue" align=center>lucene4103入门</div><br><div id="article_content" class="article_content tracking-ad" data-mod="popu_307" data-dsm="post">

<p style="margin:0in; line-height:20pt; font-family:SimSun; font-size:12.0pt; color:#333333">
<span style="background:#FEFEFE">最近在研究搜索殷勤的全文索引，刚刚有了点眉目，发现还是很实用的，这里放出入门秘籍，大家一起分享！</span></p>
<h1 style="margin:0in; line-height:20pt; font-family:SimSun; font-size:12.0pt; color:#333333">
<span style="background:#FEFEFE">一，Lucene 简介</span></h1>
<p style="margin:0in; line-height:20pt; font-family:SimSun; font-size:12.0pt; color:#333333">
<span style="background:#FEFEFE">&nbsp; &nbsp; Lucene 是一个基于 Java 的全文信息检索工具包，它不是一个完整的搜索应用程序，而是为你的应用程序提供索引和搜索功能。Lucene 目前是 Apache Jakarta 家族中的一个开源项目。也是目前最为流行的基于 Java 开源全文检索工具包。<br>
&nbsp; &nbsp; 目前已经有很多应用程序的搜索功能是基于 Lucene 的，比如 Eclipse 的帮助系统的搜索功能。Lucene 能够为文本类型的数据建立索引，所以你只要能把你要索引的数据&#26684;式转化的文本的，Lucene 就能对你的文档进行索引和搜索。比如你要对一些 HTML 文档，PDF 文档进行索引的话你就首先需要把 HTML 文档和 PDF 文档转化成文本&#26684;式的，然后将转化后的内容交给 Lucene 进行索引，然后把创建好的索引文件保存到磁盘或者内存中，最后根据用户输入的查询条件在索引文件上进行查询。不指定要索引的文档的&#26684;式也使
 Lucene 能够几乎适用于所有的搜索应用程序。<br>
</span></p>
<p style="margin:0in; line-height:20pt; font-family:SimSun; font-size:12.0pt; color:#333333">
<span style="background:#FEFEFE">我们先看看官方的架构图：</span></p>
<p style="margin:0in; line-height:20pt; font-family:SimSun; font-size:12.0pt; color:#333333">
<span style="background:#FEFEFE">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;<img src="34393056848980" alt="" style="color:rgb(51,51,51); font-family:SimSun; font-size:16px; line-height:26.66666603088379px"><br>
</span></p>
<h1 style="margin:0in; line-height:20pt; font-family:SimSun; font-size:12.0pt; color:#333333">
<span style="background:#FEFEFE">二，官网demo</span></h1>
<p style="margin:0in; line-height:20pt; font-family:SimSun; font-size:12.0pt; color:#333333">
<span style="background:#FEFEFE">1、首先到官网下载lucene-4.10.3.zip</span></p>
<p style="margin:0in; line-height:20pt; font-family:SimSun; font-size:12.0pt; color:#333333">
<span style="background:#FEFEFE">&nbsp; &nbsp;官方网址：http://lucene.apache.org/<br>
</span></p>
<p style="margin:0in; line-height:20pt; font-family:SimSun; font-size:12.0pt; color:#333333">
<span style="background:#FEFEFE">2、解压zip包，其中有一个demo有一个是lucene-xml-query-demo.war可以放到tomcat 安装目录的webapps中</span></p>
<p style="margin:0in; line-height:20pt; font-family:SimSun; font-size:12.0pt; color:#333333">
<span style="background:#FEFEFE">3、将tomcat服务器开启输入localhost:8080/lucene-xml-query-demo将会出现界面但是点击查询会报java.lang.ClassNotFoundException:org.apache.lucene.xmlparser.webdemo.FormBasedXmlQueryDemo这个错误。这个原因是新版本中FormBasedXmlQueryDemo的路径</span></p>
<p style="margin:0in; line-height:20pt; font-family:SimSun; font-size:12.0pt; color:#333333">
<span style="background:#FEFEFE">变了，这时你就需要到该项目的web.xml中将&nbsp;&lt;servlet-class&gt;&nbsp;org.apache.lucene.xmlparser.webdemo.FormBasedXmlQueryDemo&nbsp;&lt;/servlet-class&gt;</span></p>
<p style="margin:0in; line-height:20pt; font-family:SimSun; font-size:12.0pt; color:#333333">
<span style="background:#FEFEFE">更改为&nbsp;&lt;servlet-class&gt;org.apache.lucene.demo.xmlparser.FormBasedXmlQueryDemo&lt;/servlet-class&gt;</span></p>
<p style="margin:0in; line-height:20pt; font-family:SimSun; font-size:12.0pt; color:#333333">
<span style="background:#FEFEFE">然后把lucene-4.1.0解压包下&nbsp;analysis\common\lucene-analyzers-common-4.10.2.jar和&nbsp;sandbox\lucene-sandbox-4.10.2.jar</span></p>
<p style="margin:0in; line-height:20pt; font-family:SimSun; font-size:12.0pt; color:#333333">
<span style="background:#FEFEFE">这两个文件拷贝到WEB-INF\lib文件夹下面，这时在点击查询就不会出现问题了输入java查询结果如下</span></p>
<p style="margin:0in">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;<img src="20186837594700" alt=""><br>
</p>
<h1 style="margin:0in; line-height:20pt; font-family:SimSun; font-size:12.0pt; color:#333333">
<span style="background:#FEFEFE">三、简单实现</span></h1>
<p style="margin:0in; line-height:20pt; font-family:SimSun; font-size:12.0pt; color:#333333">
<span style="background:#FEFEFE">lucene基本工作原理简单可以理解为创建索引，而根据索引查询</span></p>
<p style="margin:0in; line-height:20pt; font-family:SimSun; font-size:12.0pt; color:#333333">
<span style="background:#FEFEFE">下面是简单的例子</span></p>
<p style="margin:0in; line-height:20pt; font-family:SimSun; font-size:12.0pt; color:#333333">
<span style="background:#FEFEFE">TxtFileInderxer作用是将D:/luceneData中所有的.txt文件建立索引并将所有的索引存放在D:/luceneIndex中</span></p>
<p style="margin:0in; line-height:20pt; font-family:SimSun; font-size:12.0pt; color:#333333">
<span style="background:#FEFEFE"></span><pre code_snippet_id="594532" snippet_file_name="blog_20150131_1_8865991" name="code" class="java">package org.com.test;

import java.io.File;
import java.io.FileReader;
import java.io.Reader;
import java.util.Date;

import org.apache.lucene.analysis.Analyzer;
import org.apache.lucene.analysis.standard.StandardAnalyzer;
import org.apache.lucene.document.Document;
import org.apache.lucene.document.Field.Store;
import org.apache.lucene.document.TextField;
import org.apache.lucene.index.IndexWriter;
import org.apache.lucene.index.IndexWriterConfig;
import org.apache.lucene.store.FSDirectory;
import org.apache.lucene.util.Version;

public class TxtFileIndexer {

	public static void main(String[] args) throws Exception {
		// indexDir is the directory that hosts Lucene&#39;s index files
		File indexDir = new File(&quot;D:\\luceneIndex&quot;);
		// dataDir is the directory that hosts the text files that to be indexed
		File dataDir = new File(&quot;D:\\luceneData&quot;);
		// Analyzer luceneAnalyzer = new
		// StandardAnalyzer(Version.LUCENE_4_10_2);
		// 对文档进行分词
		Analyzer luceneAnalyzer = new StandardAnalyzer();
		File[] dataFiles = dataDir.listFiles();
		IndexWriterConfig indexWriterConfig = new IndexWriterConfig(
				Version.LUCENE_4_10_3, luceneAnalyzer);
		// 创建索引
		IndexWriter indexWriter = new IndexWriter(FSDirectory.open(indexDir),
				indexWriterConfig);
		// IndexWriter indexWriter = new IndexWriter(indexDir, luceneAnalyzer,
		// true);
		long startTime = new Date().getTime();
		for (int i = 0; i &lt; dataFiles.length; i++) {
			if (dataFiles[i].isFile()
					&amp;&amp; dataFiles[i].getName().endsWith(&quot;.txt&quot;)) {
				System.out.println(&quot;Indexing file &quot;
						+ dataFiles[i].getCanonicalPath());
				// 封装document对象
				Document document = new Document();
				Reader txtReader = new FileReader(dataFiles[i]);
				document.add(new TextField(&quot;path&quot;, dataFiles[i]
						.getCanonicalPath(), Store.YES));
				// document.add(Field.Text(&quot;contents&quot;, txtReader));
				document.add(new TextField(&quot;contents&quot;, txtReader));
				indexWriter.addDocument(document);
			}
		}
		indexWriter.commit();
		// indexWriter.optimize();
		indexWriter.close();
		long endTime = new Date().getTime();
		System.out.println(&quot;It takes &quot; + (endTime - startTime)
				+ &quot; milliseconds to create index for the files in directory &quot;
				+ dataDir.getPath());
	}

}
</pre><br>
<br>
</p>
<p style="margin:0in; font-family:Calibri; font-size:10.5pt"><br>
<br>
</p>
<p style="margin:0in; line-height:20pt; font-family:SimSun; font-size:12.0pt; color:#333333">
&nbsp;</p>
<p style="margin:0in; line-height:20pt; font-family:SimSun; font-size:12.0pt; color:#333333">
<span style="background:#FEFEFE">TxtFileSearcher作用是从D:/luceneIndex中读取索引并查询.txt文件中含有lucene的文件</span></p>
<p style="margin:0in; line-height:20pt; font-family:SimSun; font-size:12.0pt; color:#333333">
<span style="background:#FEFEFE"></span><pre code_snippet_id="594532" snippet_file_name="blog_20150131_2_6583947" name="code" class="java">package org.com.test;

import java.io.File;
import org.apache.lucene.document.Document;
import org.apache.lucene.index.IndexReader;
import org.apache.lucene.index.Term;
import org.apache.lucene.search.IndexSearcher;
import org.apache.lucene.search.ScoreDoc;
import org.apache.lucene.search.TermQuery;
import org.apache.lucene.search.TopDocs;
import org.apache.lucene.store.Directory;
import org.apache.lucene.store.FSDirectory;

public class TxtFileSearcher {
	public static void main(String[] args) throws Exception {
		String queryStr = &quot;java&quot;;
		// This is the directory that hosts the Lucene index
		File indexDir = new File(&quot;D:\\luceneIndex&quot;);
		Directory directory = FSDirectory.open(indexDir);
		// FSDirectory fsDirectory = FSDirectory.open(indexDir);
		IndexReader indexReader = IndexReader.open(directory);
		// FSDirectory directory = FSDirectory.getDirectory(indexDir,false);
		// IndexReader indexReader = IndexReader.open(fsDirectory);
		IndexSearcher indexSearcher = new IndexSearcher(indexReader);
		// IndexSearcher searcher = new IndexSearcher(indexReader);
		if (!indexDir.exists()) {
			System.out.println(&quot;The Lucene index is not exist&quot;);
			return;
		}
		Term term = new Term(&quot;contents&quot;, queryStr.toLowerCase());
		TermQuery luceneQuery = new TermQuery(term);
		// Hits hits = searcher.search(luceneQuery);
		TopDocs topDocs = indexSearcher.search(luceneQuery, 1000);
		ScoreDoc[] scoreDocs = topDocs.scoreDocs;
		if (scoreDocs == null || scoreDocs.length == 0) {
			System.out.println(&quot;The  Lucene index is not exist&quot;);
		}
		for (int i = 0; i &lt; scoreDocs.length; i++) {
			Document document = indexSearcher.doc(scoreDocs[i].doc);
			System.out.println(&quot;File: &quot; + document.get(&quot;path&quot;));
		}
		indexReader.close();
	}
}
</pre><br>
执行结果如下：</p>
<p style="margin:0in; line-height:20pt; font-family:SimSun; font-size:12.0pt; color:#333333">
<span style="background:#FEFEFE">以&quot;D:\\luceneData&quot;为数据源建立索引：</span></p>
<p style="margin:0in; line-height:20pt; font-family:SimSun; font-size:12.0pt; color:#333333">
<span style="background:#FEFEFE"><img src="20133910110531" alt=""><br>
</span></p>
<p style="margin:0in; line-height:20pt; font-family:SimSun; font-size:12.0pt; color:#333333">
<span style="background:#FEFEFE">按“java”为关键字搜索结果：</span></p>
<p style="margin:0in; line-height:20pt; font-family:SimSun; font-size:12.0pt; color:#333333">
<span style="background:#FEFEFE"><img src="9252629048851" alt=""><br>
</span></p>
<p style="margin:0in; line-height:20pt; font-family:SimSun; font-size:12.0pt; color:#333333">
<br>
</p>
<h1 style="margin:0in; line-height:20pt; font-family:SimSun; font-size:12.0pt; color:#333333">
总结：</h1>
<p style="margin:0in; line-height:20pt; font-family:SimSun; font-size:12.0pt; color:#333333">
&nbsp; &nbsp; 在我们的逐渐成熟，走向大牛的技术生涯中，一直有一个现象，我们愁眉不展研究了N个日日夜夜的结果，某牛分分钟就找到的一个jar包实现了我们的功能，而且比较完善，每每遇到这个现象，我就会想起<span style="color:rgb(51,51,51); font-family:arial,宋体,sans-serif; font-size:14px; line-height:24px; text-indent:28px">《荀子·劝学》中的名句：</span></p>
<p style="text-indent:28px; margin:0in; color:rgb(51,51,51)"><span style="font-family:arial,宋体,sans-serif"><span style="font-size:14px; line-height:24px">吾尝终日而思矣，不如须臾之所学也；吾尝跂而望矣，不如登高之博见也。登高而招，臂非加长也，而见者远；顺风而呼，声非加疾也，而闻者彰。假舆马者，非利足也，而致千里；假舟楫者，非能水也，而绝江河。君子生非异也，善假于物也。</span></span></p>
<p style="text-indent:28px; margin:0in; color:rgb(51,51,51)"><span style="font-family:arial,宋体,sans-serif"><span style="font-size:14px; line-height:24px">千年前的古人，已经教育我们，作为君子，应该学习站在巨人的肩膀上，人类发明文字，就是为了后人可以继承，有了继承，我们以几千年的文明塑造了无与伦比的发展速度，且这个速度一直被刷新！程序，何尝不是这样！！！<br>
</span></span><br>
</p>
   
</div><div class="ArcitleLink"><a href='http://blog.csdn.net/xvshu/article/details/43344231'>原文链接</a>