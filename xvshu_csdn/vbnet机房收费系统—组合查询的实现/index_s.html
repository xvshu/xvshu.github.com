<div class="articleLocationOnion"><a href='../../index.html'>首页: </a> &gt; <a href='../index_s.html'>未分类</a> &gt; vbnet机房收费系统—组合查询的实现</div><div style="color:blue" align=center>vbnet机房收费系统—组合查询的实现</div><br><div id="article_content" class="article_content tracking-ad" data-mod="popu_307" data-dsm="post">

<p><span style="font-size:18px">&nbsp;</span></p>
<p><span style="font-size:18px">&nbsp;&nbsp; &nbsp; &nbsp; 组合查询一直是我一个头疼的事情，经过我不懈努力，终于在看了多次博客找了n多资料后实现了，现在拿出来和大家共享，希望大家指正！</span></p>
<h1><span style="font-size:18px">首先是界面：</span></h1>
<p><span style="font-size:18px"><img src="4760065498138.jpg" alt=""></span></p>
<p><span style="font-size:18px"><br>
</span></p>
<h1><span style="font-size:18px">然后我们分层来看，B层实现对汉字向英文字符的转换：</span></h1>
<div><pre name="code" class="vb">'/************************************************* 
'作者：许恕
'小组：  
'说明:转换组合查询汉字为代码的类
'创建日期：2013.3.8
'版本号：v1.0.0
'*********************************************/

Public Class CombineCheckChangeStringBLL

    '     /// &lt;summary&gt;
    '     /// depiction：&lt;改方法是转换上下机字符&gt;
    '        /// &lt;/summary&gt;
    '        /// &lt;param name=&quot;&lt;strCombineString&gt;&quot;&gt;&lt;上下机实体&gt;&lt;/param&gt;
    '             /// &lt;returns&gt;
    '             ///&lt;返回上下机实体&gt;
    '     /// &lt;/returns&gt;
    Public Function ChangeOnlineRecordString(strCombineString As Entity.CombineSelectEntity) As Entity.CombineSelectEntity
        '转换字段
        strCombineString.FieldName1 = ChangeOnlineRecordFieldName(strCombineString.FieldName1)
        strCombineString.FieldName2 = ChangeOnlineRecordFieldName(strCombineString.FieldName2)
        strCombineString.FieldName3 = ChangeOnlineRecordFieldName(strCombineString.FieldName3)
        '装换操作符
        strCombineString.OperationalChar1 = ChangeOperationalChar(strCombineString.OperationalChar1)
        strCombineString.OperationalChar2 = ChangeOperationalChar(strCombineString.OperationalChar2)
        strCombineString.OperationalChar3 = ChangeOperationalChar(strCombineString.OperationalChar3)
        '转换关系符
        strCombineString.Relationchar1 = ChangeRelationchar(strCombineString.Relationchar1)
        strCombineString.Relationchar2 = ChangeRelationchar(strCombineString.Relationchar2)
        Return strCombineString

    End Function

'      /// &lt;summary&gt;
    '     /// depiction：&lt;改方法是转换上下机字符-字段&gt;
    '        /// &lt;/summary&gt;
    '        /// &lt;param name=&quot;&lt;strOnline&gt;&quot;&gt;&lt;上下机字符&gt;&lt;/param&gt;
    '             /// &lt;returns&gt;
    '             ///&lt;返回上字符串&gt;
    '     /// &lt;/returns&gt;
    Public Function ChangeOnlineRecordFieldName(strOnline As String) As String
        Dim strOnlineReturn As String
        Select Case strOnline
            Case &quot;卡号&quot;
                strOnlineReturn = &quot;card_id&quot;
            Case &quot;上机日期&quot;
                strOnlineReturn = &quot;online_date&quot;
            Case &quot;上机时间&quot;
                strOnlineReturn = &quot;online_time&quot;
            Case &quot;机房号&quot;
                strOnlineReturn = &quot;computer_no&quot;
            Case Else
                strOnlineReturn = &quot;&quot;
        End Select
        Return strOnlineReturn
    End Function
 '      /// &lt;summary&gt;
    '     /// depiction：&lt;改方法是转换字符-操作符&gt;
    '        /// &lt;/summary&gt;
    '        /// &lt;param name=&quot;&lt;strOnline&gt;&quot;&gt;&lt;上下机字符&gt;&lt;/param&gt;
    '             /// &lt;returns&gt;
    '             ///&lt;返回上字符串&gt;
    '     /// &lt;/returns&gt;
    Public Function ChangeOperationalChar(strChange As String) As String
        Dim strRenturn As String
        Select Case strChange
            Case &quot;大于&quot;
                strRenturn = &quot; &gt; &quot;
            Case &quot;小于&quot;
                strRenturn = &quot; &lt; &quot;
            Case &quot;等于&quot;
                strRenturn = &quot; = &quot;
            Case &quot;不等于&quot;
                strRenturn = &quot; &lt;&gt; &quot;
            Case Else
                strRenturn = &quot; &quot;
        End Select
        Return strRenturn
    End Function

    '      /// &lt;summary&gt;
    '     /// depiction：&lt;改方法是转换关系字符&gt;
    '        /// &lt;/summary&gt;
    '        /// &lt;param name=&quot;&lt;strOnline&gt;&quot;&gt;&lt;上下机字符&gt;&lt;/param&gt;
    '             /// &lt;returns&gt;
    '             ///&lt;返回上字符串&gt;
    '     /// &lt;/returns&gt;
    Public Function ChangeRelationchar(strChange As String) As String
        Dim strRenturn As String
        Select Case strChange
            Case &quot;并且&quot;
                strRenturn = &quot;  and  &quot;
            Case &quot;或者&quot;
                strRenturn = &quot;  or   &quot;
            Case Else
                strRenturn = &quot;&quot;
        End Select
        Return strRenturn
    End Function
End Class
'/************************************************* 
'作者：许恕
'小组：  
'说明:上机事务的类
'创建日期：2013.2.28
'版本号：v1.0.0
'*********************************************/
Public Class OnlineBLL
'     /// &lt;summary&gt;
    '     /// depiction：&lt;改方法是组合查询上机信息&gt;
    '        /// &lt;/summary&gt;
    '        /// &lt;param name=&quot;&lt;checkString&gt;&quot;&gt;&lt;组合查询实体&gt;&lt;/param&gt;
    '             /// &lt;returns&gt;
    '             ///&lt;返回datatable&gt;
    '     /// &lt;/returns&gt;
    Public Function CombineCheckOnlineRecord(enCheckString As Entity.CombineSelectEntity) As DataTable
        '改变组合查询的字符为英文
        Dim ChangeStringBLL As New CombineCheckChangeStringBLL
        enCheckString = ChangeStringBLL.ChangeOnlineRecordString(enCheckString)


        '查询内容
        Dim RecordFactory As New Factory.RecordFactory
        Dim IOnlineRecordDAL As IDAL.IOnLineRecordSeverDAL
        Dim OnlineDataTable As DataTable
        IOnlineRecordDAL = RecordFactory.CreatOnLineRecordSeverDAL()
        OnlineDataTable = IOnlineRecordDAL.CombineCheckOnlineRecord(enCheckString)


        '返回查询到的内容
        Return OnlineDataTable


    End Function


End Class</pre><br>
<br>
</div>
<h1><span style="font-size:18px">放到DAL 层我们的实现就简单了，我们拼接字符串查询就可以了</span></h1>
<div><span style="font-size:18px"></span><pre name="code" class="vb">Imports System
Imports System.Data
Imports System.Data.SqlClient
Imports System.Configuration

'/************************************************* 
'作者：许恕
'小组：  
'说明:组合查询字符组合成sql的类
'创建日期：2013.3.9
'版本号：v1.0.0
'*********************************************/

Public Class GroupCombineSqlStringDAL

    '     /// &lt;summary&gt;
    '     /// depiction：&lt;改方法是组合上机查询语句&gt;
    '        /// &lt;/summary&gt;
    '        /// &lt;param name=&quot;&lt;enCheckString&gt;&quot;&gt;&lt;组合查询字符实体&gt;&lt;/param&gt;
    '             /// &lt;returns&gt;
    '             ///&lt;返回string&gt;
    '     /// &lt;/returns&gt;
    Public Shared Function GroupOnlineSqlString(enCheckString As Entity.CombineSelectEntity) As String
        Dim strSQL As String
        strSQL = &quot;Select * from T_OnLineRecord where &quot; &amp; enCheckString.FieldName1 &amp; enCheckString.OperationalChar1 &amp; &quot; @SelectString1  &quot;

        If enCheckString.Relationchar1 = &quot;&quot; Then
            Return strSQL
        End If

        strSQL = strSQL &amp; enCheckString.Relationchar1 &amp; &quot; &quot; &amp; enCheckString.FieldName2 &amp; enCheckString.OperationalChar2 &amp; &quot; @SelectString2  &quot;

        If enCheckString.Relationchar2 = &quot;&quot; Then
            Return strSQL
        End If

        strSQL = strSQL &amp; enCheckString.Relationchar1 &amp; &quot; &quot; &amp; enCheckString.FieldName2 &amp; enCheckString.OperationalChar2 &amp; &quot; @SelectString2  &quot;

        Return strSQL

    End Function
End Class

'/************************************************* 
'作者：许恕
'小组：  
'说明:对用户表操作的类
'创建日期：2013.2.28 16:00
'版本号：v1.0.0
'*********************************************/
Public Class SQLSeverOnLineRecordSeverDAL : Implements IDAL.IOnLineRecordSeverDAL
'     /// &lt;summary&gt;
    '     /// depiction：&lt;改方法是组合查询记录&gt;
    '        /// &lt;/summary&gt;
    '        /// &lt;param name=&quot;&lt;enCard&gt;&quot;&gt;&lt;查询实体&gt;&lt;/param&gt;
    '             /// &lt;returns&gt;
    '             ///&lt;返回datatable&gt;
    '     /// &lt;/returns&gt;
Public Function CombineCheckOnlineRecord(enCheckString As Entity.CombineSelectEntity) As DataTable Implements IDAL.IOnLineRecordSeverDAL.CombineCheckOnlineRecord
        '创建sqlhelper类
        Dim userSqlHelper As New SqlHelper.SQLHelper

        'sql语句
        Dim strSql As String
        Dim OnlineDataTable As DataTable


        'Sql查询语句  
        strSql = GroupCombineSqlStringDAL.GroupOnlineSqlString(enCheckString)

        '设置参数  
        
        Dim sqlParams As SqlParameter()
        If enCheckString.Relationchar1 = &quot;&quot; Then
            sqlParams = {
            New SqlParameter(&quot;@SelectString1&quot;, enCheckString.SelectString1)
            }
        End If

        If enCheckString.Relationchar2 = &quot;&quot; And enCheckString.Relationchar1 &lt;&gt; &quot;&quot; Then
            sqlParams = {
            New SqlParameter(&quot;@SelectString1&quot;, enCheckString.SelectString1),
            New SqlParameter(&quot;@SelectString2&quot;, enCheckString.SelectString2)
            }
        End If

        If enCheckString.Relationchar2 &lt;&gt; &quot;&quot; And enCheckString.Relationchar1 &lt;&gt; &quot;&quot; Then
            sqlParams = {
            New SqlParameter(&quot;@SelectString1&quot;, enCheckString.SelectString1),
            New SqlParameter(&quot;@SelectString2&quot;, enCheckString.SelectString2),
            New SqlParameter(&quot;@SelectString3&quot;, enCheckString.SelectString3)
            }
        End If

        
        '执行  
        OnlineDataTable = userSqlHelper.ExecuteSelect(strSql, CommandType.Text, sqlParams)

        Return OnlineDataTable
    End Function
End Class</pre><br>
<br>
</div>
<h1><span style="font-size:18px">最后是结果：我们艰苦的奋斗有了结果：</span></h1>
<div><span style="font-size:18px"><img src="37792825858086.jpg" alt=""><br>
</span></div>
<p><br>
</p>
   
</div><div class="ArcitleLink"><a href='http://blog.csdn.net/xvshu/article/details/8664242'>原文链接</a>