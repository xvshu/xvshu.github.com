<div style="color:blue" align=center>CAS实现单点登录（SSO）返回更多用户信息（五）</div><br><div id="article_content" class="article_content tracking-ad" data-mod="popu_307" data-dsm="post">

<h1 style="margin-top:13pt; margin-bottom:13pt; font-size:16pt"><span style="font-weight:bold"><span style="font-family:KaiTi_GB2312">配置转换器返回更多用户信息</span></span></h1>
<p style="margin:0in; font-size:14.0pt"><span style="font-family:KaiTi_GB2312"><span lang="zh-CN">从</span><span lang="en-US">cas server</span><span lang="zh-CN">登录成功后，默认只能从</span><span lang="en-US">cas server</span><span lang="zh-CN">得到用户名。但程序中也可能遇到需要得到更多如姓名，手机号，</span><span lang="en-US">email</span><span lang="zh-CN">等更多用户信息的情况。</span></span></p>
<p style="margin:0in; font-size:14.0pt"><span style="font-family:KaiTi_GB2312"><span lang="en-US">cas client</span><span lang="zh-CN">拿到用户名后再到数据库中查询，的确可以得到关于该用户的更多信息。</span></span></p>
<p style="margin:0in; font-size:14.0pt"><span style="font-family:KaiTi_GB2312"><span lang="zh-CN">但是如果用户登录成功后，直接从</span><span lang="en-US">cas server</span><span lang="zh-CN">返回给</span><span lang="en-US">cas client</span><span lang="zh-CN">用户的详细信息，这也是一个不错的做法。这个好处，尤其是在分布式中得以彰显，</span><span lang="en-US">cas
 server</span><span lang="zh-CN">可以把用户信息传递给各个应用系统，如果是上面那种做法，那么各个系统得到用户名后，都得去数据库中查询一遍，无疑是一件重复性工作。</span></span></p>
<p lang="en-US" style="margin:0in; font-size:14pt"><span style="font-family:KaiTi_GB2312">&nbsp;</span></p>
<h2 style="margin-top:13pt; margin-bottom:13pt; font-size:16.0pt"><span style="font-family:KaiTi_GB2312"><span lang="zh-CN"><strong>一、首先需要配置属性</strong></span><span lang="en-US"><strong>attributeRepository</strong></span></span></h2>
<p style="margin:0in; font-size:14.0pt"><span style="font-family:KaiTi_GB2312"><span lang="zh-CN"><strong>首先，你需要到</strong></span><span lang="en-US"><strong>WEB-INF</strong></span><span lang="zh-CN"><strong>目录找到</strong></span><span lang="en-US">&nbsp;</span><span lang="en-US">deployerConfigContext.xml</span><span lang="zh-CN">文件，同时配置</span><span lang="en-US">
 attributeRepository </span><span lang="zh-CN">如下：</span></span></p>
<p style="margin:0in; font-size:14.0pt"><span lang="zh-CN"><span style="font-family:KaiTi_GB2312"></span></span></p>
<pre code_snippet_id="647506" snippet_file_name="blog_20150419_1_8096177" name="code" class="html">&lt;bean  class=&quot;org.jasig.services.persondir.support.jdbc.SingleRowJdbcPersonAttributeDao&quot; id=&quot;attributeRepository&quot;&gt;
        &lt;constructor-arg index=&quot;0&quot; ref=&quot;dataSource&quot;/&gt;
        &lt;constructor-arg index=&quot;1&quot; value=&quot;select * from t_user where {0}&quot;/&gt;
        &lt;property name=&quot;queryAttributeMapping&quot;&gt;
            &lt;map&gt;
				&lt;!--这里的key需写username和登录页面一致，value对应数据库用户名字段--&gt;
                &lt;entry key=&quot;username&quot; value=&quot;loginname&quot;/&gt; 
                 
            &lt;/map&gt;
        &lt;/property&gt;
        &lt;property name=&quot;resultAttributeMapping&quot;&gt;
            &lt;map&gt;
				&lt;!--key为对应的数据库字段名称，value为提供给客户端获取的属性名字，系统会自动填充值--&gt;  
                &lt;entry key=&quot;Id&quot; value=&quot;Id&quot;/&gt;                
                &lt;entry key=&quot;password&quot; value=&quot;password&quot;/&gt;
                &lt;entry key=&quot;age&quot; value=&quot;age&quot;/&gt; 
            &lt;/map&gt;
        &lt;/property&gt;
       &lt;!--  &lt;property name=&quot;queryType&quot;&gt;
			&lt;value&gt;OR&lt;/value&gt;
      &lt;/property&gt; --&gt;
        
    &lt;/bean&gt;</pre>
<p>
<p style="margin:0in; font-size:14.0pt"><span lang="zh-CN"><span style="font-family:KaiTi_GB2312"></span></span></p>
<p style="margin:0in; font-size:14pt"><span style="font-family:KaiTi_GB2312">其中：</span></p>
<p style="margin:0in; font-size:14.0pt"><span style="font-family:KaiTi_GB2312"><span lang="zh-CN">切记：查询出来的字段名中间不能使用</span><span lang="en-US">&nbsp;</span><span lang="en-US">_&nbsp;(</span><span lang="zh-CN">下划线</span><span lang="en-US">)</span><span lang="zh-CN">，否则获取不到数据，如</span><span lang="en-US">&nbsp;</span><span lang="en-US">cell_phone&nbsp;</span><span lang="zh-CN">需要</span><span lang="en-US">&nbsp;</span><span lang="zh-CN">设置别名为</span><span lang="en-US">&nbsp;</span><span lang="en-US">cellPhone.</span></span></p>
<p style="margin:0in; font-size:14.0pt"><span style="font-family:KaiTi_GB2312"><span lang="en-US">queryAttributeMapping</span><span lang="zh-CN">是组装</span><span lang="en-US">sql</span><span lang="zh-CN">用的查询条件属性，上述配置后，结合封装成查询</span><span lang="en-US">sql</span><span lang="zh-CN">就是</span><span lang="en-US">&nbsp;</span><span lang="en-US">select*
 from userinfo where loginname=#username#</span></span></p>
<p style="margin:0in; font-size:14.0pt"><span style="font-family:KaiTi_GB2312"><span lang="en-US">resultAttributeMapping</span><span lang="zh-CN">是</span><span lang="en-US">sql</span><span lang="zh-CN">执行完毕后返回的结构属性，</span><span lang="en-US">&nbsp;</span><span lang="en-US">key</span><span lang="zh-CN">对应数据库字段，</span><span lang="en-US">value</span><span lang="zh-CN">对应客户端获取参数。</span></span></p>
<p style="margin:0in; font-size:14.0pt"><span style="font-family:KaiTi_GB2312"><span lang="zh-CN">如果要组装多个查询条件，需要加上下面这个，默认为</span><span lang="en-US">AND</span></span></p>
<p lang="en-US" style="margin:0in; font-size:14pt"><span style="font-family:KaiTi_GB2312">&lt;property name=&quot;queryType&quot;&gt;</span></p>
<p lang="en-US" style="margin:0in; font-size:14pt"><span style="font-family:KaiTi_GB2312">&lt;value&gt;OR&lt;/value&gt;</span></p>
<p lang="en-US" style="margin:0in; font-size:14.0pt"><span style="font-family:KaiTi_GB2312">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/property&gt; &nbsp;</span></p>
<br>
<p style="margin:0in; font-size:14.0pt"><span lang="zh-CN"><span style="font-family:KaiTi_GB2312"></span></span></p>
<h2 style="margin-top:13pt; margin-bottom:13pt; font-size:16pt"><span style="font-weight:bold"><span style="font-family:KaiTi_GB2312">二、配置用户认证凭据转化的解析器</span></span></h2>
<p style="margin:0in; font-size:14.0pt"><span style="font-family:KaiTi_GB2312"><span lang="zh-CN">也是在</span><span lang="en-US"> deployerConfigContext.xml</span><span lang="zh-CN">中，为</span><span lang="en-US"> UsernamePasswordCredentialsToPrincipalResolver</span><span lang="zh-CN">注入</span><span lang="en-US">
 attributeRepository</span><span lang="zh-CN">，那么</span><span lang="en-US"> attributeRepository</span><span lang="zh-CN">就会被触发并通过此类进行解析，红色为新添部分。</span></span></p>
<p style="margin:0in; font-size:14.0pt"><span style="font-family:KaiTi_GB2312"><span lang="zh-CN"><br>
</span></span></p>
<pre code_snippet_id="647506" snippet_file_name="blog_20150419_2_9552728" name="code" class="html">&lt;property name=&quot;credentialsToPrincipalResolvers&quot;&gt;
			&lt;list&gt;
				&lt;bean class=&quot;org.jasig.cas.authentication.principal.UsernamePasswordCredentialsToPrincipalResolver&quot; &gt;
					&lt;property name=&quot;attributeRepository&quot; ref=&quot;attributeRepository&quot; /&gt;			
				&lt;/bean&gt;
				&lt;bean
					class=&quot;org.jasig.cas.authentication.principal.HttpBasedServiceCredentialsToPrincipalResolver&quot; /&gt;
			&lt;/list&gt;
		&lt;/property&gt;
&#160;</pre>
<p style="margin:0in; font-size:14.0pt"><span lang="zh-CN"><span style="font-family:KaiTi_GB2312"></span></span></p>
<h2 style="margin-top:13pt; margin-bottom:13pt; font-size:16.0pt"><span style="font-family:KaiTi_GB2312"><span lang="zh-CN"><strong>三、修改</strong></span><span lang="en-US"><strong>&nbsp;</strong></span><span lang="en-US"><strong>deployerConfigContext.xml</strong></span></span></h2>
<p style="margin-top:13pt; margin-bottom:13pt; font-size:16.0pt"><strong><span lang="zh-CN" style="font-family:KaiTi_GB2312; font-size:16pt">中的</span><span lang="en-US" style="font-family:KaiTi_GB2312; font-size:16pt">&nbsp;</span><span lang="en-US" style="font-family:KaiTi_GB2312; font-size:16pt">org.jasig.cas.services.InMemoryServiceRegistryDaoImpl</span><span lang="zh-CN" style="font-family:KaiTi_GB2312; font-size:16pt">的</span><span lang="zh-CN" style="font-family:KaiTi_GB2312; font-size:16pt"></span><span lang="zh-CN" style="font-family:KaiTi_GB2312; font-size:16pt">属性</span><span lang="en-US" style="font-family:KaiTi_GB2312; font-size:16pt">&nbsp;</span><span lang="en-US" style="font-family:KaiTi_GB2312; font-size:16pt">registeredServices</span></strong></p>
<p style="margin:0in; font-size:14.0pt"><span style="font-family:KaiTi_GB2312"><span lang="zh-CN">修改</span><span lang="en-US">&nbsp;</span><span lang="en-US">registeredServices&nbsp;&nbsp;</span><span lang="zh-CN">列表中的每个协议中的</span><span lang="en-US"> allowedAttributes</span><span lang="zh-CN">属性的&#20540;。列出的每个&#20540;，在客户端就可以访问了</span></span></p>
<p style="margin:0in; font-size:14.0pt"><span style="font-family:KaiTi_GB2312"><span lang="zh-CN"><br>
</span></span></p>
<pre code_snippet_id="647506" snippet_file_name="blog_20150419_3_8317459" name="code" class="html">&lt;bean
		id=&quot;serviceRegistryDao&quot;
        class=&quot;org.jasig.cas.services.InMemoryServiceRegistryDaoImpl&quot;&gt;
            &lt;property name=&quot;registeredServices&quot;&gt;
                &lt;list&gt;
                    &lt;bean class=&quot;org.jasig.cas.services.RegexRegisteredService&quot;&gt;
                        &lt;property name=&quot;id&quot; value=&quot;0&quot; /&gt;
                        &lt;property name=&quot;name&quot; value=&quot;HTTP and IMAP&quot; /&gt;
                        &lt;property name=&quot;description&quot; value=&quot;Allows HTTP(S) and IMAP(S) protocols&quot; /&gt;
                        &lt;property name=&quot;serviceId&quot; value=&quot;^(https?|imaps?)://.*&quot; /&gt;
                        &lt;property name=&quot;evaluationOrder&quot; value=&quot;10000001&quot; /&gt;						
						
						   &lt;property name=&quot;allowedAttributes&quot;&gt;
                                &lt;list&gt;
                                        &lt;value&gt;Id&lt;/value&gt;
                                        &lt;value&gt;password&lt;/value&gt;
                                         &lt;value&gt;age&lt;/value&gt; 
                                &lt;/list&gt;
                        &lt;/property&gt;

                    &lt;/bean&gt;
</pre><br>
<p style="margin:0in; font-size:14.0pt"><span lang="zh-CN"><span style="font-family:KaiTi_GB2312"></span></span></p>
<p style="margin:0in; font-size:14.0pt"><span style="font-family:KaiTi_GB2312"><span lang="zh-CN">此步骤</span><span lang="zh-CN"><strong>灰常重要</strong></span><span lang="zh-CN">，可以看看</span><span lang="en-US">&nbsp;</span><span lang="en-US">org.jasig.cas.services.RegexRegisteredService</span><span lang="zh-CN">的源码，其中的</span><span lang="en-US">&nbsp;</span><span lang="en-US">allowedAttributes</span><span lang="zh-CN">是关键</span></span></p>
<p style="margin:0in; font-size:14.0pt"><span style="font-family:KaiTi_GB2312"><span lang="zh-CN">【提示】网上说此</span><span lang="en-US">bean</span><span lang="zh-CN">中的</span><span lang="en-US">ignoreAttributes</span><span lang="zh-CN">属性默认是不添加用户信息，查看了</span><span lang="en-US">
 CAS 3.5.2</span><span lang="zh-CN">版本的</span><span lang="en-US">&nbsp;</span><span lang="en-US">AbstractRegisteredService&nbsp;</span><span lang="zh-CN">源码后，发现其默认&#20540;就是</span><span lang="en-US"> false</span><span lang="zh-CN">，即：添加属性后，客户端就可见了</span></span></p>
<p lang="en-US" style="margin:0in; font-size:14pt">&nbsp;</p>
<h2 style="margin-top:13pt; margin-bottom:13pt; font-size:16.0pt"><span style="font-family:KaiTi_GB2312"><span lang="zh-CN"><strong>四、修改</strong></span><span lang="en-US"><strong>casServiceValidationSuccess.jsp</strong></span></span></h2>
<p lang="en-US" style="margin:0in; font-size:14pt"><span style="font-family:KaiTi_GB2312">WEB-INF/view/jsp/protocol/2.0/casServiceValidationSuccess.jsp</span></p>
<p style="margin:0in; font-size:14.0pt"><span style="font-family:KaiTi_GB2312"><span lang="zh-CN">在</span><span lang="en-US">server</span><span lang="zh-CN">验证成功后，这个页面负责生成与客户端交互的</span><span lang="en-US">xml</span><span lang="zh-CN">信息，在默认的</span><span lang="en-US">casServiceValidationSuccess.jsp</span><span lang="zh-CN">中，只包括用户名，并不提供其他的属性信息，因此需要对页面进行扩展，如下，红色为新添加部分</span><span lang="en-US">&nbsp;</span></span></p>
<p style="margin:0in; font-size:14.0pt"><span style="font-family:KaiTi_GB2312"><span lang="en-US"><br>
</span></span></p>
<pre code_snippet_id="647506" snippet_file_name="blog_20150419_4_6318039" name="code" class="html">&lt;cas:serviceResponse xmlns:cas=&#39;http://www.yale.edu/tp/cas&#39;&gt;
&#160; &lt;cas:authenticationSuccess&gt;
&lt;cas:user&gt;${fn:escapeXml(assertion.chainedAuthentications[fn:length(assertion.chainedAuthentications)-1].principal.id)}&lt;/cas:user&gt;

&lt;c:if test=&quot;${fn:length(assertion.chainedAuthentications[fn:length(assertion.chainedAuthentications)-1].principal.attributes) &gt; 0}&quot;&gt;
            &lt;cas:attributes&gt;
                &lt;c:forEach var=&quot;attr&quot; items=&quot;${assertion.chainedAuthentications[fn:length(assertion.chainedAuthentications)-1].principal.attributes}&quot;&gt;
                    &lt;cas:${fn:escapeXml(attr.key)}&gt;${fn:escapeXml(attr.value)}&lt;/cas:${fn:escapeXml(attr.key)}&gt;
                &lt;/c:forEach&gt;
            &lt;/cas:attributes&gt;
        &lt;/c:if&gt;

&lt;c:if test=&quot;${not empty pgtIou}&quot;&gt;
&#160;&#160; &lt;cas:proxyGrantingTicket&gt;${pgtIou}&lt;/cas:proxyGrantingTicket&gt;
&lt;/c:if&gt;
&lt;c:if test=&quot;${fn:length(assertion.chainedAuthentications) &gt; 1}&quot;&gt;
&lt;cas:proxies&gt;
&lt;c:forEach var=&quot;proxy&quot; items=&quot;${assertion.chainedAuthentications}&quot; varStatus=&quot;loopStatus&quot; begin=&quot;0&quot; end=&quot;${fn:length(assertion.chainedAuthentications)-2}&quot; step=&quot;1&quot;&gt;
&#160;&#160;&#160; &lt;cas:proxy&gt;${fn:escapeXml(proxy.principal.id)}&lt;/cas:proxy&gt;
&lt;/c:forEach&gt;
&lt;/cas:proxies&gt;
&lt;/c:if&gt;
&#160;&lt;/cas:authenticationSuccess&gt;
&lt;/cas:serviceResponse&gt;
</pre><br>
<p style="margin:0in; font-size:14.0pt"><span lang="zh-CN"><span style="font-family:KaiTi_GB2312"></span></span></p>
<p style="margin:0in; font-size:14.0pt"><span style="font-family:KaiTi_GB2312"><span lang="zh-CN">通过完成上面四个步骤的配置后，</span><span lang="en-US">CAS S</span><span lang="en-US">erver</span><span lang="zh-CN">端的工作就完成了，那么如何在客户端获取这些信息呢？下面进行说明：</span></span></p>
<p style="margin:0in; font-size:14.0pt"><span style="font-size:14pt">&nbsp;</span></p>
<h1 style="margin-top:13pt; margin-bottom:13pt; font-size:16.0pt"><span style="font-family:KaiTi_GB2312"><span lang="en-US"><strong>cas client</strong></span><span lang="zh-CN"><strong>获取用户信息：</strong></span></span></h1>
<pre code_snippet_id="647506" snippet_file_name="blog_20150419_5_971333" name="code" class="java">AttributePrincipal principal = (AttributePrincipal) request.getUserPrincipal();
Map attributes = principal.getAttributes();

String email=attributes .get(&quot;age&quot;);</pre><br>
<br>
<p style="margin:0in; font-size:14.0pt"><span lang="zh-CN"><span style="font-family:KaiTi_GB2312"></span></span></p>
<p style="margin:0in; font-size:14pt"><span style="font-family:KaiTi_GB2312">补充：</span></p>
<p style="margin:0in; font-size:14pt">&nbsp;</p>
<h2 style="margin:0in; font-size:14.0pt"><span style="font-family:KaiTi_GB2312"><span lang="en-US">cas_client</span><span lang="zh-CN">项目结构：</span></span></h2>
<p style="margin:0in; font-size:14.0pt"><span lang="zh-CN"><br>
</span></p>
<img src="488676810257636" alt=""><br>
<p style="margin:0in; font-size:14.0pt"><span lang="zh-CN"><span style="font-family:KaiTi_GB2312"></span></span></p>
<p lang="en-US" style="margin:0in; font-size:14pt"><br>
</p>
<p lang="en-US" style="margin:0in; font-size:14pt"><span style="font-family:KaiTi_GB2312">web.xml</span></p>
<p lang="en-US" style="margin:0in; font-size:14pt">
<pre code_snippet_id="647506" snippet_file_name="blog_20150419_6_3639758" name="code" class="html">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;web-app xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xmlns=&quot;http://java.sun.com/xml/ns/javaee&quot; xmlns:web=&quot;http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd&quot; xsi:schemaLocation=&quot;http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd&quot; id=&quot;WebApp_ID&quot; version=&quot;2.5&quot;&gt;
  &lt;display-name&gt;cas_client&lt;/display-name&gt;
  &lt;welcome-file-list&gt;
    &lt;welcome-file&gt;userInfoView.jsp&lt;/welcome-file&gt;
  &lt;/welcome-file-list&gt;
  
 &lt;!-- ======================== 单点登录开始 ======================== --&gt;
                 &lt;!-- 用于单点退出，该过滤器用于实现单点登出功能，可选配置--&gt;
                &lt;listener&gt;
                        &lt;listener-class&gt;org.jasig.cas.client.session.SingleSignOutHttpSessionListener&lt;/listener-class&gt;
                &lt;/listener&gt;
                &lt;filter&gt;
                        &lt;filter-name&gt;CAS Single Sign Out Filter&lt;/filter-name&gt;
                        &lt;filter-class&gt;org.jasig.cas.client.session.SingleSignOutFilter&lt;/filter-class&gt;
                &lt;/filter&gt;
                &lt;filter-mapping&gt;
                        &lt;filter-name&gt;CAS Single Sign Out Filter&lt;/filter-name&gt;
                        &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
                &lt;/filter-mapping&gt;
                
                
				&lt;filter&gt;
                        &lt;filter-name&gt;CAS Filter&lt;/filter-name&gt;
                        &lt;filter-class&gt;org.jasig.cas.client.authentication.AuthenticationFilter&lt;/filter-class&gt;
                        &lt;init-param&gt;
                                &lt;param-name&gt;casServerLoginUrl&lt;/param-name&gt;
                                &lt;param-value&gt;http://localhost:8080/cas&lt;/param-value&gt;
                        &lt;/init-param&gt;
                        &lt;init-param&gt;
                                &lt;param-name&gt;serverName&lt;/param-name&gt;
                                &lt;param-value&gt;http://localhost:18080&lt;/param-value&gt;
                        &lt;/init-param&gt;
                &lt;/filter&gt;
                &lt;filter-mapping&gt;
                        &lt;filter-name&gt;CAS Filter&lt;/filter-name&gt;
                        &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
                &lt;/filter-mapping&gt;
                
                  &lt;!-- 该过滤器负责对Ticket的校验工作，必须启用它 --&gt;
                &lt;filter&gt;
                        &lt;filter-name&gt;CAS Validation Filter&lt;/filter-name&gt;
                        &lt;filter-class&gt;
                                org.jasig.cas.client.validation.Cas20ProxyReceivingTicketValidationFilter&lt;/filter-class&gt;
                        &lt;init-param&gt;
                                &lt;param-name&gt;casServerUrlPrefix&lt;/param-name&gt;
                                &lt;param-value&gt;http://localhost:8080/cas&lt;/param-value&gt;
                        &lt;/init-param&gt;
                        &lt;init-param&gt;
                                &lt;param-name&gt;serverName&lt;/param-name&gt;
                                &lt;param-value&gt;http://localhost:18080&lt;/param-value&gt;
                        &lt;/init-param&gt;
                &lt;/filter&gt;
                &lt;filter-mapping&gt;
                        &lt;filter-name&gt;CAS Validation Filter&lt;/filter-name&gt;
                        &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
                &lt;/filter-mapping&gt;
                
			
               &lt;!--   该过滤器负责实现HttpServletRequest请求的包裹， --&gt;
               &lt;!--  比如允许开发者通过HttpServletRequest的getRemoteUser()方法获得SSO登录用户的登录名，可选配置。 --&gt;
                

                &lt;filter&gt;
                        &lt;filter-name&gt;CAS HttpServletRequest Wrapper Filter&lt;/filter-name&gt;
                        &lt;filter-class&gt;
                                org.jasig.cas.client.util.HttpServletRequestWrapperFilter&lt;/filter-class&gt;
                &lt;/filter&gt;
                &lt;filter-mapping&gt;
                        &lt;filter-name&gt;CAS HttpServletRequest Wrapper Filter&lt;/filter-name&gt;
                        &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
                &lt;/filter-mapping&gt;
                

             &lt;!--  该过滤器使得开发者可以通过org.jasig.cas.client.util.AssertionHolder来获取用户的登录名。 --&gt;
             &lt;!--  比如AssertionHolder.getAssertion().getPrincipal().getName()。根据客户端获取的方式可以选择使用这两种 --&gt;
                

               &lt;!--  &lt;filter&gt;
                        &lt;filter-name&gt;CAS Assertion Thread Local Filter&lt;/filter-name&gt;
                        &lt;filter-class&gt;org.jasig.cas.client.util.AssertionThreadLocalFilter&lt;/filter-class&gt;
                &lt;/filter&gt;
                &lt;filter-mapping&gt;
                        &lt;filter-name&gt;CAS Assertion Thread Local Filter&lt;/filter-name&gt;
                        &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
                &lt;/filter-mapping&gt; --&gt;
                
&lt;!-- ======================== 单点登录结束 ======================== --&gt;

   &lt;servlet&gt;
       &lt;servlet-name&gt;HelloWorldExample&lt;/servlet-name&gt;
       &lt;servlet-class&gt;com.tgb.cas.client.HelloWorldExample&lt;/servlet-class&gt;
   &lt;/servlet&gt;
   
   &lt;servlet-mapping&gt;
      &lt;servlet-name&gt;HelloWorldExample&lt;/servlet-name&gt;
      &lt;url-pattern&gt;/servlet/HelloWorldExample&lt;/url-pattern&gt;
  &lt;/servlet-mapping&gt;
&lt;/web-app&gt;</pre>
<p>
<br>
<p style="margin:0in; font-size:14.0pt"><span lang="zh-CN"><span style="font-family:KaiTi_GB2312"></span></span></p>
<p style="margin:0in; font-size:14pt"><span style="font-family:KaiTi_GB2312">HelloWorldExample：</span></p>
<pre code_snippet_id="647506" snippet_file_name="blog_20150419_7_211879" name="code" class="java">public class HelloWorldExample extends HttpServlet {
	private static final long serialVersionUID = 1L;

	public void doGet(HttpServletRequest request, HttpServletResponse response)
			throws IOException, ServletException {
		response.setContentType(&quot;text/html&quot;);
		PrintWriter out = response.getWriter();

		out.println(&quot;&lt;html&gt;&quot;);
		out.println(&quot;&lt;head&gt;&quot;);

		String title = &quot;Hello&quot;;

		out.println(&quot;&lt;title&gt;&quot; + title + &quot;&lt;/title&gt;&quot;);
		out.println(&quot;&lt;/head&gt;&quot;);
		out.println(&quot;&lt;body bgcolor=\&quot;white\&quot;&gt;&quot;);


		out.println(&quot;&lt;a href=\&quot;../helloworld.html\&quot;&gt;&quot;);
		out.println(&quot;&lt;img src=\&quot;../images/code.gif\&quot; height=24 &quot;
				+ &quot;width=24 align=right border=0 alt=\&quot;view code\&quot;&gt;&lt;/a&gt;&quot;);
		out.println(&quot;&lt;a href=\&quot;../index.html\&quot;&gt;&quot;);
		out.println(&quot;&lt;img src=\&quot;../images/return.gif\&quot; height=24 &quot;
				+ &quot;width=24 align=right border=0 alt=\&quot;return\&quot;&gt;&lt;/a&gt;&quot;);
		out.println(&quot;&lt;h1&gt;&quot; + title + &quot;&lt;/h1&gt;&quot;);
		//以下是两种获取用户信息的两种方式，分别与Web.XML中的配置相对应，大家结合理解
		
		// 通过 CAS HttpServletRequest Wrapper Filter 获取用户信息
		String userNameString = request.getRemoteUser();
		
		AttributePrincipal principal = (AttributePrincipal) request.getUserPrincipal();
		
		if (null != principal) {
			Map&lt;String, Object&gt; attMap = principal.getAttributes();
			out.println(&quot; Log | getAttributes Map size = &quot; + attMap.size() + &quot;&lt;br&gt;&quot;);
			for (Entry&lt;String, Object&gt; entry : attMap.entrySet()) {
				out.println(&quot;     | &quot; + entry.getKey() + &quot;=:&quot; + entry.getValue() + &quot;&lt;br&gt;&quot;);
			}		
			String username = null;
			out.print(&quot; Log | UserName:&quot;);
			if (null != principal) {
				username = principal.getName();
				out.println(&quot;&lt;span style=&#39;color:red;&#39;&gt;&quot; + username + &quot;&lt;/span&gt;&lt;br&gt;&quot;);
			}
		}
		
		
		
		// 通过CAS Assertion Thread Local Filter  获取用户信息，共两种方式
//		Assertion assertion = (Assertion) request.getSession().getAttribute(
//				AbstractCasFilter.CONST_CAS_ASSERTION);
//		if (null != assertion) {
//			
//			Map&lt;String, Object&gt; attMap = assertion.getPrincipal().getAttributes();
//			out.println(&quot; Log | getAttributes Map size = &quot; + attMap.size() + &quot;&lt;br&gt;&quot;);
//			for (Entry&lt;String, Object&gt; entry : attMap.entrySet()) {
//				out.println(&quot;     | &quot; + entry.getKey() + &quot;=:&quot; + entry.getValue() + &quot;&lt;br&gt;&quot;);
//			}
//			
//			AttributePrincipal principal = assertion.getPrincipal();
//			// AttributePrincipal principal = (AttributePrincipal) request
//			// .getUserPrincipal();
//			String username = null;
//			out.print(&quot; Log | UserName:&quot;);
//			if (null != principal) {
//				username = principal.getName();
//				out.println(&quot;&lt;span style=&#39;color:red;&#39;&gt;&quot; + username + &quot;&lt;/span&gt;&lt;br&gt;&quot;);
//			}
//		}

		out.println(&quot;&lt;/body&gt;&quot;);
		out.println(&quot;&lt;/html&gt;&quot;);
	}
}
</pre><br>
<p style="margin:0in; font-size:14.0pt"><span lang="zh-CN"><span style="font-family:KaiTi_GB2312">userInfoView.jsp（未使用）：<br>
</span></span></p>
<p style="margin:0in; font-size:14.0pt"><span lang="zh-CN"><span style="font-family:KaiTi_GB2312"></span></span></p>
<pre code_snippet_id="647506" snippet_file_name="blog_20150419_8_5355539" name="code" class="html">&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;
    pageEncoding=&quot;UTF-8&quot;%&gt;
&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot; &quot;http://www.w3.org/TR/html4/loose.dtd&quot;&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=UTF-8&quot;&gt;
&lt;title&gt;Insert title here&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
	&lt;a href=&quot;servlet/HelloWorldExample&quot;&gt;获取Server端用户信息&lt;/a&gt;
	&lt;br&gt;
	&lt;a href=&quot;http://localhost:8080/cas/logout?service=http://localhost:18080/cas_client/servlet/HelloWorldExample&quot;&gt;单点退出&lt;/a&gt;
&lt;/body&gt;
&lt;/html&gt;</pre><br>
<p>
<h1 style="margin:0in; font-size:14.0pt"><span lang="zh-CN"><span style="font-family:KaiTi_GB2312">效果：</span></span></h1>
<p style="margin:0in; font-size:14.0pt"><span lang="zh-CN"><span style="font-family:KaiTi_GB2312"><br>
</span></span></p>
<p style="margin:0in; font-size:14.0pt"><span lang="zh-CN"><span style="font-family:KaiTi_GB2312">访问：http://localhost:18080/cas_client/servlet/HelloWorldExample</span></span></p>
<p style="margin:0in; font-size:14.0pt"><span lang="zh-CN"><span style="font-family:KaiTi_GB2312"><br>
</span></span></p>
<p style="margin:0in; font-size:14.0pt"><span lang="zh-CN"><span style="font-family:KaiTi_GB2312"><img src="10568889471047" alt=""><br>
</span></span></p>
<p style="margin:0in; font-size:14.0pt"><span lang="zh-CN"><span style="font-family:KaiTi_GB2312"><br>
</span></span></p>
<p style="margin:0in; font-size:14.0pt"><span lang="zh-CN"><span style="font-family:KaiTi_GB2312">附：<br>
</span></span></p>
<p style="margin:0in; font-size:14.0pt"><span lang="zh-CN"><span style="font-family:KaiTi_GB2312"><br>
</span></span></p>
<p style="margin:0in; font-size:14.0pt"><span lang="zh-CN"><span style="font-family:KaiTi_GB2312"><img src="38961578855654" alt=""><br>
</span></span></p>
<p style="margin:0in; font-size:14.0pt"><span lang="zh-CN"></span></p>
<p style="margin:0in; font-size:14pt"><span style="font-family:KaiTi_GB2312"><span lang="zh-CN">其中</span><span lang="en-US">cas</span><span lang="en-US"></span><span lang="zh-CN">服务端对应的代码是官网中提供的cas-server-webapp-3.5.2.war，而</span><span lang="en-US">cas_client</span><span lang="zh-CN">客户端代码是我们自己编写的，参照</span><span lang="en-US">tomcat</span><span lang="zh-CN">中的</span><span lang="en-US">example</span><span lang="zh-CN">项目。</span></span></p>
<p style="margin:0in; font-size:14pt"><span style="font-family:KaiTi_GB2312">&nbsp;</span></p>
<p style="margin:0in; font-size:14pt"><span style="font-family:KaiTi_GB2312">&nbsp;</span></p>
<h1 style="margin:0in; font-size:14pt"><span style="font-family:KaiTi_GB2312">总结：</span></h1>
<p style="margin:0in; font-size:14pt"><span style="font-family:KaiTi_GB2312"><span lang="en-US">&nbsp; &nbsp; &nbsp;CAS</span><span lang="zh-CN">返回更多用户信息这方面的文章有很多，在这里我再次进行总结学习也是为了梳理自己的知识，让自己加深理解。以上只是一个简单的知识点，大家理解就好，接下来会结合</span><span lang="en-US">Spring</span><span lang="zh-CN">进行学习。</span></span></p>
<p style="margin:0in; font-size:14pt"><span style="font-family:KaiTi_GB2312"><span lang="zh-CN"><br>
</span></span></p>
<p style="margin:0in; font-size:14pt"><span style="font-family:KaiTi_GB2312"><span lang="zh-CN"><br>
</span></span></p>
<p style="margin:0in; font-size:14pt"><span style="font-family:KaiTi_GB2312">&nbsp;</span></p>
<br>
   
</div><div class="ArcitleLink"><a href='http://blog.csdn.net/hejingyuan6/article/details/45126373'>原文链接</a>