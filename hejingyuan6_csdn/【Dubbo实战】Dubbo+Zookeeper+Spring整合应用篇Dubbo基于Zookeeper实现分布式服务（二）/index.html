<div style="color:blue" align=center>【Dubbo实战】Dubbo+Zookeeper+Spring整合应用篇Dubbo基于Zookeeper实现分布式服务（二）</div><br><div id="article_content" class="article_content tracking-ad" data-mod="popu_307" data-dsm="post">
<p style="margin: 0in; font-size: 14pt;"><span style="font-family: KaiTi_GB2312; font-size: 14pt;"><br></span></p><h1 style="margin: 0in; font-size: 14pt;"><span style="font-family: KaiTi_GB2312; font-size: 14pt;">Dubbo与Zookeeper、Spring整合使用</span></h1><p style="margin: 0in; font-size: 14pt;"><span style="font-family: KaiTi_GB2312;"><br></span></p><p style="margin: 0in; font-size: 14pt;"><span style="font-family:KaiTi_GB2312;">&nbsp;</span></p><p style="margin: 0in; font-size: 14pt;"><span style="font-family:KaiTi_GB2312;">Dubbo采用全Spring配置方式，透明化接入应用，对应用没有任何API侵入，只需用Spring加载Dubbo的配置即可，Dubbo基于Spring的Schema扩展进行加载。</span></p><p style="margin: 0in; font-size: 14pt;"><span style="font-family:KaiTi_GB2312;">&nbsp;</span></p><h2 style="margin: 0in; font-size: 14pt;"><span style="font-family:KaiTi_GB2312;">一：单机模式安装zookeeper</span></h2><p style="margin: 0in; font-size: 14pt;"><span style="font-family:KaiTi_GB2312;"><br></span></p><p style="margin: 0in; font-size: 14pt;"><span style="font-family:KaiTi_GB2312;">&nbsp;</span></p><p style="margin: 0in; font-size: 14pt;"><span style="font-family:KaiTi_GB2312;">1,下载zookeeper注册中心，下载地址：<a target="_blank" target="_blank" href="http://www.apache.org/dyn/closer.cgi/zookeeper/">http://www.apache.org/dyn/closer.cgi/zookeeper/</a>&nbsp;下载后解压即可，进入E:\zookeeper-3.3.6\zookeeper-3.3.6\bin，</span></p><p style="margin: 0in; font-size: 14pt;"><span style="font-family:KaiTi_GB2312;">双击zkServer.cmd启动注册中心服务。</span></p><p style="margin: 0in; font-size: 14pt;"><span style="font-family:KaiTi_GB2312;">zkServer.sh【Linux】或zkServer.cmd【Windows】</span></p><p style="margin: 0in; font-size: 14pt;"><span style="font-family:KaiTi_GB2312;">&nbsp;</span></p><p style="margin: 0in; font-size: 14pt;"><span style="font-family:KaiTi_GB2312;">2,在你执行启动脚本之前，还有几个基本的配置项需要配置一下，Zookeeper的配置文件在 conf 目录下，这个目录下有 zoo_sample.cfg 和 log4j.properties，你需要做的就是将zoo_sample.cfg 改名为 zoo.cfg，因为 Zookeeper在启动时会找这个文件作为默认配置文件。下面详细介绍一下，这个配置文件中各个配置项的意义。</span></p><p style="margin: 0in; font-size: 14pt;"><span style="font-family:KaiTi_GB2312;"><br></span></p><p style="margin: 0in; font-size: 14pt;"><span style="font-family:KaiTi_GB2312;">&nbsp;<img src="27031609581392" alt=""></span></p><p style="margin: 0in; font-size: 14pt;"><span style="font-family:KaiTi_GB2312;"><br></span></p><p style="margin: 0in; font-size: 14pt;"><span style="font-family:KaiTi_GB2312;">&nbsp; &nbsp;•tickTime：这个时间是作为Zookeeper 服务器之间或客户端与服务器之间维持心跳的时间间隔，也就是每个 tickTime 时间就会发送一个心跳。</span></p><p style="margin: 0in; font-size: 14pt;"><span style="font-family:KaiTi_GB2312;">&nbsp; &nbsp;•dataDir：顾名思义就是 Zookeeper保存数据的目录，默认情况下，Zookeeper 将写数据的日志文件也保存在这个目录里。</span></p><p style="margin: 0in; font-size: 14pt;"><span style="font-family:KaiTi_GB2312;">&nbsp; &nbsp;•dataLogDir：顾名思义就是Zookeeper 保存日志文件的目录</span></p><p style="margin: 0in; font-size: 14pt;"><span style="font-family:KaiTi_GB2312;">&nbsp; &nbsp;•clientPort：这个端口就是客户端连接Zookeeper 服务器的端口，Zookeeper 会监听这个端口，接受客户端的访问请求</span></p><p style="margin: 0in; font-size: 14pt;"><span style="font-family:KaiTi_GB2312;">&nbsp;</span></p><p style="margin: 0in; font-size: 14pt;"><span style="font-family:KaiTi_GB2312;">配置好后，zookeeper会监听本机的2181端口。</span></p><p style="margin: 0in; font-size: 14pt;"><span style="font-family:KaiTi_GB2312;">当这些配置项配置好后，你现在就可以启动 Zookeeper 了，启动后要检查 Zookeeper 是否已经在服务，可以通过 netstat – ano 命令查看是否有你配置的 clientPort 端口号在监听服务。</span></p><p style="margin: 0in; font-size: 14pt;"><span style="font-family:KaiTi_GB2312;">&nbsp;</span></p><h2 style="margin: 0in; font-size: 14pt;"><span style="font-family:KaiTi_GB2312;">二：服务提供者</span></h2><p style="margin: 0in; font-size: 14pt;"><span style="font-family:KaiTi_GB2312;">&nbsp;</span></p><p style="margin: 0in; font-size: 14pt;"><span style="font-family:KaiTi_GB2312;">定义服务接口:(该接口需单独打包，在服务提供方和消费方共享)</span></p><p style="margin: 0in; font-size: 14pt;"><span style="font-family:KaiTi_GB2312;"></span></p><pre name="code" class="java">package com.unj.dubbotest.provider;

import java.util.List;

public interface DemoService {

	String sayHello(String name);

	public List getUsers();

}</pre><p><p style="margin: 0in; font-size: 14pt;"><p style="margin: 0in; font-size: 14pt;"><span style="font-family:KaiTi_GB2312;">在服务提供方实现接口：(对服务消费方隐藏实现)</span></p><span style="font-family:KaiTi_GB2312;"></span><pre name="code" class="java">package com.unj.dubbotest.provider.impl;

import java.util.ArrayList;
import java.util.List;

import com.unj.dubbotest.provider.DemoService;

public class DemoServiceImpl implements DemoService {

	public String sayHello(String name) {
		return &quot;Hello &quot; + name;
	}

	public List getUsers() {
		List list = new ArrayList();
		User u1 = new User();
		u1.setName(&quot;hejingyuan&quot;);
		u1.setAge(20);
		u1.setSex(&quot;f&quot;);

		User u2 = new User();
		u2.setName(&quot;xvshu&quot;);
		u2.setAge(21);
		u2.setSex(&quot;m&quot;);

		
		list.add(u1);
		list.add(u2);
		
		return list;
	}
}
</pre><br><p style="margin: 0in; font-size: 14pt;"><p style="margin: 0in; font-size: 14pt;"><span style="font-family:KaiTi_GB2312;">用Spring配置声明暴露服务：</span></p><p style="margin: 0in; font-size: 14pt;"><span style="font-family:KaiTi_GB2312;"></span></p><pre name="code" class="html">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
	xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xmlns:dubbo=&quot;http://code.alibabatech.com/schema/dubbo&quot;
	xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://code.alibabatech.com/schema/dubbo
        http://code.alibabatech.com/schema/dubbo/dubbo.xsd
        &quot;&gt;

	&lt;!-- 具体的实现bean --&gt;
	&lt;bean id=&quot;demoService&quot; class=&quot;com.unj.dubbotest.provider.impl.DemoServiceImpl&quot; /&gt;

	&lt;!-- 提供方应用信息，用于计算依赖关系 --&gt;
	&lt;dubbo:application name=&quot;xs_provider&quot; /&gt;

	&lt;!-- 使用multicast广播注册中心暴露服务地址 --&gt;
	&lt;!--&lt;dubbo:registry address=&quot;multicast://224.5.6.7:1234&quot; /&gt; --&gt;
	
	&lt;!-- 使用zookeeper注册中心暴露服务地址 --即zookeeper的所在服务器ip地址和端口号 --&gt;
	&lt;dubbo:registry address=&quot;zookeeper://192.168.24.213:2181&quot; /&gt;

	&lt;!-- 用dubbo协议在20880端口暴露服务 --&gt;
	&lt;dubbo:protocol name=&quot;dubbo&quot; port=&quot;20880&quot; /&gt;

	&lt;!-- 声明需要暴露的服务接口 --&gt;
	&lt;dubbo:service interface=&quot;com.unj.dubbotest.provider.DemoService&quot;
		ref=&quot;demoService&quot; /&gt;

&lt;/beans&gt;
</pre><br><br><p><br><p style="margin: 0in; font-size: 14pt;"><p style="margin:0in;font-size:14.0pt"><span style="font-family: KaiTi_GB2312;"><span lang="zh-CN">加载Spring配置，启动服务（或者将项目建为</span><span lang="en-US">web</span><span lang="zh-CN">项目，然后在</span><span lang="en-US">web</span><span lang="en-US">.xml</span><span lang="zh-CN">中配置好</span><span lang="en-US">spring</span><span lang="zh-CN">的启动，然后扔到</span><span lang="en-US">tomcat</span><span lang="zh-CN">中即可提供服务）：</span></span></p><p style="margin:0in;font-size:14.0pt"><br></p><pre name="code" class="java">package com.unj.dubbotest.provider.impl;

import org.springframework.context.support.ClassPathXmlApplicationContext;

public class Provider {

	public static void main(String[] args) throws Exception {
		ClassPathXmlApplicationContext context = new ClassPathXmlApplicationContext(
				new String[] { &quot;applicationContext.xml&quot; });
		context.start();
		System.in.read(); // 为保证服务一直开着，利用输入流的阻塞来模拟
	}
}
</pre><br><p><p style="margin: 0in; font-size: 14pt;"><h2 style="margin: 0in; font-size: 14pt;"><span style="font-family:KaiTi_GB2312;">三：服务消费者</span></h2><p style="margin: 0in; font-size: 14pt;"><span style="font-family:KaiTi_GB2312;">&nbsp;</span></p><p style="margin: 0in; font-size: 14pt;"><span style="font-family:KaiTi_GB2312;">通过Spring配置引用远程服务：</span></p><p style="margin: 0in; font-size: 14pt;"><span style="font-family:KaiTi_GB2312;"><br></span></p><span style="font-family:KaiTi_GB2312;"></span><pre name="code" class="html">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
	xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xmlns:dubbo=&quot;http://code.alibabatech.com/schema/dubbo&quot;
	xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://code.alibabatech.com/schema/dubbo
        http://code.alibabatech.com/schema/dubbo/dubbo.xsd
        &quot;&gt;

	&lt;!-- 消费方应用名，用于计算依赖关系，不是匹配条件，不要与提供方一样 --&gt;
	&lt;dubbo:application name=&quot;hjy_consumer&quot; /&gt;

	&lt;!-- 使用zookeeper注册中心暴露服务地址 --&gt;
	&lt;!-- &lt;dubbo:registry address=&quot;multicast://224.5.6.7:1234&quot; /&gt; --&gt;
	&lt;dubbo:registry address=&quot;zookeeper://192.168.24.213:2181&quot; /&gt;

	&lt;!-- 生成远程服务代理，可以像使用本地bean一样使用demoService --&gt;
	&lt;dubbo:reference id=&quot;demoService&quot;
		interface=&quot;com.unj.dubbotest.provider.DemoService&quot; /&gt;

&lt;/beans&gt;
</pre><br><p style="margin: 0in; font-size: 14pt;"><p style="margin: 0in; font-size: 14pt;"><span style="font-family:KaiTi_GB2312;">调用服务测试：</span></p><span style="font-family:KaiTi_GB2312;"></span><pre name="code" class="java">package com.alibaba.dubbo.demo.pp;

import java.util.List;

import org.springframework.context.support.ClassPathXmlApplicationContext;

import com.unj.dubbotest.provider.DemoService;

public class Consumer {

	public static void main(String[] args) throws Exception {
		ClassPathXmlApplicationContext context = new ClassPathXmlApplicationContext(
				new String[] { &quot;applicationContext.xml&quot; });
		context.start();

		DemoService demoService = (DemoService) context.getBean(&quot;demoService&quot;);
		String hello = demoService.sayHello(&quot;hejingyuan&quot;);
		System.out.println(hello);

		List list = demoService.getUsers();
		if (list != null &amp;&amp; list.size() &gt; 0) {
			for (int i = 0; i &lt; list.size(); i++) {
				System.out.println(list.get(i));
			}
		}
		System.in.read();
	}

}
</pre><br><p style="margin: 0in; font-size: 14pt;"><span style="font-family:KaiTi_GB2312;">测试结果：<br></span></p><p style="margin: 0in; font-size: 14pt;"><span style="font-family:KaiTi_GB2312;"><br></span></p><p style="margin: 0in; font-size: 14pt;"><span style="font-family:KaiTi_GB2312;"><img src="48117679273538" alt=""><br></span></p><p style="margin: 0in; font-size: 14pt;"><span style="font-family:KaiTi_GB2312;"><br></span></p><h1 style="margin:0in;font-size:14.0pt"><span style="font-family:KaiTi_GB2312;"><span lang="zh-CN">附：</span><span lang="en-US">Dubbo</span><span lang="zh-CN">的管理页面</span></span></h1><p style="margin: 0in; font-size: 14pt;"><span style="font-family:KaiTi_GB2312;">&nbsp;</span></p><p style="margin: 0in; font-size: 14pt;"><span style="font-family:KaiTi_GB2312;"><span lang="zh-CN">需要下载：dubbo-admin-2.5.3的</span><span lang="en-US">war</span><span lang="zh-CN">包</span></span></p><p style="margin: 0in; font-size: 14pt;"><span style="font-family:KaiTi_GB2312;">下载地址：<a target="_blank" target="_blank" href="http://download.csdn.net/detail/u013286716/7041185">http://download.csdn.net/detail/u013286716/7041185</a></span></p><p style="margin: 0in; font-size: 14pt;"><span style="font-family:KaiTi_GB2312;">&nbsp;</span></p><p style="margin: 0in; font-size: 14pt;"><span style="font-family:KaiTi_GB2312;">操作如下：</span></p><p style="margin: 0in; font-size: 14pt;"><span style="font-family:KaiTi_GB2312;"><br></span></p><p style="margin:0in;font-size:14.0pt"><span style="font-family:KaiTi_GB2312;"><span lang="en-US">1</span><span lang="zh-CN">，替换掉tomcat/webapps下自带的ROOT文件夹内容（即替换tomcat的启动主页），将下载的war包解压到webapps/ROOT中，直接替换即可</span></span></p><p style="margin: 0in; font-size: 14pt;"><span style="font-family:KaiTi_GB2312;">&nbsp;</span></p><p style="margin:0in;font-size:14.0pt"><span style="font-family:KaiTi_GB2312;"><span lang="zh-CN">&nbsp; &nbsp;注意：</span><span lang="en-US">jdk</span><span lang="zh-CN">不要使用</span><span lang="en-US">1.8</span><span lang="zh-CN">，本次实验使用的为</span><span lang="en-US">1.6</span></span></p><p style="margin: 0in; font-size: 14pt;" lang="en-US"><span style="font-family:KaiTi_GB2312;">&nbsp;</span></p><p style="margin:0in;font-size:14.0pt"><span style="font-family:KaiTi_GB2312;"><span lang="en-US">2</span><span lang="zh-CN">，启动</span><span lang="en-US">tomcat</span><span lang="zh-CN">，访问</span><span lang="en-US">ip:8080</span><span lang="zh-CN">即可或者如果是本地的话使用</span><span lang="en-US">localhost:8080</span></span></p><p style="margin: 0in; font-size: 14pt;"><span style="font-family:KaiTi_GB2312;">输入用户名密码，在E:\apache-tomcat-7.0.6-dubbo\webapps\ROOT\WEB-INF下的dubbo.properties文件中即可查看到，如：</span></p><p><img src="238077210330201" alt=""><br></p><p><span style="font-family:KaiTi_GB2312;"><br></span></p><p style="margin: 0in; font-size: 14pt;"><span style="font-family:KaiTi_GB2312;"><span lang="en-US">3</span><span lang="zh-CN">，访问</span><span lang="en-US"> </span><span lang="zh-CN"><a target="_blank" target="_blank" href="http://192.168.24.213:38080/">http://192.168.24.213:38080/</a></span><br></span></p><p style="margin: 0in; font-size: 14pt;"><span style="font-family:KaiTi_GB2312;"><br></span></p><p style="margin: 0in; font-size: 14pt;"><span style="font-family:KaiTi_GB2312;"><img src="34631687899433" alt=""><br></span></p><p style="margin: 0in; font-size: 14pt;"><span style="font-family:KaiTi_GB2312;"><br></span></p><p style="margin: 0in; font-size: 14pt;"><p style="margin:0in;font-size:14.0pt"><span style="font-family:KaiTi_GB2312;"><span lang="en-US">4</span><span lang="zh-CN">，启动我们的服务提供者和消费者即可查看到</span></span></p><p style="margin:0in;font-size:14.0pt"><span style="font-family:KaiTi_GB2312;"><span lang="zh-CN"><br></span></span></p><span style="font-family:KaiTi_GB2312;"><img src="38139476411392" alt=""><br></span><p style="margin: 0in; font-size: 14pt;"><span style="font-family:KaiTi_GB2312;"><img src="20104418135681" alt=""></span></p><p style="margin: 0in; font-size: 14pt;"><span style="font-family: KaiTi_GB2312; font-size: 14pt;">&nbsp;</span></p><h1 style="margin:0in;font-size:14.0pt"><span style="font-family: KaiTi_GB2312;"><span lang="zh-CN">整体说明</span><span lang="en-US">：</span></span></h1><p style="margin:0in;font-size:14.0pt"><span style="font-family:KaiTi_GB2312;"><span lang="en-US">&nbsp; &nbsp;&nbsp;</span></span></p><p style="margin:0in;font-size:14.0pt"><span style="font-family:KaiTi_GB2312;"><span lang="en-US">&nbsp; &nbsp; Zookeeper</span><span lang="zh-CN">（注册中心）部署到</span><span lang="en-US">213</span><span lang="zh-CN">的机子上，服务提供者和服务消费者均在</span><span lang="en-US">215</span><span lang="zh-CN">的机子上运行，当然我们也可以分别将服务提供者和服务消费者部署到不同的两台机子上。</span></span></p><span style="font-family:KaiTi_GB2312;"><br></span><p style="margin: 0in; font-size: 14pt;"><span style="font-family:KaiTi_GB2312;">优点：</span></p><p style="margin: 0in; font-size: 14pt;"><span style="font-family:KaiTi_GB2312;">&nbsp; &nbsp; 服务提供者和服务消费者只需要知道注册中心即可，它们之间打交道需通过注册中心这个第三方，只要是注册中心中已经注册的服务，我们均可以使用，实现了服务提供者和服务消费者间的解耦。</span></p><p style="margin: 0in; font-size: 14pt;"><span style="font-family:KaiTi_GB2312;"><br></span></p><p style="margin:0in;font-family:宋体;font-size:14.0pt"><br></p><p style="margin:0in;font-family:宋体;font-size:14.0pt"><br></p>   
</div><div class="ArcitleLink"><a href='http://blog.csdn.net/hejingyuan6/article/details/47403299'>原文链接</a>