<div style="color:blue" align=center>【应用篇】Activiti监听与业务颗粒结合的简单应用(一)</div><br><div id="article_content" class="article_content tracking-ad" data-mod="popu_307" data-dsm="post">
<p style="margin:0in;font-size:14.0pt"><span style="font-family:KaiTi_GB2312;"><span lang="en-US">Activiti</span><span lang="zh-CN">的简单应用，应用监听来实现简单的业务颗粒与工作流程结合，让流程带动业务颗粒执行的过程。</span></span></p><p style="margin: 0in; font-size: 14pt;"><span style="font-family:KaiTi_GB2312;">&nbsp;</span></p><p style="margin: 0in; font-size: 14pt;"><span style="font-family:KaiTi_GB2312;">新建一个普通类</span></p><p style="margin: 0in; font-size: 14pt;"><span style="font-family:KaiTi_GB2312;"></span></p><pre name="code" class="java">package com.tgb.itoo.activiti.controller;

public class jy {

	public static void SayHello(){
		System.out.println(&quot;jingyuan88&quot;);
	}
}</pre><p><p style="margin: 0in; font-size: 14pt;"><p style="margin: 0in; font-size: 14pt;"><span style="font-family:KaiTi_GB2312;">新建一个监听类</span></p><span style="font-family:KaiTi_GB2312;"></span><pre name="code" class="java">package com.tgb.itoo.activiti.controller;

import org.activiti.engine.delegate.DelegateTask;
import org.activiti.engine.delegate.TaskListener;

public class jingyuanDelegate implements TaskListener{
	
	@Override
	public void notify(DelegateTask delegateTask) {		
		jy.SayHello();
	}
	
}
</pre><br><br><p style="margin: 0in; font-size: 14pt;"><p style="margin: 0in; font-size: 14pt;"><span style="font-family:KaiTi_GB2312;">类似的再建两个类（ghy，xs）与两个监听（guhaiyanDelegate，xvshuDelegate）</span></p><p style="margin: 0in; font-size: 14pt;"><span style="font-family:KaiTi_GB2312;">&nbsp;</span></p><p style="margin: 0in; font-size: 14pt;"><span style="font-family:KaiTi_GB2312;">画如下流程图：</span></p><span style="font-family:KaiTi_GB2312;"><img src="188455310206554" alt=""><br></span><p style="margin: 0in; font-size: 14pt;"><p style="margin: 0in; font-size: 14pt;"><span style="font-family:KaiTi_GB2312;">配置相应的属性</span></p><p style="margin: 0in; font-size: 14pt;"><span style="font-family:KaiTi_GB2312;">&nbsp;</span></p><p style="margin:0in;font-size:14.0pt"><span style="font-family:KaiTi_GB2312;"><span lang="zh-CN">每个类上添加相应的监听</span><span lang="en-US"> </span><span lang="zh-CN">如图：</span></span></p><p style="margin:0in;font-size:14.0pt"><span style="font-family:KaiTi_GB2312;"><span lang="zh-CN"><img src="32769916583671" alt=""><br></span></span></p><span style="font-family:KaiTi_GB2312;"><br></span><p style="margin: 0in; font-size: 14pt;"><p style="margin:0in;font-size:14.0pt"><span style="font-family:KaiTi_GB2312;"><span lang="zh-CN">给每条流向添加变量</span><span lang="en-US"> </span><span lang="zh-CN">如图：</span></span></p><span style="font-family:KaiTi_GB2312;"><img src="36487759012877" alt=""><br></span><p style="margin: 0in; font-size: 14pt;"><p style="margin:0in;font-size:14.0pt"><span style="font-family:KaiTi_GB2312;"><span lang="zh-CN"><br></span></span></p><p style="margin:0in;font-size:14.0pt"><span style="font-family:KaiTi_GB2312;"><span lang="zh-CN">最终生成的配置文件</span><span lang="en-US"> </span><span lang="zh-CN">如下：</span></span></p><p style="margin:0in;font-size:14.0pt"><span style="font-family:KaiTi_GB2312;"><span lang="zh-CN"><br></span></span></p><span style="font-family:KaiTi_GB2312;"></span><pre name="code" class="html">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;definitions xmlns=&quot;http://www.omg.org/spec/BPMN/20100524/MODEL&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xmlns:xsd=&quot;http://www.w3.org/2001/XMLSchema&quot; xmlns:activiti=&quot;http://activiti.org/bpmn&quot; xmlns:bpmndi=&quot;http://www.omg.org/spec/BPMN/20100524/DI&quot; xmlns:omgdc=&quot;http://www.omg.org/spec/DD/20100524/DC&quot; xmlns:omgdi=&quot;http://www.omg.org/spec/DD/20100524/DI&quot; typeLanguage=&quot;http://www.w3.org/2001/XMLSchema&quot; expressionLanguage=&quot;http://www.w3.org/1999/XPath&quot; targetNamespace=&quot;http://www.activiti.org/test&quot;&gt;
  &lt;process id=&quot;myProcess&quot; name=&quot;My process&quot; isExecutable=&quot;true&quot;&gt;
    &lt;startEvent id=&quot;startevent1&quot; name=&quot;Start&quot;&gt;&lt;/startEvent&gt;
    &lt;userTask id=&quot;xvshu&quot; name=&quot;xvshu&quot;&gt;
      &lt;extensionElements&gt;
        &lt;activiti:taskListener event=&quot;create&quot; class=&quot;com.tgb.itoo.activiti.controller.xvshuDelegate&quot;&gt;&lt;/activiti:taskListener&gt;
      &lt;/extensionElements&gt;
    &lt;/userTask&gt;
    &lt;sequenceFlow id=&quot;flow1&quot; sourceRef=&quot;startevent1&quot; targetRef=&quot;xvshu&quot;&gt;&lt;/sequenceFlow&gt;
    &lt;userTask id=&quot;jingyuan&quot; name=&quot;jingyuan&quot;&gt;
      &lt;extensionElements&gt;
        &lt;activiti:taskListener event=&quot;create&quot; class=&quot;com.tgb.itoo.activiti.controller.jingyuanDelegate&quot;&gt;&lt;/activiti:taskListener&gt;
      &lt;/extensionElements&gt;
    &lt;/userTask&gt;
    &lt;userTask id=&quot;usertask1&quot; name=&quot;guhaiyan&quot;&gt;
      &lt;extensionElements&gt;
        &lt;activiti:taskListener event=&quot;create&quot; class=&quot;com.tgb.itoo.activiti.controller.guhaiyanDelegate&quot;&gt;&lt;/activiti:taskListener&gt;
      &lt;/extensionElements&gt;
    &lt;/userTask&gt;
    &lt;endEvent id=&quot;endevent1&quot; name=&quot;End&quot;&gt;&lt;/endEvent&gt;
    &lt;sequenceFlow id=&quot;flow4&quot; sourceRef=&quot;usertask1&quot; targetRef=&quot;endevent1&quot;&gt;&lt;/sequenceFlow&gt;
    &lt;exclusiveGateway id=&quot;exclusivegateway1&quot; name=&quot;Exclusive Gateway&quot;&gt;&lt;/exclusiveGateway&gt;
    &lt;sequenceFlow id=&quot;flow5&quot; sourceRef=&quot;xvshu&quot; targetRef=&quot;exclusivegateway1&quot;&gt;&lt;/sequenceFlow&gt;
    &lt;sequenceFlow id=&quot;flow6&quot; name=&quot;同意&quot; sourceRef=&quot;exclusivegateway1&quot; targetRef=&quot;jingyuan&quot;&gt;
      &lt;conditionExpression xsi:type=&quot;tFormalExpression&quot;&gt;&lt;![CDATA[${result}]]&gt;&lt;/conditionExpression&gt;
    &lt;/sequenceFlow&gt;
    &lt;sequenceFlow id=&quot;flow7&quot; name=&quot;不同意&quot; sourceRef=&quot;exclusivegateway1&quot; targetRef=&quot;endevent1&quot;&gt;
      &lt;conditionExpression xsi:type=&quot;tFormalExpression&quot;&gt;&lt;![CDATA[${!result}]]&gt;&lt;/conditionExpression&gt;
    &lt;/sequenceFlow&gt;
    &lt;exclusiveGateway id=&quot;exclusivegateway2&quot; name=&quot;Exclusive Gateway&quot;&gt;&lt;/exclusiveGateway&gt;
    &lt;sequenceFlow id=&quot;flow8&quot; sourceRef=&quot;jingyuan&quot; targetRef=&quot;exclusivegateway2&quot;&gt;&lt;/sequenceFlow&gt;
    &lt;sequenceFlow id=&quot;flow9&quot; name=&quot;同意&quot; sourceRef=&quot;exclusivegateway2&quot; targetRef=&quot;usertask1&quot;&gt;
      &lt;conditionExpression xsi:type=&quot;tFormalExpression&quot;&gt;&lt;![CDATA[${result}]]&gt;&lt;/conditionExpression&gt;
    &lt;/sequenceFlow&gt;
    &lt;sequenceFlow id=&quot;flow10&quot; name=&quot;不同意&quot; sourceRef=&quot;exclusivegateway2&quot; targetRef=&quot;endevent1&quot;&gt;
      &lt;conditionExpression xsi:type=&quot;tFormalExpression&quot;&gt;&lt;![CDATA[${!result}]]&gt;&lt;/conditionExpression&gt;
    &lt;/sequenceFlow&gt;
  &lt;/process&gt;
  &lt;bpmndi:BPMNDiagram id=&quot;BPMNDiagram_myProcess&quot;&gt;
    &lt;bpmndi:BPMNPlane bpmnElement=&quot;myProcess&quot; id=&quot;BPMNPlane_myProcess&quot;&gt;
      &lt;bpmndi:BPMNShape bpmnElement=&quot;startevent1&quot; id=&quot;BPMNShape_startevent1&quot;&gt;
        &lt;omgdc:Bounds height=&quot;35.0&quot; width=&quot;35.0&quot; x=&quot;70.0&quot; y=&quot;150.0&quot;&gt;&lt;/omgdc:Bounds&gt;
      &lt;/bpmndi:BPMNShape&gt;
      &lt;bpmndi:BPMNShape bpmnElement=&quot;xvshu&quot; id=&quot;BPMNShape_xvshu&quot;&gt;
        &lt;omgdc:Bounds height=&quot;55.0&quot; width=&quot;105.0&quot; x=&quot;150.0&quot; y=&quot;140.0&quot;&gt;&lt;/omgdc:Bounds&gt;
      &lt;/bpmndi:BPMNShape&gt;
      &lt;bpmndi:BPMNShape bpmnElement=&quot;jingyuan&quot; id=&quot;BPMNShape_jingyuan&quot;&gt;
        &lt;omgdc:Bounds height=&quot;55.0&quot; width=&quot;105.0&quot; x=&quot;410.0&quot; y=&quot;140.0&quot;&gt;&lt;/omgdc:Bounds&gt;
      &lt;/bpmndi:BPMNShape&gt;
      &lt;bpmndi:BPMNShape bpmnElement=&quot;usertask1&quot; id=&quot;BPMNShape_usertask1&quot;&gt;
        &lt;omgdc:Bounds height=&quot;55.0&quot; width=&quot;105.0&quot; x=&quot;710.0&quot; y=&quot;140.0&quot;&gt;&lt;/omgdc:Bounds&gt;
      &lt;/bpmndi:BPMNShape&gt;
      &lt;bpmndi:BPMNShape bpmnElement=&quot;endevent1&quot; id=&quot;BPMNShape_endevent1&quot;&gt;
        &lt;omgdc:Bounds height=&quot;35.0&quot; width=&quot;35.0&quot; x=&quot;745.0&quot; y=&quot;270.0&quot;&gt;&lt;/omgdc:Bounds&gt;
      &lt;/bpmndi:BPMNShape&gt;
      &lt;bpmndi:BPMNShape bpmnElement=&quot;exclusivegateway1&quot; id=&quot;BPMNShape_exclusivegateway1&quot;&gt;
        &lt;omgdc:Bounds height=&quot;40.0&quot; width=&quot;40.0&quot; x=&quot;300.0&quot; y=&quot;147.0&quot;&gt;&lt;/omgdc:Bounds&gt;
      &lt;/bpmndi:BPMNShape&gt;
      &lt;bpmndi:BPMNShape bpmnElement=&quot;exclusivegateway2&quot; id=&quot;BPMNShape_exclusivegateway2&quot;&gt;
        &lt;omgdc:Bounds height=&quot;40.0&quot; width=&quot;40.0&quot; x=&quot;560.0&quot; y=&quot;148.0&quot;&gt;&lt;/omgdc:Bounds&gt;
      &lt;/bpmndi:BPMNShape&gt;
      &lt;bpmndi:BPMNEdge bpmnElement=&quot;flow1&quot; id=&quot;BPMNEdge_flow1&quot;&gt;
        &lt;omgdi:waypoint x=&quot;105.0&quot; y=&quot;167.0&quot;&gt;&lt;/omgdi:waypoint&gt;
        &lt;omgdi:waypoint x=&quot;150.0&quot; y=&quot;167.0&quot;&gt;&lt;/omgdi:waypoint&gt;
      &lt;/bpmndi:BPMNEdge&gt;
      &lt;bpmndi:BPMNEdge bpmnElement=&quot;flow4&quot; id=&quot;BPMNEdge_flow4&quot;&gt;
        &lt;omgdi:waypoint x=&quot;762.0&quot; y=&quot;195.0&quot;&gt;&lt;/omgdi:waypoint&gt;
        &lt;omgdi:waypoint x=&quot;762.0&quot; y=&quot;270.0&quot;&gt;&lt;/omgdi:waypoint&gt;
      &lt;/bpmndi:BPMNEdge&gt;
      &lt;bpmndi:BPMNEdge bpmnElement=&quot;flow5&quot; id=&quot;BPMNEdge_flow5&quot;&gt;
        &lt;omgdi:waypoint x=&quot;255.0&quot; y=&quot;167.0&quot;&gt;&lt;/omgdi:waypoint&gt;
        &lt;omgdi:waypoint x=&quot;300.0&quot; y=&quot;167.0&quot;&gt;&lt;/omgdi:waypoint&gt;
      &lt;/bpmndi:BPMNEdge&gt;
      &lt;bpmndi:BPMNEdge bpmnElement=&quot;flow6&quot; id=&quot;BPMNEdge_flow6&quot;&gt;
        &lt;omgdi:waypoint x=&quot;340.0&quot; y=&quot;167.0&quot;&gt;&lt;/omgdi:waypoint&gt;
        &lt;omgdi:waypoint x=&quot;410.0&quot; y=&quot;167.0&quot;&gt;&lt;/omgdi:waypoint&gt;
        &lt;bpmndi:BPMNLabel&gt;
          &lt;omgdc:Bounds height=&quot;14.0&quot; width=&quot;24.0&quot; x=&quot;350.0&quot; y=&quot;167.0&quot;&gt;&lt;/omgdc:Bounds&gt;
        &lt;/bpmndi:BPMNLabel&gt;
      &lt;/bpmndi:BPMNEdge&gt;
      &lt;bpmndi:BPMNEdge bpmnElement=&quot;flow7&quot; id=&quot;BPMNEdge_flow7&quot;&gt;
        &lt;omgdi:waypoint x=&quot;320.0&quot; y=&quot;187.0&quot;&gt;&lt;/omgdi:waypoint&gt;
        &lt;omgdi:waypoint x=&quot;320.0&quot; y=&quot;287.0&quot;&gt;&lt;/omgdi:waypoint&gt;
        &lt;omgdi:waypoint x=&quot;745.0&quot; y=&quot;287.0&quot;&gt;&lt;/omgdi:waypoint&gt;
        &lt;bpmndi:BPMNLabel&gt;
          &lt;omgdc:Bounds height=&quot;14.0&quot; width=&quot;36.0&quot; x=&quot;330.0&quot; y=&quot;243.0&quot;&gt;&lt;/omgdc:Bounds&gt;
        &lt;/bpmndi:BPMNLabel&gt;
      &lt;/bpmndi:BPMNEdge&gt;
      &lt;bpmndi:BPMNEdge bpmnElement=&quot;flow8&quot; id=&quot;BPMNEdge_flow8&quot;&gt;
        &lt;omgdi:waypoint x=&quot;515.0&quot; y=&quot;167.0&quot;&gt;&lt;/omgdi:waypoint&gt;
        &lt;omgdi:waypoint x=&quot;560.0&quot; y=&quot;168.0&quot;&gt;&lt;/omgdi:waypoint&gt;
      &lt;/bpmndi:BPMNEdge&gt;
      &lt;bpmndi:BPMNEdge bpmnElement=&quot;flow9&quot; id=&quot;BPMNEdge_flow9&quot;&gt;
        &lt;omgdi:waypoint x=&quot;600.0&quot; y=&quot;168.0&quot;&gt;&lt;/omgdi:waypoint&gt;
        &lt;omgdi:waypoint x=&quot;710.0&quot; y=&quot;167.0&quot;&gt;&lt;/omgdi:waypoint&gt;
        &lt;bpmndi:BPMNLabel&gt;
          &lt;omgdc:Bounds height=&quot;14.0&quot; width=&quot;24.0&quot; x=&quot;610.0&quot; y=&quot;168.0&quot;&gt;&lt;/omgdc:Bounds&gt;
        &lt;/bpmndi:BPMNLabel&gt;
      &lt;/bpmndi:BPMNEdge&gt;
      &lt;bpmndi:BPMNEdge bpmnElement=&quot;flow10&quot; id=&quot;BPMNEdge_flow10&quot;&gt;
        &lt;omgdi:waypoint x=&quot;580.0&quot; y=&quot;188.0&quot;&gt;&lt;/omgdi:waypoint&gt;
        &lt;omgdi:waypoint x=&quot;580.0&quot; y=&quot;287.0&quot;&gt;&lt;/omgdi:waypoint&gt;
        &lt;omgdi:waypoint x=&quot;745.0&quot; y=&quot;287.0&quot;&gt;&lt;/omgdi:waypoint&gt;
        &lt;bpmndi:BPMNLabel&gt;
          &lt;omgdc:Bounds height=&quot;14.0&quot; width=&quot;36.0&quot; x=&quot;590.0&quot; y=&quot;243.0&quot;&gt;&lt;/omgdc:Bounds&gt;
        &lt;/bpmndi:BPMNLabel&gt;
      &lt;/bpmndi:BPMNEdge&gt;
    &lt;/bpmndi:BPMNPlane&gt;
  &lt;/bpmndi:BPMNDiagram&gt;
&lt;/definitions&gt;
</pre><br><p style="margin: 0in; font-size: 14pt;"><p style="margin: 0in; font-size: 14pt;"><span style="font-family:KaiTi_GB2312;">启动流程对应的代码：</span></p><p style="margin: 0in; font-size: 14pt;"><span style="font-family:KaiTi_GB2312;"><br></span></p><span style="font-family:KaiTi_GB2312;"></span><pre name="code" class="java">import java.io.BufferedReader;
import java.io.IOException;
import java.io.InputStreamReader;
import java.util.HashMap;
import java.util.Map;

import org.activiti.engine.ProcessEngine;
import org.activiti.engine.ProcessEngineConfiguration;
import org.activiti.engine.RepositoryService;
import org.activiti.engine.RuntimeService;
import org.activiti.engine.TaskService;
import org.activiti.engine.runtime.ProcessInstance;
import org.activiti.engine.task.Task;

public class testDemo {

	private static String readDataFromConsole(String prompt) {
		BufferedReader br = new BufferedReader(new InputStreamReader(System.in));
		String str = null;
		try {
			System.out.print(prompt);
			str = br.readLine();

		} catch (IOException e) {
			e.printStackTrace();
		}
		return str;
	}

	public static void main(String[] args) {

		String str = readDataFromConsole(&quot;Please input string：&quot;);
		System.out.println(&quot;The information from console： &quot; + str);
		// 创建流程引擎		
		ProcessEngineConfiguration processEngineConfiguration = ProcessEngineConfiguration
				.createStandaloneProcessEngineConfiguration();
		// 连接数据库的配置
		processEngineConfiguration.setJdbcDriver(&quot;com.mysql.jdbc.Driver&quot;);
		processEngineConfiguration
				.setJdbcUrl(&quot;jdbc:mysql://localhost:3306/activitiexam?useUnicode=true&amp;characterEncoding=utf8&quot;);
		processEngineConfiguration.setJdbcUsername(&quot;root&quot;);
		processEngineConfiguration.setJdbcPassword(&quot;root&quot;);
		ProcessEngine processEngine = processEngineConfiguration
				.buildProcessEngine();

		System.out.println(processEngine);
		// 获取流程存储服务组件
		RepositoryService repositoryService = processEngine
				.getRepositoryService();

		// 获取运行时服务组件
		RuntimeService runtimeService = processEngine.getRuntimeService();

		// 获取流程任务组件
		TaskService taskService = processEngine.getTaskService();

		// 1、部署流程文件
		repositoryService.createDeployment().name(&quot;MyProcess&quot;)
				.addClasspathResource(&quot;diagrams/&quot; + str + &quot;.bpmn&quot;).deploy();

		// 2、启动流程
		ProcessInstance processInstance = runtimeService
				.startProcessInstanceByKey(&quot;myProcess&quot;);
		String end=&quot;1&quot;;//processInstance.getId() != null
		while (end.equalsIgnoreCase(&quot;1&quot;)) {
			// 3、查询第一个任务
			Task task = taskService.createTaskQuery()
					.processInstanceId(processInstance.getId()).singleResult();
			;
			if (task != null) {
				System.out.println(&quot;============&quot; + task.getId()
						+ &quot;============&quot; + task.getName() + &quot;============&quot;);
				str = readDataFromConsole(&quot;Please input result:&quot;);
				Map&lt;String, Object&gt; variables = new HashMap&lt;String, Object&gt;();
				Boolean result;
				if (str.equalsIgnoreCase(&quot;true&quot;)) {
					result = true;
				} else {
					result = false;

				}
				variables.put(&quot;result&quot;, result);
				taskService.complete(task.getId(), variables); // 完成任务

			}else {
				end=&quot;0&quot;;
				System.out.println(&quot;任务已经完成&quot;);
			} 

		}

	}

}
</pre><br><br><p style="margin: 0in; font-size: 14pt;"><p style="margin: 0in; font-size: 14pt;"><span style="font-family:KaiTi_GB2312;">执行结果：</span></p><p style="margin: 0in; font-size: 14pt;"><span style="font-family:KaiTi_GB2312;"><br></span></p><span style="font-family:KaiTi_GB2312;"><img src="37735465368741" alt=""><br></span><p style="margin: 0in; font-size: 14pt;"><p style="margin: 0in; font-size: 14pt;"><span style="font-family:KaiTi_GB2312;"><br></span></p><p style="margin: 0in; font-size: 14pt;"><span style="font-family:KaiTi_GB2312;">总结：</span></p><p style="margin: 0in; font-size: 14pt;"><span style="font-family:KaiTi_GB2312;">&nbsp;</span></p><p style="margin: 0in; font-size: 14pt;"><span style="font-family:KaiTi_GB2312;">以上简单的拖拽实现是依赖于监听实现，监听的实现就必须实现相应的接口，这样对我们的业务颗粒就有所要求，当然以上只是简单实现，而且实现的方式是一个类对应一个监听，接下来会继续完善，应用多个类对应一个监听来实现。</span></p><p style="margin: 0in; font-size: 14pt;"><span style="font-family:KaiTi_GB2312;">&nbsp;</span></p><p><br></p><p><br></p>   
</div><div class="ArcitleLink"><a href='http://blog.csdn.net/hejingyuan6/article/details/46288957'>原文链接</a>