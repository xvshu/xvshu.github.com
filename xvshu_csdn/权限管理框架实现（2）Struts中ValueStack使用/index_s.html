<div class="articleLocationOnion"><a href='../../index.html'>首页: </a> &gt; <a href='../index_s.html'>未分类</a> &gt; 权限管理框架实现（2）Struts中ValueStack使用</div><div style="color:blue" align=center>权限管理框架实现（2）Struts中ValueStack使用</div><br><div id="article_content" class="article_content tracking-ad" data-mod="popu_307" data-dsm="post">
<p><span style="font-size:18px;">&nbsp; &nbsp; &nbsp; &nbsp; 众所周知，struts中，数据交互是走的ValueStack，在权限交互中，我们有些数据，存储到ValueStack中，更容易被用户利用，用户可以在jsp或者其他框架下，利用已有的数据，让前台不需要关心权限数据是如何存储的，只需要关心我们某一个权限标示是否被通过了，这是如何实现的呢？大家看源码。</span></p><p><span style="font-size:18px;"><br></span></p><h1><span style="font-size:18px;">1，生命周期</span></h1><p><span style="font-size:18px;">&nbsp; &nbsp; &nbsp; &nbsp; 在struts-default.xml文件中决定了在web容器启动时将会创建OgnlValueStackFactory对象，该对象实现了ValueStackFactory接口，负责ValueStack的创建工作。ValueStack的生命周期是随着request的创建而创建，随request的销毁而销毁。具体可见源代码：在PrepareOperations类的createActionContext<br>&nbsp; &nbsp; &nbsp; &nbsp; 至于清理工作，struts统一放在了PrepareOperations类的cleanupRequest方法中。<br></span></p><p><span style="font-size:18px;"><br></span></p><h1><span style="font-size:18px;">2，数据结构</span></h1><p><span style="font-size:18px;">&nbsp; &nbsp; &nbsp; &nbsp; 实际不需多说，大家写jsp源码时，可以预见，这是种map类型的机构，符合OGNL特点，或者说struts实现了OGNL</span></p><p><span style="font-size:18px;">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;<img src="3932628821941" alt=""></span></p><p><span style="font-size:18px;"><br></span></p><p><span style="font-size:18px;">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;CompoundRoot继承了ArrayList类，即是一个List集合，详见源码CompoundRoot类。<br>&nbsp; &nbsp; &nbsp; &nbsp; Context:而context实际上是一个hashMap</span></p><p><span style="font-size:18px;"><br></span></p><h1><span style="font-size:18px;">3，例子</span></h1><p><span style="font-size:18px;">&nbsp; &nbsp; &nbsp; &nbsp; 知道原理之后，使用就变得非常简单</span></p><p><span style="font-size:18px;"><br></span></p><p><span style="font-size:18px;">添加</span></p><p><span style="font-size:18px;"></span><pre code_snippet_id="1643570" snippet_file_name="blog_20160412_1_738304" name="code" class="java"><span style="font-size:18px;">private void toVm(Result result){
        ValueStack context = ActionContext.getContext().getValueStack();
        Set set = result.keySet();
        Iterator resultCode = set.iterator();
        context.set(&quot;textProvider&quot;, this);
        context.set(&quot;datePickerLocale&quot;, this.getDatePickerLocale());

        String text;
        while(resultCode.hasNext()) {
            text = (String)resultCode.next();
            context.set(text, result.get(text));
        }
    }</span></pre></p><p><span style="font-size:18px;"><br></span></p><span style="font-size:18px;">获取</span><pre code_snippet_id="1643570" snippet_file_name="blog_20160412_2_6692122" name="code" class="java"><span style="font-size:18px;">private String getFromVm(String authCode){
        ValueStack context = ActionContext.getContext().getValueStack();
        Map map = (Map)context.peek();
        String result = ((Boolean)map.get(authCode)).toString();
        return result;
    }</span></pre><span style="font-size:18px;"><br></span><p><span style="font-size:18px;">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;<img src="13161648186673" alt=""><br>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></p><p><span style="font-size:18px;"><br></span></p><p><span style="font-size:18px;"><br></span></p><h1><span style="font-size:18px;">4，前台</span></h1><p><span style="font-size:18px;">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;由于前台使用的是velocity进行组合，所以，获取值的时候，需要写如下代码：</span></p><p><pre code_snippet_id="1643570" snippet_file_name="blog_20160412_3_4042163" name="code" class="html"><span style="font-size:18px;">#if($!{auth_el_net_testauth_add})
    &lt;input type=&quot;button&quot; style=&quot;width:100px;&quot; value=&quot;添加&quot;&gt;&lt;/input&gt;
#end</span></pre></p><p><span style="font-size:18px;"><br></span></p><h1><span style="font-size:18px;">总结</span></h1><p><span style="font-size:18px;">&nbsp; &nbsp; &nbsp; &nbsp; 非常简单的例子，第一步将我们需要实现的功能进行了整合，但是还是不够简单，我们应该提供一种更简单的接入方式，前台开发只需要引入js，使用特殊标签将资源包裹，就能自动判断，这种方案，我们下片博客介绍</span></p><p><span style="font-size:18px;"><br></span></p><p><br></p>   
</div><div class="ArcitleLink"><a href='http://blog.csdn.net/xvshu/article/details/51133220'>原文链接</a>