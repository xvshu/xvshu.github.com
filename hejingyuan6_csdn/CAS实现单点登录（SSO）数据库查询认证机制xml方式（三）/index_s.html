<div class="articleLocationOnion"><a href='../../index.html'>首页: </a> &gt; <a href='../index_s.html'>未分类</a> &gt; CAS实现单点登录（SSO）数据库查询认证机制xml方式（三）</div><div style="color:blue" align=center>CAS实现单点登录（SSO）数据库查询认证机制xml方式（三）</div><br><div id="article_content" class="article_content tracking-ad" data-mod="popu_307" data-dsm="post">

<p style="margin:0in; font-size:14.0pt"><span lang="zh-CN"><span style="font-family:KaiTi_GB2312"><br>
</span></span></p>
<p style="margin:0in; font-size:14.0pt"><span style="font-family:KaiTi_GB2312"><span lang="zh-CN">继前面介绍过基于CAS实现单点登录（SSO）的实例演示，演示过程中服务端认证机制采用的是默认配置即</span><span lang="en-US">CAS Servier</span><span lang="zh-CN">默认用户名和密码一致即可登录成功，那么本文将侧重于应用方面，真正通过查询用户名密码来进程验证用户是否可以登录。</span></span></p>
<p style="margin:0in; font-size:14pt"><span style="font-family:KaiTi_GB2312">&nbsp;</span></p>
<h1 style="margin:0in; font-size:14.0pt"><span style="font-family:KaiTi_GB2312"><span lang="en-US">CAS Server</span><span lang="zh-CN">添加相关的jar包</span><span style="font-size:14pt">&nbsp;</span></span></h1>
<p style="margin:0in; font-size:14pt"><span style="font-family:KaiTi_GB2312"><br>
</span></p>
<p style="margin:0in; font-size:14pt"><span style="font-family:KaiTi_GB2312">需要在web项目的lib下添加两个包：cas-server-support-jdbc-x.x.x.jar和 mysql-connector-java-x.x.x-bin.jar（具体版本号根据情况而定）</span></p>
<p style="margin:0in; font-size:14pt"><span style="font-family:KaiTi_GB2312"><br>
</span></p>
<p style="margin:0in; font-size:14pt"><span style="font-family:KaiTi_GB2312"><img src="8570148516115" alt=""><br>
</span></p>
<p style="margin:0in; font-size:14pt"><span style="font-family:KaiTi_GB2312"><br>
</span></p>
<h1 style="margin:0in; font-size:14.0pt"><span style="font-family:KaiTi_GB2312"><span lang="zh-CN">修改</span><span lang="en-US">CAS Server</span><span lang="zh-CN">的配置</span><span style="font-size:14pt">&nbsp;</span></span></h1>
<p><span style="font-size:14pt"><span style="font-family:KaiTi_GB2312"><br>
</span></span></p>
<p><span style="font-size:14pt"><span style="font-family:KaiTi_GB2312">在%tomcat_cas%/webapps/cas/WEB_INF/deployerConfigContext.xml找到如下信息：</span></span></p>
<p><span style="font-size:14pt"><span style="font-family:KaiTi_GB2312"><br>
</span></span></p>
<pre code_snippet_id="646702" snippet_file_name="blog_20150417_1_8776437" name="code" class="html">&lt;bean class=&quot;org.jasig.cas.authentication.handler.support.SimpleTestUsernamePasswordAuthenticationHandler&quot; /&gt;
&lt;/span&gt;</pre>
<p><span style="font-family:KaiTi_GB2312"><span style="font-size:18px">修改成如下：</span></span></p>
<pre code_snippet_id="646702" snippet_file_name="blog_20150417_2_3330671" name="code" class="html">&lt;bean class=&quot;org.jasig.cas.adaptors.jdbc.QueryDatabaseAuthenticationHandler&quot;&gt;
        &lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot; &gt;&lt;/property&gt;
        &lt;property name=&quot;sql&quot; value=&quot;select password from t_user where login_name=?&quot; &gt;&lt;/property&gt;
        &lt;!--&lt;property name=&quot;passwordEncoder&quot; ref=&quot;MD5PasswordEncoder&quot; &gt;&lt;/property&gt;--&gt;
&lt;/bean&gt;
&lt;/span&gt;</pre>
<p><span style="font-size:18px"><span style="font-family:KaiTi_GB2312">同时增加datasource和加密处理两个bean的定义：</span></span></p>
<pre code_snippet_id="646702" snippet_file_name="blog_20150417_3_3523862" name="code" class="html">&lt;bean id=&quot;dataSource&quot;
        class=&quot;org.springframework.jdbc.datasource.DriverManagerDataSource&quot;&gt;
        &lt;property name=&quot;driverClassName&quot; value=&quot;com.mysql.jdbc.Driver&quot; /&gt;
        &lt;property name=&quot;url&quot; value=&quot;jdbc:mysql://localhost/test&quot; /&gt;
        &lt;property name=&quot;username&quot; value=&quot;root&quot; /&gt;
        &lt;property name=&quot;password&quot; value=&quot;root&quot; /&gt;
&lt;/bean&gt;
&lt;bean id=&quot;MD5PasswordEncoder&quot;
        class=&quot;org.jasig.cas.authentication.handler.DefaultPasswordEncoder&quot;&gt;
        &lt;constructor-arg index=&quot;0&quot; value=&quot;MD5&quot; /&gt;
&lt;/bean&gt;
&lt;/span&gt;</pre>
<p><span style="font-family:KaiTi_GB2312"><span style="font-size:18px"><span style="font-size:19px"><br>
</span></span></span></p>
<p><span style="font-family:KaiTi_GB2312"><span style="font-size:18px"><span style="font-size:19px">修改后的效果：</span></span></span></p>
<p><span style="font-family:KaiTi_GB2312"><br>
</span></p>
<p style="margin:0in; font-size:14pt"><span style="font-family:KaiTi_GB2312"><img src="14109786188042" alt=""><br>
</span></p>
<p style="margin:0in; font-size:14pt"><span style="font-family:KaiTi_GB2312"><br>
</span></p>
<h1 style="margin:0in; font-size:14pt"><span style="font-family:KaiTi_GB2312">本地数据库中添加的数据信息：</span></h1>
<p>
<p style="margin:0in; font-size:14pt"><span style="font-family:KaiTi_GB2312"><br>
</span></p>
<p style="margin:0in; font-size:14pt"><span style="font-family:KaiTi_GB2312"><img src="1216068994197" alt=""><br>
</span></p>
<p style="margin:0in; font-size:14pt"><span style="font-family:KaiTi_GB2312"><br>
</span></p>
<p style="margin:0in; font-size:14pt"><span style="font-family:KaiTi_GB2312">演示效果：</span></p>
<p style="margin:0in; font-size:14pt"><span style="font-family:KaiTi_GB2312"><br>
</span></p>
<p style="margin:0in; font-size:14pt"><span style="font-family:KaiTi_GB2312"><img src="15583227678389" alt=""><br>
</span></p>
<p style="margin:0in; font-size:14pt">
<p style="margin:0in; font-size:14pt"><span style="font-family:KaiTi_GB2312"><img src="38490809527650" alt=""><br>
</span></p>
<p style="margin:0in; font-size:14pt"><span style="font-family:KaiTi_GB2312"><br>
</span></p>
<p style="margin:0in; font-size:14pt"><span style="font-family:KaiTi_GB2312">注意:</span></p>
<p style="margin:0in; font-size:14pt"><span style="font-family:KaiTi_GB2312"><br>
</span></p>
<p style="margin:0in; font-size:14pt"><span style="font-family:KaiTi_GB2312">&nbsp; &nbsp;1.密码加密过程，如果不用，注释掉即可。</span></p>
<p style="margin:0in; font-size:14pt"><span style="font-family:KaiTi_GB2312">&nbsp; &nbsp;2.QueryDatabaseAuthenticationHandler是cas-server-support-jdbc提供的查询接口其中一个是通过配置一个SQL 语句查出密码，与所给密码匹配；</span></p>
<p style="margin:0in; font-size:14pt"><span style="font-family:KaiTi_GB2312">&nbsp; &nbsp;3.sql语句就是查询哪一张表，本例根据t_user表的login_name字段查询密码，CAS会匹配用户输入的密码，如果匹配则通过；</span></p>
<p style="margin:0in; font-size:14pt"><span style="font-family:KaiTi_GB2312">&nbsp; &nbsp;4.passwordEncoder这个是处理密码的加密，如果想要你的应用中数据库保存的是加密过的，比如本例是使用MD5加密的，所以配置了MD5PasswordEncoder这个Handler，cas内置了MD5的功能所以只需要配置一下就可以了；如果在实际应用中使用的是公司自己的加密算法那么就需要自己写一个Handler来处理密码，实现方式也比较简单，创建一个类继承org.jasig.cas.authentication.handler.PasswordEncoder然后在encode方法中加密用户输入的密码然后返回即可。</span></p>
<p style="margin:0in; font-size:14pt"><span style="font-family:KaiTi_GB2312">&nbsp;</span></p>
<h1 style="margin:0in; font-size:14pt"><span style="font-family:KaiTi_GB2312">配置多个数据库</span></h1>
<p style="margin:0in; font-size:14pt"><span style="font-family:KaiTi_GB2312">&nbsp;</span></p>
<p style="margin:0in; font-size:14pt"><span style="font-family:KaiTi_GB2312">如果需要配置多个数据库，可以配置多个QueryDatabaseAuthenticationHandler和多个datasource</span></p>
<p style="margin:0in; font-size:14pt"><span style="font-family:KaiTi_GB2312">假如a_user中有一个用户：auser，b_user中有一个用户buser，这样你无论用哪一个用户登录，CAS就会先查a_user，如果用户名密码都正确，那么就通过，如果a_user中验证失败，那么CAS就会再查b_user，用户名密码都正确就算通过了，此时不正确，就算这次登录验证没通过。</span></p>
<p style="margin:0in; font-size:14pt"><span style="font-family:KaiTi_GB2312">&nbsp;</span></p>
<h1 style="margin:0in; font-size:14pt"><span style="font-family:KaiTi_GB2312">总结：</span></h1>
<p style="margin:0in; font-size:14pt"><span style="font-family:KaiTi_GB2312">&nbsp;</span></p>
<p style="margin:0in; font-size:14.0pt"><span style="font-family:KaiTi_GB2312">以上是针对数据库查询的数据进行验证过程的简单配置，在<span lang="en-US">CAS</span><span lang="zh-CN">的应用过程中很常见，针对我们日常应用的需求</span><span lang="en-US">CAS</span><span lang="zh-CN">帮我们提供了很多自定义的方式，下篇博客会继续讲解！</span></span></p>
<p style="margin:0in; font-size:14pt"><span style="font-family:KaiTi_GB2312">&nbsp;</span></p>
<p style="margin:0in; font-size:14pt"><span style="font-family:KaiTi_GB2312"><br>
</span></p>
<br>
   
</div><div class="ArcitleLink"><a href='http://blog.csdn.net/hejingyuan6/article/details/45100957'>原文链接</a>