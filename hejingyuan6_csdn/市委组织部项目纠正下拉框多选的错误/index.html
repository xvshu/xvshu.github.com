<div style="color:blue" align=center>市委组织部项目纠正下拉框多选的错误</div><br><div id="article_content" class="article_content tracking-ad" data-mod="popu_307" data-dsm="post">

<p style="margin:0in">
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px"><br>
</span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px"><a target="_blank" target="_blank" href="http://blog.csdn.net/hejingyuan6/article/details/18812435">http://blog.csdn.net/hejingyuan6/article/details/18812435</a></span></p>
<p style="margin:0in"><br>
</p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px">在上篇博客中曾介绍了一种方式实现下拉框多选，而且在编辑时，可以选中已选项。</span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px"><span lang="zh-CN">出现的问题：当时使用的方式是，点击编辑时用</span><span lang="en-US">id</span><span lang="zh-CN">绑定，</span><span lang="en-US">easyui</span><span lang="zh-CN">会根据下拉框中的内容自动拆分，当时测试时，由于</span><span lang="en-US">id</span><span lang="zh-CN">均为各位数字，固没有问题，但是当随着数据库中的内容增加，</span><span lang="en-US">id</span><span lang="zh-CN">可能是两位或者三位数字，这时，</span><span lang="en-US">easyui</span><span lang="zh-CN">仍然会给我们拆分，本来</span><span lang="en-US">id</span><span lang="zh-CN">为</span><span lang="en-US">43</span><span lang="zh-CN">，应根据</span><span lang="en-US">43</span><span lang="zh-CN">这个</span><span lang="en-US">id</span><span lang="zh-CN">号去查找，但是系统却会拆分成</span><span lang="en-US">4,3</span><span lang="zh-CN">。然后就会去查找</span><span lang="en-US">id</span><span lang="zh-CN">为</span><span lang="en-US">4</span><span lang="zh-CN">和</span><span lang="en-US">3</span><span lang="zh-CN">对应的责任单位，但这些并不是我们想要的！</span></span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px">&nbsp;</span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px">解决方案：</span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px">&nbsp;</span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px">添加县市区定量考核指标：根据考核年份选择责任单位，责任单位可多选</span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px"></span></p>
<pre name="code" class="html"> &lt;div id=&quot;dlg&quot; class=&quot;easyui-dialog&quot; style=&quot;width: 400px;top:110px;left:329px; height: auto; padding: 10px 20px&quot;
        closed=&quot;true&quot; buttons=&quot;#dlg-buttons&quot;&gt;
        &lt;div class=&quot;ftitle&quot;&gt;添加/编辑定量指标&lt;/div&gt;
        &lt;form id=&quot;fm&quot; method=&quot;post&quot; novalidate &gt;
            &lt;div class=&quot;fitem&quot; &gt;                           
                &lt;label &gt;指标名称:&lt;/label&gt;
                &lt;input  id=&quot;Name&quot; name=&quot;Name&quot; class=&quot;easyui-validatebox&quot; required=&quot;true&quot;/&gt;
            &lt;/div&gt;
            &lt;div class=&quot;fitem&quot;&gt;
                &lt;label&gt;考核年份:&lt;/label&gt;              
                 &lt;input class=&quot;easyui-combobox&quot; id=&quot;year&quot; runat=&quot;server&quot; style=&quot;border-color:black&quot;
                         name=&quot;year&quot;
                         data-options=&quot; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;url:'SetCityQuantifyTarget.ashx?test=inquireServerTime', &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;method:'get',
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;editable:false,
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;valueField:'year', &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;textField:'year',
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;panelHeight: 'auto', &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;onSelect:function(rec){ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;var url = 'SetCityQuantifyTarget.ashx?test=GetCity&amp;name='+rec.year;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$('#ResponsibilityUnit').combobox('clear'), &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$('#ResponsibilityUnit').combobox('reload', url);&nbsp;
                        }                             
                  &quot; /&gt;              
            &lt;/div&gt;
            &lt;div class=&quot;fitem&quot;&gt;
                &lt;label&gt;责任单位:&lt;/label&gt;               
                &lt;input class=&quot;easyui-combobox&quot; id=&quot;ResponsibilityUnit&quot; runat=&quot;server&quot; Width=&quot;133px&quot;  style=&quot;border-color:black&quot;
                            name=&quot;ResponsibilityUnit&quot;
                            data-options=&quot;                                                  
                                method:'get',
                                valueField:'id',
                                textField:'unitname',
                                editable:false,
                                multiple:true 
                                               
                        &quot; /&gt;              
            &lt;/div&gt;         
            &lt;div class=&quot;fitem&quot;&gt;
                &lt;label&gt;一类县权重:&lt;/label&gt;
                &lt;input  id=&quot;Type1&quot; name=&quot;Type1&quot; class=&quot;easyui-validatebox&quot; required=&quot;true&quot; /&gt;
            &lt;/div&gt;
            
            &lt;div id=&quot;Div1&quot; class=&quot;fitem&quot; runat=&quot;server&quot;&gt;
                &lt;label&gt;二类县权重:&lt;/label&gt;
               &lt;input  id=&quot;Type2&quot; name=&quot;Type2&quot; class=&quot;easyui-validatebox&quot; required=&quot;true&quot; /&gt;

            &lt;/div&gt;
            &lt;div class=&quot;fitem&quot;&gt;
                &lt;label&gt;广阳区权重:&lt;/label&gt;
               &lt;input  id=&quot;guangyang&quot; name=&quot;guangyang&quot; class=&quot;easyui-validatebox&quot; required=&quot;true&quot; /&gt;
            &lt;/div&gt;
            &lt;div class=&quot;fitem&quot;&gt;
                &lt;label&gt;安次区权重:&lt;/label&gt;
               &lt;input  id=&quot;anci&quot; name=&quot;anci&quot; class=&quot;easyui-validatebox&quot; required=&quot;true&quot; /&gt;
            &lt;/div&gt;

            
            &lt;input type=&quot;hidden&quot; id=&quot;test&quot; name=&quot;test&quot; /&gt;
            &lt;input type=&quot;hidden&quot; id=&quot;test1&quot; name=&quot;test&quot; /&gt;
        &lt;/form&gt;
    &lt;/div&gt;</pre>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px"><br>
</span></p>
<p style="margin:0in">
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px"><span lang="zh-CN">编辑时：直接绑定字段名称，而不是</span><span lang="en-US">id</span><span lang="zh-CN">&#20540;，将选中行的责任单位字段直接赋给弹出框！$('#ResponsibilityUnit').combobox('setText',row.ResponsibilityUnit);</span></span></p>
<span style="font-family:KaiTi_GB2312; font-size:24px"></span><pre code_snippet_id="266003" snippet_file_name="blog_20140331_2_8947582" name="code" class="javascript">//编辑事件
      function editUser() {
          var type;
          type = $('#Type').combobox('getText');
          if (type != &quot;全部&quot;) {
              var row = $('#dg').datagrid('getSelected');
              $('#fm').form('clear');
              if (row) {
                  //$.ajaxSetup({
                  //    async: false
                  //});
                  //var url = 'SetCityQuantifyTarget.ashx?test=GetCity&amp;name=' + row.YearTime;
                  //$('#ResponsibilityUnit').combobox('reload', url);

                  $('#dlg').dialog('open').dialog('setTitle', '编辑县市区定量指标');
                  $('#TargetID').val(row.TargetID);
                  $('#Name').val(row.Name);
                  document.getElementById(&quot;year&quot;).value = row.YearTime;
                  //$('#Type3').val(row.Type3);
                  $('#guangyang').val(row.guangyang);
                  $('#anci').val(row.anci);
                  $('#Type2').val(row.Type2);
                  $('#Type1').val(row.Type1);
                  $('#year').combobox('setText', row.YearTime);
                  $('#ResponsibilityUnitID').val(row.ResponsibilityUnitID);
                  var resID = row.ResponsibilityUnit;
                  //$('#ResponsibilityUnit').combobox('setText', row.ResponsibilityUnit);
                  var str = new Array();
                  str = resID.split(&quot;;&quot;);   //分割数组成为一个个单一的个体，放在数组中
                  var totalData = $('#ResponsibilityUnit').combobox('getData');  //获取下拉框中的值
                  for (var i = 0; i &lt; totalData.length; i++) {
                      for (var j = 0; j &lt; str.length; j++) {
                          if (totalData[i].unitname == str[j]) {
                              $('#ResponsibilityUnit').combobox('select', totalData[i].id);  //循环判断，如果某项一致，则该项选中
                          }
                      }
                  }

                  document.getElementById(&quot;test&quot;).value = &quot;modify&quot;
                  $('#fm').form('load');                
              } else {
                  $.messager.alert('提示', '请选中一条记录进行修改', 'info');
                  return;
              }
          } else {
              $.messager.alert('提示', '请选中指标类型进行修改', 'info');
              return;
          }


      }</pre><br>
<p style="margin:0in">
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px">出现的问题：</span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px"><br>
</span></p>
<span style="font-family:KaiTi_GB2312; font-size:24px"><img src="49288819747945" alt=""><br>
</span>
<p style="margin:0in">
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px"><span lang="zh-CN"><br>
</span></span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px"><span lang="zh-CN">原因：因为在添加责任单位时，是根据年份进行选择的，也就是当年份onSelect（当用户选择一个列表项的时候触发）时，加载责任单位信息，但是编辑时我可能不点击年份则不会触发</span><span lang="en-US">onSelect</span><span lang="zh-CN">事件，就会出现如上问题。</span></span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px">&nbsp;</span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px">解决方法：首先想到的是，当编辑时再次根据年份加载一次责任单位即：</span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px">&nbsp;var url ='SetCityQuantifyTarget.ashx?test=GetCity&amp;name=' &#43; row.YearTime;</span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px">&nbsp;$('#ResponsibilityUnit').combobox('reload',url);</span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px">&nbsp;</span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px">显示结果：</span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px"><br>
</span></p>
<span style="font-family:KaiTi_GB2312; font-size:24px"><img src="34620418725018" alt=""><br>
</span>
<p style="margin:0in">
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px"><br>
</span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px">而且只有首次加载时，下拉框中显示为空，第二次的话就正常显示（也就是当刷新完，第一次点击为空，第二次点击即正常）</span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px"><br>
</span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px"><span lang="en-US">W</span><span lang="en-US">hy</span><span lang="zh-CN">？</span></span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px"><span lang="zh-CN"><br>
</span></span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px">也就是说，当下拉框加载上数据之后显示正常，那么不正常时，可能就是在编辑时重新查询下拉框的内容时，还没有查询到数据，固显示为空。</span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px">&nbsp;</span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px"><span lang="zh-CN">解决方案：让</span><span lang="en-US">js</span><span lang="zh-CN">先将下拉框的数据加载上，然后</span></span></p>
<span style="font-family:KaiTi_GB2312; font-size:24px"></span><pre code_snippet_id="266003" snippet_file_name="blog_20140331_3_5120335" name="code" class="javascript">                  var resID = row.ResponsibilityUnit;
                  //$('#ResponsibilityUnit').combobox('setText', row.ResponsibilityUnit);
                  var str = new Array();
                  str = resID.split(&quot;;&quot;);   //分割数组成为一个个单一的个体，放在数组中
                  var totalData = $('#ResponsibilityUnit').combobox('getData');  //获取下拉框中的值
                  for (var i = 0; i &lt; totalData.length; i++) {
                      for (var j = 0; j &lt; str.length; j++) {
                          if (totalData[i].unitname == str[j]) {
                              $('#ResponsibilityUnit').combobox('select', totalData[i].id);  //循环判断，如果某项一致，则该项选中
                          }
                      }
                  }</pre><br>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px">循环的将选中行中的责任单位和下拉框中的数据进行匹配，相等的被选中，显示出来。固为了上程序按步执行，添加如下代码即可！</span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px"><br>
</span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px"></span></p>
<pre code_snippet_id="266003" snippet_file_name="blog_20140331_4_4531691" name="code" class="javascript">//同步执行
                  $.ajaxSetup({
                      async: false
                  });
</pre>
<p><br>
</p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px">结果显示：</span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px"><br>
</span></p>
<img src="39830369336454" alt=""><br>
<p><br>
</p>
<p><br>
</p>
<p><span style="font-family:KaiTi_GB2312; font-size:24px">总结：问题源源不断，针对问题解决问题，不断提升自己！</span></p>
<p><br>
</p>
<p><br>
</p>
<p><br>
</p>
<p><br>
</p>
   
</div><div class="ArcitleLink"><a href='http://blog.csdn.net/hejingyuan6/article/details/21968791'>原文链接</a>