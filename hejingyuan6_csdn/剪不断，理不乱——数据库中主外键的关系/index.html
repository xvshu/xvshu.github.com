<div style="color:blue" align=center>剪不断，理不乱——数据库中主外键的关系</div><br><div id="article_content" class="article_content tracking-ad" data-mod="popu_307" data-dsm="post">

<p><span style="font-family:KaiTi_GB2312; font-size:24px">&nbsp;</span></p>
<p><span style="font-family:KaiTi_GB2312; font-size:24px">&nbsp;&nbsp;&nbsp;在做机房收费系统时，考虑到了主外键，所以学习了一下，下面我们一起来</span><span style="font-family:KaiTi_GB2312; font-size:24px">探究一下它们的关系。</span></p>
<p>&nbsp;</p>
<p align="left"><span style="font-family:KaiTi_GB2312; font-size:24px">&nbsp;&nbsp;&nbsp;主键Primary key，唯一标示一个实体。是保证数据库的实体完整性，保证数据中数据的正确性和合理性，取&#20540;非空唯一。</span></p>
<p align="left"><span style="font-family:KaiTi_GB2312; font-size:24px">&nbsp;&nbsp;&nbsp;外键Foreign，是用来使表与表之间联系。用来保证数据库的参照完整性，外键的取&#20540;必须来自参照表参照列的&#20540;，可以为空也可不为空。</span></p>
<p><span style="font-family:KaiTi_GB2312; font-size:24px">&nbsp;</span></p>
<p><span style="font-family:KaiTi_GB2312; font-size:24px">&nbsp;&nbsp;&nbsp; 外键的作用：</span></p>
<p><span style="font-family:KaiTi_GB2312; font-size:24px">&nbsp;&nbsp;&nbsp;保持数据一致性，完整性，主要目的是控制存储在外键表中的数据。 使两张表形成关联，外键只能引用外表中的列的&#20540;！</span></p>
<p><span style="font-family:KaiTi_GB2312; font-size:24px">&nbsp;</span></p>
<p><span style="font-family:KaiTi_GB2312; font-size:24px">&nbsp;&nbsp;&nbsp; 主外键的关系结构：</span></p>
<p align="left"><span style="font-family:KaiTi_GB2312; font-size:24px">&nbsp;</span></p>
<p align="left"><span style="font-family:KaiTi_GB2312; font-size:24px">1，一对一，不用引用主外键，把它们放一个表中即可</span></p>
<p align="left"><span style="font-family:KaiTi_GB2312; font-size:24px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;例如：一个学生只能有一个卡号，那么学生跟卡号放在一个表中即可</span></p>
<p align="left"><span style="font-family:KaiTi_GB2312; font-size:24px">2，一对多，引用主外键，‘一’相当于主键，‘多’即是引用主键的外键。</span></p>
<p align="left"><span style="font-family:KaiTi_GB2312; font-size:24px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;例如：一个班级可以有多个学生，并且一个学生只能属于一个班级，这就是一对多的关系；</span></p>
<p align="left"><span style="font-family:KaiTi_GB2312; font-size:24px">3，多对多关系，需要创建一个表，表中需要两个字段，分别是引用，两个多对多字段主键的外键。<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></p>
<p align="left"><span style="font-family:KaiTi_GB2312; font-size:24px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;例如：</span></p>
<p align="left"><br>
<span style="font-family:KaiTi_GB2312; font-size:24px">学生表（学号，姓名，…………）主键：学号<br>
课程表（课程号，课程名，…………）主键：课程号<br>
一个学生能选多门课，一个课可以由多个学生选，即是多对多关系，<br>
那么成绩表就是它们之间关系的体，<br>
即引用成绩表（学号，课程号，成绩）。这里学号和课程号，分别是学生表和课程表中学号和课程号的外键</span></p>
<p align="left"><span style="font-family:KaiTi_GB2312; font-size:24px">在我们现在这个阶段中，主要还是使用，主外键间的一对多的关系</span></p>
<p align="left"><span style="font-family:KaiTi_GB2312; font-size:24px">&nbsp;</span></p>
<p align="left"><span style="font-family:KaiTi_GB2312; font-size:24px">下面一起来简单看一下大概建成的表结构</span></p>
<p align="left"><span style="font-family:KaiTi_GB2312; font-size:24px">&nbsp;</span></p>
<pre class="sql" name="code"><span style="font-family:KaiTi_GB2312;font-size:24px;">--建班级表

create table class(

classid int primary key,--定义班级ID为主键

classname varchar(15)

)
</span></pre>
<p align="left"><span style="font-family:KaiTi_GB2312"><br>
<span style="font-size:24px"></span></span></p>
<pre class="sql" name="code"><span style="font-family:KaiTi_GB2312;font-size:24px;">--建学生表

create table students(

studentid int primary key,--定义学生ID为主键

classid int ,--外键值，跟班级表classid 属性类型相同

stuname varchar(20),--学生姓名
</span></pre>
<p align="left"><span style="font-family:KaiTi_GB2312"><br>
<span style="font-size:24px"></span></span></p>
<pre class="sql" name="code"><span style="font-family:KaiTi_GB2312;font-size:24px;">---定义外键

foreign key(classid) references class(classid) --本表classid是基于class表classid的外键

)
</span></pre>
<p align="left"><span style="font-family:KaiTi_GB2312"><br>
<span style="font-size:24px"></span></span></p>
<p align="left"><span style="font-family:KaiTi_GB2312; font-size:24px">&nbsp;&nbsp; 如上定义了主外键后，两个表间的关系就是一对多的关系了，并且学生表内的classid必须依托班级表的classid存在，也就是说外键必须要主键存在的时候才能创建，</span></p>
<p align="left"><span style="font-family:KaiTi_GB2312; font-size:24px"></span>&nbsp;</p>
<p><span style="font-family:KaiTi_GB2312; font-size:24px">例如：</span></p>
<p><span style="font-family:KaiTi_GB2312; font-size:24px"></span>&nbsp;</p>
<p align="left"><span style="font-family:KaiTi_GB2312; font-size:24px">--在班级表为空的情况往学生表插入一条记录是不允许的：</span></p>
<pre class="sql" name="code"><span style="font-family:KaiTi_GB2312;font-size:24px;">insert intostudents(studentid,classid,stuname)values(1,1,'小明')</span></pre>
<p class="sql" name="code"><br>
<span style="font-family:KaiTi_GB2312; font-size:24px">&nbsp;系统会抛出异常提示主键表班级表内班级ID不存在这样是不允许插入的；</span></p>
<p align="left"><span style="font-family:KaiTi_GB2312; font-size:24px">必须要先往班级表内插入一条记录：</span></p>
<pre class="sql" name="code"><span style="font-family:KaiTi_GB2312;font-size:24px;">insert into class(classid,classname)values(1,'一班')</span></pre>
<p align="left"><br>
<span style="font-family:KaiTi_GB2312; font-size:24px">&nbsp;后才能执行插入前面一条往学生表插入信息的语句..</span></p>
<p><span style="font-family:KaiTi_GB2312; font-size:24px">&nbsp;</span></p>
<p><span style="font-family:KaiTi_GB2312; font-size:24px">&nbsp;&nbsp; 解释：</span></p>
<p><span style="font-family:KaiTi_GB2312; font-size:24px"></span>&nbsp;</p>
<p><span style="font-family:KaiTi_GB2312; font-size:24px">&nbsp;&nbsp; 对于机房收费系统来说，如图：</span></p>
<p><span style="font-family:KaiTi_GB2312; font-size:24px">&nbsp;<img alt="" src="26985568935816.png"></span></p>
<p><span style="font-family:KaiTi_GB2312; font-size:24px">&nbsp;&nbsp;&nbsp;&nbsp;只有当学生注册了信息，有了卡号，在学生信息表中存在了，才可以进行充&#20540;，退卡，上下机等，主外键的作用也就是当没有学生信息时，我们不可以进行充&#20540;等操作，而且想要删除学生信息表中的数据，必须先将充&#20540;表，退卡表，上下机表中此卡号的人删除之后才可以删除学生信息表中的数据，这样就避免了当学生未注册时，就可以充&#20540;的情况</span></p>
<p><span style="font-family:KaiTi_GB2312; font-size:24px">&nbsp;</span></p>
<p><span style="font-family:KaiTi_GB2312; font-size:24px">&nbsp;&nbsp;&nbsp; 也就是说，如果主键表中数据的更改使之与外键表中数据的链接失效，则这种更改是不能实现的，从而确保了引用完整性。如果试图删除主键表中的行或更改主键&#20540;，而该主键&#20540;与另一个表的 FOREIGN KEY 约束&#20540;相关，则该操作不可实现。若要成功更改或删除 FOREIGN KEY 约束的行，可以先在外键表中删除外键数据或更改外键数据，然后将外键链接到不同的主键数据上去。</span></p>
<p><span style="font-family:KaiTi_GB2312; font-size:24px">&nbsp;</span></p>
<p><span style="font-family:KaiTi_GB2312; font-size:24px">&nbsp;&nbsp;&nbsp; 外键是用来控制数据库中数据的数据完整性的 。</span><span style="font-family:KaiTi_GB2312; font-size:24px">就是当你对一个表的数据进行操作</span><span style="font-family:KaiTi_GB2312; font-size:24px">和他有关联的一个或更多表的数据能够同时发生改变，</span><span style="font-family:KaiTi_GB2312; font-size:24px">这就是外键的作用</span></p>
<p><span style="font-family:KaiTi_GB2312; font-size:24px">&nbsp;</span></p>
<p align="left"><span style="font-family:KaiTi_GB2312; font-size:24px">连接查询与内外键的关系：</span></p>
<p align="left"><span style="font-family:KaiTi_GB2312; font-size:24px">&nbsp;</span></p>
<p align="left"><span style="font-family:KaiTi_GB2312; font-size:24px">&nbsp;&nbsp;&nbsp; 连接的 连接条件：A表的主键 = B表的外键如果做连接的两表没有主外键关系，那么连接结果没有意义。</span></p>
<p align="left"><span style="font-family:KaiTi_GB2312; font-size:24px"></span>&nbsp;</p>
<p align="left"><span style="font-family:KaiTi_GB2312; font-size:24px">&nbsp;&nbsp;&nbsp; 例：学生表和选课表做连接，select *from 学生表,选课表where 学生表.学号（主键）=选课表.学号（外键）</span></p>
<p align="left"><span style="font-family:KaiTi_GB2312; font-size:24px">&nbsp;</span></p>
<p align="left"><span style="font-family:KaiTi_GB2312; font-size:24px">&nbsp;&nbsp;&nbsp; 主外键可以建级联级触发器，用来做级联删除、更新。作用原理还是因为主外键将两表联系。</span></p>
<p><span style="font-family:KaiTi_GB2312; font-size:24px"></span>&nbsp;</p>
<p>&nbsp;</p>
   
</div><div class="ArcitleLink"><a href='http://blog.csdn.net/hejingyuan6/article/details/7878358'>原文链接</a>