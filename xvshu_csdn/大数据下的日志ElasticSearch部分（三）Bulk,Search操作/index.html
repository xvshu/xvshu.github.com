<div style="color:blue" align=center>大数据下的日志ElasticSearch部分（三）Bulk,Search操作</div><br><div id="article_content" class="article_content tracking-ad" data-mod="popu_307" data-dsm="post">

其实在上一篇博客中，只要大家能看懂，就应该能够根据其代码做到举一反三了，依次类推ES的批量操作Bulk，搜索功能Search等，但在这里还是简单讲一下。<br>
&nbsp;<br>
批量索引和删除<br>
&nbsp;<br>
Java代码 &nbsp;收藏代码<br>
BulkRequestBuilder bulkRequest = client.prepareBulk(); &nbsp;<br>
&nbsp; &nbsp; &nbsp; &nbsp; for(int i=500;i&lt;1000;i&#43;&#43;){ &nbsp;<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; //业务对象 &nbsp;<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; String json = ESUtils.toJson(new LogModel()); &nbsp;<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; IndexRequestBuilder indexRequest = client.prepareIndex(&quot;twitter&quot;, &quot;tweet&quot;) &nbsp;<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; //指定不重复的ID &nbsp; &nbsp; &nbsp; &nbsp;<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .setSource(json).setId(String.valueOf(i)); &nbsp;<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; //添加到builder中 &nbsp;<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; bulkRequest.add(indexRequest); &nbsp;<br>
&nbsp; &nbsp; &nbsp; &nbsp; } &nbsp;<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;<br>
&nbsp; &nbsp; &nbsp; &nbsp; BulkResponse bulkResponse = bulkRequest.execute().actionGet(); &nbsp;<br>
&nbsp; &nbsp; &nbsp; &nbsp; if (bulkResponse.hasFailures()) { &nbsp;<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // process failures by iterating through each bulk response item &nbsp;<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; System.out.println(bulkResponse.buildFailureMessage()); &nbsp;<br>
&nbsp; &nbsp; &nbsp; &nbsp; } &nbsp;<br>
&nbsp;上面只是批量索引的方法，将client.prepareIndex改为client.prepareDelete就是批量删除操作。ES对批量操作作了优化，所以大家使用时，尽量将操作集中起来调用批量接口，速度会更快一些。<br>
&nbsp;<br>
&nbsp;<br>
搜索(Search)<br>
<br>
<br>
这里说的搜索仅仅是简单相等条件搜索，并没有涉及真正意义上的搜索。比如，我们要搜索前1000条记录，代码如下：<br>
&nbsp;<br>
Java代码 &nbsp;收藏代码<br>
SearchResponse response = client.prepareSearch(&quot;twitter&quot;) &nbsp;<br>
//这个在prepareSearch中指定还不行，必须使用setTypes &nbsp;<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .setTypes(&quot;tweet&quot;) &nbsp;<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; //设置查询条件, &nbsp;<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .setFilter(FilterBuilders.matchAllFilter()) &nbsp;<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .setFrom(0).setSize(1000) &nbsp;<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .execute() &nbsp;<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .actionGet(); &nbsp;<br>
&nbsp; &nbsp; &nbsp; &nbsp; /**&nbsp;<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* SearchHits是SearchHit的复数形式，表示这个是一个列表&nbsp;<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;*/ &nbsp;<br>
&nbsp; &nbsp; &nbsp; &nbsp; SearchHits shs = response.getHits(); &nbsp;<br>
&nbsp; &nbsp; &nbsp; &nbsp; for(SearchHit hit : shs){ &nbsp;<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; System.out.println(&quot;id:&quot;&#43;hit.getId()&#43;&quot;:&quot;&#43;hit.getSourceAsString()); &nbsp;<br>
&nbsp; &nbsp; &nbsp; &nbsp; } &nbsp;<br>
&nbsp; &nbsp; &nbsp; &nbsp; client.close(); &nbsp;<br>
&nbsp;搜索有两种方法，一种是使用Filter进行搜索，一种是使用Query进行搜索，例如，想只搜索某个字段为具体&#20540;的数据，也可以这样写。<br>
&nbsp;<br>
&nbsp;<br>
Java代码 &nbsp;收藏代码<br>
Client client = ESUtils.getClient(); &nbsp;<br>
&nbsp; &nbsp; &nbsp; &nbsp; /**&nbsp;<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* 创建查询条件，QueryBuilders相当于Hibernate的Restrictions，&nbsp;<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* 而QueryBuilder则相当于一个Criteria,可以不停的增加本身对象&nbsp;<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;*/ &nbsp;<br>
&nbsp; &nbsp; &nbsp; &nbsp; BoolQueryBuilder query = QueryBuilders.boolQuery(); &nbsp;<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;//systemName为字段名称，oa未字段&#20540; &nbsp;<br>
&nbsp; &nbsp; &nbsp; &nbsp; query.must(QueryBuilders.termQuery(&quot;systemName&quot;, &quot;oa&quot;)); &nbsp;<br>
&nbsp; &nbsp; &nbsp; &nbsp; SearchResponse response = client.prepareSearch(&quot;twitter&quot;) &nbsp;<br>
//这个在prepareSearch中指定还不行，必须使用setTypes &nbsp;<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .setTypes(&quot;tweet&quot;) &nbsp;<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; //设置查询条件, &nbsp;<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .setQuery(query) &nbsp;<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .setFrom(0).setSize(60) &nbsp;<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .execute() &nbsp;<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .actionGet(); &nbsp;<br>
&nbsp; &nbsp; &nbsp; &nbsp; /**&nbsp;<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* SearchHits是SearchHit的复数形式，表示这个是一个列表&nbsp;<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;*/ &nbsp;<br>
&nbsp; &nbsp; &nbsp; &nbsp; SearchHits shs = response.getHits(); &nbsp;<br>
&nbsp; &nbsp; &nbsp; &nbsp; for(SearchHit hit : shs){ &nbsp;<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; System.out.println(hit.getSourceAsString()); &nbsp;<br>
&nbsp; &nbsp; &nbsp; &nbsp; } &nbsp;<br>
&nbsp; &nbsp; &nbsp; &nbsp; client.close(); &nbsp;<br>
&nbsp;<br>
&nbsp;<br>
这些只是使用ES的传统用法，就是想用ES取代传统数据库的用法。但其实ES的主要目的并非如此，相信你使用搜索引擎也不是想做这些简单的查询和插入。排名，分词等更高级的用法，我也没有完全搞清楚，还望大家多多指教。
   
</div><div class="ArcitleLink"><a href='http://blog.csdn.net/xvshu/article/details/48917017'>原文链接</a>