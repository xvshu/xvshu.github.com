<div class="articleLocationOnion"><a href='../../index.html'>首页: </a> &gt; <a href='../index_s.html'>未分类</a> &gt; 市委组织部项目js调用后台方法（一）</div><div style="color:blue" align=center>市委组织部项目js调用后台方法（一）</div><br><div id="article_content" class="article_content tracking-ad" data-mod="popu_307" data-dsm="post">

<p style="margin:0in; font-family:宋体; font-size:16.0pt"><span lang="zh-CN"><br>
</span></p>
<p style="margin:0in"><span lang="zh-CN"><span style="font-family:宋体; font-size:16pt">&nbsp;</span><span style="font-family:KaiTi_GB2312; font-size:24px">&nbsp; 由来：对于下载</span></span><span style="font-family:KaiTi_GB2312; font-size:24px"><span lang="en-US">word</span><span lang="zh-CN">文档和预览文档，需要根据选中行获取这条记录的文档地址和文档名称，然后点击下载或预览，将需要的参数传到后台调用相应的方法。首先想到的就是通过</span><span lang="en-US">js</span><span lang="zh-CN">获取本行的&#20540;，作为参数传递到后台调用下载和预览的方法。</span></span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px"><span lang="zh-CN"><br>
</span></span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px"><span lang="zh-CN">&nbsp; &nbsp;以下是使用的两种方式调用后台的方法！</span></span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px">&nbsp;<img src="25944276282407" alt=""></span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px"><span lang="en-US"><span style="font-family:KaiTi_GB2312; font-size:24px"><br>
</span></span></span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px"><span lang="en-US"><span style="font-family:KaiTi_GB2312; font-size:24px">方法一：</span><br>
</span></span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px"><span lang="en-US"><span style="font-family:KaiTi_GB2312; font-size:24px"><br>
</span></span></span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px"><span lang="en-US">js</span><span lang="zh-CN">代码：</span></span></p>
<p style="font-size:16pt; font-family:宋体; margin:0in"><span lang="zh-CN"><br>
</span></p>
<p style="margin:0in"><span lang="zh-CN"></span></p>
<pre code_snippet_id="204567" snippet_file_name="blog_20140225_1_7652806" name="code" class="javascript" style="font-family: 宋体; font-size: 16pt;">&lt;script type=&quot;text/javascript&quot;&gt;
        //下载
        function btnDownLoad() {
            var row = $(&#39;#dg&#39;).datagrid(&#39;getSelected&#39;);
            if (row) {
                //选中行的id，文档名称，文档地址
                var id = row.id;
                var name = row.wordName;
                var wordaddress = row.wordAddress;

                //createXMLHTTP(); //创建XMLHttpRequest对象  + &quot;&amp;wordaddress=&quot; + wordaddress
                //var url = &quot;QueryWord.aspx?name=&quot; + name + &quot;&amp;wordaddress=&quot; + wordaddress;

                //js跳转页
                //window.location.href = &quot;QueryWord.aspx?name=&quot; + name;

                //调用后台click方法
                //document.getElementById(&quot;btnLoad&quot;).click();

                var myurl = &quot;UnitsQueryWord.aspx&quot; + &quot;?&quot; + &quot;name=&quot; + name + &quot;&amp;wordaddress=&quot; + wordaddress;
                document.getElementById(&quot;btnLoad&quot;).click();

                //var myurl = wordaddress;
                ////当跳转为文档的地址时，即实现下载
                window.location.assign(myurl);


            }
            else {
                alert(&#39;请选中一条记录进行修改&#39;);
                return;
            }
        }        
&lt;/script&gt;
</pre><br>
<p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px">后台方法：</span></p>
<br>
<p style="margin:0in"><span lang="zh-CN"></span></p>
<pre code_snippet_id="204567" snippet_file_name="blog_20140225_2_2222376" name="code" class="csharp" style="font-family: 宋体; font-size: 16pt;">protected void btnLoad_Click(object sender, EventArgs e)
        {
            //string tableName = Request.QueryString[&quot;tableName&quot;].ToString();
            string name = Request.QueryString[&quot;name&quot;].ToString();
            string wordaddress = Request.QueryString[&quot;wordaddress&quot;].ToString();           
            //DownloadFile(Server.MapPath(&quot;UpLoadWord/2013年度考核办法(2014-2-2修改稿)2.doc&quot;), &quot;2013年度考核办法(2014-2-2修改稿)2.doc&quot;);
            //DownloadFile(name,wordaddress);
        }
</pre><br>
<p>
<p>&nbsp; &nbsp;<img src="41089557460422" alt=""><br>
</p>
<p style="margin:0in"><span style="font-family:宋体; font-size:16pt">&nbsp; &nbsp;</span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px">&nbsp; &nbsp; 这种方法未能实现，原因是这两条语句（</span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px">&nbsp;var myurl = &quot;UnitsQueryWord.aspx&quot; &#43;&quot;?&quot; &#43; &quot;name=&quot; &#43; name &#43; &quot;&amp;wordaddress=&quot; &#43;wordaddress;</span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px">&nbsp; &nbsp; document.getElementById(&quot;btnLoad&quot;).click();</span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px"><span lang="zh-CN">）单独使用均没有问题但一起使用后台就获取不到前台传过去的&#20540;。如上图，如果将</span><span lang="en-US">click</span><span lang="zh-CN">事件去掉，点击下载时，参数已经在浏览器中显示。但是当加上</span><span lang="en-US">click</span><span lang="zh-CN">语句，相当于刷新一次界面，而我们知道窗体首次加载时肯定是无参数&#20540;的，所以后台会一直获取不到&#20540;，提示：未将对象引用到对象实例！</span></span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px">&nbsp;</span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px"><span lang="zh-CN">方法二</span><span lang="en-US">:</span></span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px">&nbsp;</span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px"><span lang="en-US">js</span><span lang="zh-CN">代码：</span></span></p>
<br>
<p style="margin:0in"><span lang="zh-CN"></span></p>
<pre code_snippet_id="204567" snippet_file_name="blog_20140225_3_6683261" name="code" class="javascript" style="font-family: 宋体; font-size: 16pt;">&lt;script type=&quot;text/javascript&quot;&gt; 
//预览
function btnPreView() {
            var row = $(&#39;#dg&#39;).datagrid(&#39;getSelected&#39;);
            if (row) { 
				     //文档地址
                var wordaddress = row.wordAddress;
                var s = &#39;&lt;%=WordToHtml2(&quot;&#39; + wordaddress + &#39;&quot;) %&gt;&#39;;
            }
        }
&lt;/script&gt;
</pre><br>
<p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px">后台代码：</span></p>
<p style="font-family:宋体; font-size:16pt; margin:0in">&nbsp;</p>
<pre code_snippet_id="204567" snippet_file_name="blog_20140225_4_31332" name="code" class="csharp" style="font-family: 宋体; font-size: 16pt;">public string WordToHtml2(string  wordFileName)
        {
            if (wordFileName == null || wordFileName == &quot;&quot;)
            { 
                string HtmlPath = WordToHtml(Server.MapPath(wordFileName));
                string rePath = HtmlPath.Substring(HtmlPath.IndexOf(&quot;UpLoadWord\\&quot;) + 11, HtmlPath.Length - HtmlPath.IndexOf(&quot;UpLoadWord\\&quot;) - 11);
                Response.Redirect(&quot;UpLoadWord/&quot; + rePath);
                return &quot;1&quot;;
            }
            return &quot;2&quot;;
        }
</pre><br>
<p style="margin:0in"><span lang="zh-CN" style="font-size:16pt; font-family:宋体">&nbsp; &nbsp; &nbsp;&nbsp;<img src="16120528254889" alt=""></span></p>
<p style="margin:0in"><span lang="zh-CN" style="font-size:16pt; font-family:宋体"><br>
</span></p>
<p style="margin:0in"><span lang="zh-CN" style="font-size:16pt; font-family:宋体"><img src="32065925842837" alt=""><br>
</span></p>
<p style="margin:0in"><span lang="zh-CN" style="font-size:16pt; font-family:宋体"><br>
</span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px"><span lang="zh-CN">&nbsp; &nbsp; 这种方法一般在有返回&#20540;时使用，如上的代码最终</span><span lang="en-US">js</span><span lang="zh-CN">代码中的变量</span><span lang="en-US">s</span><span lang="zh-CN">的&#20540;为</span><span lang="en-US">2</span><span lang="zh-CN">，也就是直接给我们结果（如上第一张图结果为“</span><span lang="en-US">2</span><span lang="zh-CN">”）。而且这个方法并不是触发什么事件时执行，而是窗体一旦加载就执行这个方法（
 var s ='&lt;%=WordToHtml2(&quot;' &#43; wordaddress &#43; '&quot;) %&gt;';</span></span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px">）因为窗体加载时wordAddress并没有&#20540;，固导致直接判断wordFileName是否等于wordAddress。</span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px"><span lang="zh-CN">而且当我们加载完后点击“预览</span><span lang="en-US">html</span><span lang="zh-CN">”按钮时</span><span lang="en-US">s</span><span lang="zh-CN">的&#20540;已经为</span><span lang="en-US">2</span><span lang="zh-CN">。固这种方法仍不能满足要求！</span></span></p>
<p lang="en-US" style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px">&nbsp;</span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px">总结：</span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px"><br>
</span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px"><span lang="en-US">&nbsp; &nbsp;js</span><span lang="zh-CN">调用后台的方法有多种，上面只是针对其中两种进行解释说明。当我们在网上搜的时候会看到多种方法，但是我们并不知道它是怎么实现的，只有自己真正使用，调试时才会真正了解它，如果我们对方法的实现不是很了解，那么就可能出现在这种情况下可以实现，在另一种情况下就不能实现而自己还不知道为什么。所以我们在学习时不能只想着功能的实现，而要真正理解它，那么这个知识才是自己的！</span></span></p>
<p style="font-family:宋体; font-size:16pt; margin:0in">&nbsp;</p>
<p style="font-family:宋体; font-size:16pt; margin:0in">&nbsp;</p>
<br>
<br>
   
</div><div class="ArcitleLink"><a href='http://blog.csdn.net/hejingyuan6/article/details/19499615'>原文链接</a>