<div style="color:blue" align=center>Spring线程池开发实战</div><br><div id="article_content" class="article_content tracking-ad" data-mod="popu_307" data-dsm="post">
<p style="margin-top: 0px; margin-bottom: 0px; padding-top: 0px; padding-bottom: 0px; font-family: Arial; font-size: 14px; line-height: 26px;"><strong>作者：chszs，转载需注明。</strong></p><span style="font-family: Arial; font-size: 14px; line-height: 26px;">作者博客主页：http://blog.csdn.net/chszs</span><br style="font-family: Arial; font-size: 14px; line-height: 26px;"><br style="font-family: Arial; font-size: 14px; line-height: 26px;"><span style="font-family: Arial; font-size: 14px; line-height: 26px;">本文提供了三个Spring多线程开发的例子，由浅入深，由于例子一目了然，所以并未做过多的解释。诸位一看便知。</span><br style="font-family: Arial; font-size: 14px; line-height: 26px;"><br style="font-family: Arial; font-size: 14px; line-height: 26px;"><h2 style="margin: 0px; padding: 0px; font-family: Arial; line-height: 26px;"><a target="_blank" target="_blank" name="t1" style="color: rgb(255, 153, 0);"></a>前提条件：</h2><span style="font-family: Arial; font-size: 14px; line-height: 26px;">1）在Eclipse创建一个Java项目，我取名为SpringThreadDemo。</span><br style="font-family: Arial; font-size: 14px; line-height: 26px;"><p><span style="font-family: Arial; font-size: 14px; line-height: 26px;">2）项目所需的JAR包如图所示：</span></p><p><span style="font-family: Arial; font-size: 14px; line-height: 26px;"><br></span></p><span style="font-family: Arial; font-size: 14px; line-height: 26px;">&nbsp;</span><img src="44831899263486.jpg" alt="" style="border: none; max-width: 100%; font-family: Arial; font-size: 14px; line-height: 26px;"><br style="font-family: Arial; font-size: 14px; line-height: 26px;"><p style="margin-top: 0px; margin-bottom: 0px; padding-top: 0px; padding-bottom: 0px; font-family: Arial; font-size: 14px; line-height: 26px;"><br></p><p style="margin-top: 0px; margin-bottom: 0px; padding-top: 0px; padding-bottom: 0px; font-family: Arial; font-size: 14px; line-height: 26px;">下面开始。</p><p style="margin-top: 0px; margin-bottom: 0px; padding-top: 0px; padding-bottom: 0px; font-family: Arial; font-size: 14px; line-height: 26px;"><br></p><span style="font-family: Arial; font-size: 14px; line-height: 26px;">注：项目源码已经托管到GitHub，地址：https://github.com/chszs/SpringThreadDemo</span><br style="font-family: Arial; font-size: 14px; line-height: 26px;"><br style="font-family: Arial; font-size: 14px; line-height: 26px;"><h2 style="margin: 0px; padding: 0px; font-family: Arial; line-height: 26px;"><a target="_blank" target="_blank" name="t2" style="color: rgb(255, 153, 0);"></a>例子1：Spring结合Java线程。</h2><div><br></div><p style="margin-top: 0px; margin-bottom: 0px; padding-top: 0px; padding-bottom: 0px; font-family: Arial; font-size: 14px; line-height: 26px;">通过继承Thread创建一个简单的<a target="_blank" target="_blank" href="http://lib.csdn.net/base/17" class="replace_word" title="Java EE知识库" style="color: rgb(223, 52, 52); text-decoration: none; font-weight: bold;">Java</a>线程，然后使用@Component让Spring容器管理此线程，Bean的范围必须是prototype，因此每个请求都会返回一个新实例，运行每个单独的线程。</p><p style="margin-top: 0px; margin-bottom: 0px; padding-top: 0px; padding-bottom: 0px; font-family: Arial; font-size: 14px; line-height: 26px;"><br></p><h3 style="margin: 0px; padding: 0px; font-family: Arial; line-height: 26px;"><a target="_blank" target="_blank" name="t3" style="color: rgb(255, 153, 0);"></a>PrintThread.java</h3><div><pre code_snippet_id="1696260" snippet_file_name="blog_20160525_1_8590177" name="code" class="java">package com.chszs.thread;  
  
import org.springframework.stereotype.Component;  
import org.springframework.context.annotation.Scope;  
  
@Component  
@Scope(&quot;prototype&quot;)  
public class PrintThread extends Thread{  
        @Override  
        public void run(){  
                System.out.println(getName() + &quot; is running.&quot;);  
                try{  
                        Thread.sleep(5000);  
                }catch(InterruptedException e){  
                        e.printStackTrace();  
                }  
                System.out.println(getName() + &quot; is running again.&quot;);  
        }  
}  </pre><br><h3 style="margin: 0px; padding: 0px; font-family: Arial; line-height: 26px;">AppConfig.java</h3><br></div><div><pre code_snippet_id="1696260" snippet_file_name="blog_20160525_2_4718720" name="code" class="java">package com.chszs.config;  
  
import org.springframework.context.annotation.ComponentScan;  
import org.springframework.context.annotation.Configuration;  
  
@Configuration  
@ComponentScan(basePackages=&quot;com.chszs.thread&quot;)  
public class AppConfig {  
}  </pre><br><h3 style="margin: 0px; padding: 0px; font-family: Arial; line-height: 26px;">App.java</h3><br></div><div><pre code_snippet_id="1696260" snippet_file_name="blog_20160525_3_7052251" name="code" class="java">package com.chszs;  
import org.springframework.context.ApplicationContext;  
import org.springframework.context.annotation.AnnotationConfigApplicationContext;  
  
import com.chszs.config.AppConfig;  
import com.chszs.thread.PrintThread;  
  
public class App {  
        public static void main(String[] args){  
                ApplicationContext ctx =   
            new AnnotationConfigApplicationContext(AppConfig.class);  
                PrintThread printThread1 = (PrintThread)ctx.getBean(&quot;printThread&quot;);  
                printThread1.setName(&quot;Thread 1&quot;);  
                  
                PrintThread printThread2 = (PrintThread)ctx.getBean(&quot;printThread&quot;);  
                printThread2.setName(&quot;Thread 2&quot;);  
                  
                PrintThread printThread3 = (PrintThread)ctx.getBean(&quot;printThread&quot;);  
                printThread3.setName(&quot;Thread 3&quot;);  
                  
                PrintThread printThread4 = (PrintThread)ctx.getBean(&quot;printThread&quot;);  
                printThread4.setName(&quot;Thread 4&quot;);  
                  
                PrintThread printThread5 = (PrintThread)ctx.getBean(&quot;printThread&quot;);  
                printThread5.setName(&quot;Thread 5&quot;);  
                  
                printThread1.start();  
                printThread2.start();  
                printThread3.start();  
                printThread4.start();  
                printThread5.start();  
        }  
}  </pre><br><h3 style="margin: 0px; padding: 0px; font-family: Arial; line-height: 26px;">输出：</h3><span style="font-family: Arial; font-size: 14px; line-height: 26px;">Thread 1 is running.</span><br style="font-family: Arial; font-size: 14px; line-height: 26px;"><span style="font-family: Arial; font-size: 14px; line-height: 26px;">Thread 2 is running.</span><br style="font-family: Arial; font-size: 14px; line-height: 26px;"><span style="font-family: Arial; font-size: 14px; line-height: 26px;">Thread 4 is running.</span><br style="font-family: Arial; font-size: 14px; line-height: 26px;"><span style="font-family: Arial; font-size: 14px; line-height: 26px;">Thread 5 is running.</span><br style="font-family: Arial; font-size: 14px; line-height: 26px;"><span style="font-family: Arial; font-size: 14px; line-height: 26px;">Thread 3 is running.</span><br style="font-family: Arial; font-size: 14px; line-height: 26px;"><span style="font-family: Arial; font-size: 14px; line-height: 26px;">Thread 2 is running again.</span><br style="font-family: Arial; font-size: 14px; line-height: 26px;"><span style="font-family: Arial; font-size: 14px; line-height: 26px;">Thread 1 is running again.</span><br style="font-family: Arial; font-size: 14px; line-height: 26px;"><span style="font-family: Arial; font-size: 14px; line-height: 26px;">Thread 5 is running again.</span><br style="font-family: Arial; font-size: 14px; line-height: 26px;"><span style="font-family: Arial; font-size: 14px; line-height: 26px;">Thread 4 is running again.</span><br style="font-family: Arial; font-size: 14px; line-height: 26px;"><span style="font-family: Arial; font-size: 14px; line-height: 26px;">Thread 3 is running again.</span><p style="margin-top: 0px; margin-bottom: 0px; padding-top: 0px; padding-bottom: 0px; font-family: Arial; font-size: 14px; line-height: 26px;"><p style="margin-top: 0px; margin-bottom: 0px; padding-top: 0px; padding-bottom: 0px; font-family: Arial; font-size: 14px; line-height: 26px;"><br></p><h2 style="margin: 0px; padding: 0px; font-family: Arial; line-height: 26px;"><a target="_blank" target="_blank" name="t7" style="color: rgb(255, 153, 0);"></a>例子2：Spring线程池结合非Spring托管Bean。</h2><div><br></div><p style="margin-top: 0px; margin-bottom: 0px; padding-top: 0px; padding-bottom: 0px; font-family: Arial; font-size: 14px; line-height: 26px;"><p style="margin-top: 0px; margin-bottom: 0px; padding-top: 0px; padding-bottom: 0px; font-family: Arial; font-size: 14px; line-height: 26px;">使用Spring的ThreadPoolTaskExecutor类创建一个线程池。执行线程无需受Spring容器的管理。<br><br></p><h3 style="margin: 0px; padding: 0px; font-family: Arial; line-height: 26px;"><a target="_blank" target="_blank" name="t8" style="color: rgb(255, 153, 0);"></a>PrintTask.java</h3><br></div><div><pre code_snippet_id="1696260" snippet_file_name="blog_20160525_4_5274344" name="code" class="cpp">package com.chszs.thread;  
  
public class PrintTask implements Runnable{  
        String name;  
        public PrintTask(String name){  
                this.name = name;  
        }  
        @Override  
        public void run() {  
                System.out.println(name + &quot; is running.&quot;);  
                try{  
                        Thread.sleep(5000);  
                }catch(InterruptedException e){  
                        e.printStackTrace();  
                }  
                System.out.println(name + &quot; is running again.&quot;);  
        }  
          
}  </pre><h3 style="margin: 0px; padding: 0px; font-family: Arial; line-height: 26px;">Spring-Config.xml</h3><div><br></div><pre code_snippet_id="1696260" snippet_file_name="blog_20160525_5_5656028" name="code" class="java">&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;  
        xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;   
        xmlns:context=&quot;http://www.springframework.org/schema/context&quot;  
        xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans  
        http://www.springframework.org/schema/beans/spring-beans-3.1.xsd  
        http://www.springframework.org/schema/context  
        http://www.springframework.org/schema/context/spring-context-3.1.xsd&quot;&gt;  
          
        &lt;bean id=&quot;taskExecutor&quot;   
        class=&quot;org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor&quot;&gt;  
                &lt;property name=&quot;corePoolSize&quot; value=&quot;5&quot; /&gt;  
                &lt;property name=&quot;maxPoolSize&quot; value=&quot;10&quot; /&gt;  
                &lt;property name=&quot;WaitForTasksToCompleteOnShutdown&quot; value=&quot;true&quot; /&gt;  
        &lt;/bean&gt;  
&lt;/beans&gt;  </pre><br><span style="font-family: Arial; font-size: 14px; line-height: 26px;">注意这个Spring配置文件的位置，如图所示：</span></div><div><span style="font-family:Arial;"><span style="font-size: 14px; line-height: 26px;"><br></span></span><p style="margin-top: 0px; margin-bottom: 0px; padding-top: 0px; padding-bottom: 0px; font-family: Arial; font-size: 14px; line-height: 26px;"><p style="margin-top: 0px; margin-bottom: 0px; padding-top: 0px; padding-bottom: 0px; font-family: Arial; font-size: 14px; line-height: 26px;"><img src="46381568014040.jpg" alt="" style="border: none; max-width: 100%;"><br><br></p><h3 style="margin: 0px; padding: 0px; font-family: Arial; line-height: 26px;"><a target="_blank" target="_blank" name="t10" style="color: rgb(255, 153, 0);"></a>App1.java</h3><div><br></div><pre code_snippet_id="1696260" snippet_file_name="blog_20160525_6_5514324" name="code" class="java">package com.chszs;  
  
import org.springframework.context.ApplicationContext;  
import org.springframework.context.support.ClassPathXmlApplicationContext;  
import org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor;  
  
import com.chszs.thread.PrintTask;  
  
public class App1 {  
  
        public static void main(String[] args) {  
                ApplicationContext ctx =   
            new ClassPathXmlApplicationContext(&quot;resources/Spring-Config.xml&quot;);  
                ThreadPoolTaskExecutor taskExecutor =  
            (ThreadPoolTaskExecutor)ctx.getBean(&quot;taskExecutor&quot;);  
                taskExecutor.execute(new PrintTask(&quot;Thread 1&quot;));  
                taskExecutor.execute(new PrintTask(&quot;Thread 2&quot;));  
                taskExecutor.execute(new PrintTask(&quot;Thread 3&quot;));  
                taskExecutor.execute(new PrintTask(&quot;Thread 4&quot;));  
                taskExecutor.execute(new PrintTask(&quot;Thread 5&quot;));  
                // 检查活动的线程，如果活动线程数为0则关闭线程池  
                for(;;){  
                        int count = taskExecutor.getActiveCount();  
                        System.out.println(&quot;Active Threads : &quot; + count);  
                        try{  
                                Thread.sleep(1000);  
                        }catch(InterruptedException e){  
                                e.printStackTrace();  
                        }  
                        if(count==0){  
                                taskExecutor.shutdown();  
                                break;  
                        }  
                }  
        }  
  
}  </pre><br><div><br></div><h3 style="margin: 0px; padding: 0px; font-family: Arial; line-height: 26px;">输出：</h3><p style="margin-top: 0px; margin-bottom: 0px; padding-top: 0px; padding-bottom: 0px; font-family: Arial; font-size: 14px; line-height: 26px;"><p style="margin-top: 0px; margin-bottom: 0px; padding-top: 0px; padding-bottom: 0px; font-family: Arial; font-size: 14px; line-height: 26px;">Thread 1 is running.<br>Thread 2 is running.<br>Thread 3 is running.<br>Thread 4 is running.<br>Active Threads : 4<br>Thread 5 is running.<br>Active Threads : 5<br>Active Threads : 5<br>Active Threads : 5<br>Active Threads : 5<br>Active Threads : 5<br>Thread 4 is running again.<br>Thread 2 is running again.<br>Thread 3 is running again.<br>Thread 1 is running again.<br>Thread 5 is running again.<br>Active Threads : 0<br><br><strong>作者：chszs，转载需注明。博客主页：http://blog.csdn.net/chszs</strong><br><br></p><h2 style="margin: 0px; padding: 0px; font-family: Arial; line-height: 26px;"><a target="_blank" target="_blank" name="t12" style="color: rgb(255, 153, 0);"></a>例子3：Spring线程池结合Spring托管Bean。</h2><br style="font-family: Arial; font-size: 14px; line-height: 26px;"><span style="font-family: Arial; font-size: 14px; line-height: 26px;">本例仍然使用ThreadPoolTaskExecutor类，并使用@Component注释声明Spring的托管Bean。</span><br style="font-family: Arial; font-size: 14px; line-height: 26px;"><span style="font-family: Arial; font-size: 14px; line-height: 26px;">下面的例子PrintTask2是Spring的托管Bean，使用@Autowired注释简化代码。</span><br style="font-family: Arial; font-size: 14px; line-height: 26px;"><br style="font-family: Arial; font-size: 14px; line-height: 26px;"><p style="margin-top: 0px; margin-bottom: 0px; padding-top: 0px; padding-bottom: 0px; font-family: Arial; font-size: 14px; line-height: 26px;"><h3 style="margin: 0px; padding: 0px; font-family: Arial; line-height: 26px;"><a target="_blank" target="_blank" name="t13" style="color: rgb(255, 153, 0);"></a>PrintTask2.java</h3><div><br></div><pre code_snippet_id="1696260" snippet_file_name="blog_20160525_7_7847855" name="code" class="java">package com.chszs.thread;  
  
import org.springframework.context.annotation.Scope;  
import org.springframework.stereotype.Component;  
  
@Component  
@Scope(&quot;prototype&quot;)  
public class PrintTask2 implements Runnable {  
        String name;  
  
        public void setName(String name) {  
                this.name = name;  
        }  
          
        @Override  
        public void run(){  
                System.out.println(name + &quot; is running.&quot;);  
                try{  
                        Thread.sleep(5000);  
                }catch(InterruptedException e){  
                        e.printStackTrace();  
                }  
                System.out.println(name + &quot; is running again.&quot;);  
        }  
}  </pre><br><h3 style="margin: 0px; padding: 0px; font-family: Arial; line-height: 26px;">AppConfig.java</h3><div><br></div><pre code_snippet_id="1696260" snippet_file_name="blog_20160525_8_181388" name="code" class="java">package com.chszs.config;  
  
import org.springframework.context.annotation.Bean;  
import org.springframework.context.annotation.ComponentScan;  
import org.springframework.context.annotation.Configuration;  
import org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor;  
  
@Configuration  
@ComponentScan(basePackages=&quot;com.chszs.thread&quot;)  
public class AppConfig {  
        @Bean  
        public ThreadPoolTaskExecutor taskExecutor(){  
                ThreadPoolTaskExecutor pool = new ThreadPoolTaskExecutor();  
                pool.setCorePoolSize(5);  
                pool.setMaxPoolSize(10);  
                pool.setWaitForTasksToCompleteOnShutdown(true);  
                return pool;  
        }  
}  </pre><br><div><br></div><h3 style="margin: 0px; padding: 0px; font-family: Arial; line-height: 26px;">App2.java</h3><div><br></div><pre code_snippet_id="1696260" snippet_file_name="blog_20160525_9_563072" name="code" class="java">package com.chszs;  
  
import org.springframework.context.ApplicationContext;  
import org.springframework.context.annotation.AnnotationConfigApplicationContext;  
import org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor;  
  
import com.chszs.config.AppConfig;  
import com.chszs.thread.PrintTask2;  
  
public class App2 {  
        public static void main(String[] args) {  
                ApplicationContext ctx =   
            new AnnotationConfigApplicationContext(AppConfig.class);  
                ThreadPoolTaskExecutor taskExecutor =  
            (ThreadPoolTaskExecutor)ctx.getBean(&quot;taskExecutor&quot;);  
                  
                PrintTask2 printTask1 = (PrintTask2)ctx.getBean(&quot;printTask2&quot;);  
                printTask1.setName(&quot;Thread 1&quot;);  
                taskExecutor.execute(printTask1);  
                  
                PrintTask2 printTask2 = (PrintTask2)ctx.getBean(&quot;printTask2&quot;);  
                printTask2.setName(&quot;Thread 2&quot;);  
                taskExecutor.execute(printTask2);  
                  
                PrintTask2 printTask3 = (PrintTask2)ctx.getBean(&quot;printTask2&quot;);  
                printTask3.setName(&quot;Thread 3&quot;);  
                taskExecutor.execute(printTask3);  
                  
                for(;;){  
                        int count = taskExecutor.getActiveCount();  
                        System.out.println(&quot;Active Threads : &quot; + count);  
                        try{  
                                Thread.sleep(1000);  
                        }catch(InterruptedException e){  
                                e.printStackTrace();  
                        }  
                        if(count==0){  
                                taskExecutor.shutdown();  
                                break;  
                        }  
                }  
        }  
  
}  </pre><br><h3 style="margin: 0px; padding: 0px; font-family: Arial; line-height: 26px;">输出：</h3><p style="margin-top: 0px; margin-bottom: 0px; padding-top: 0px; padding-bottom: 0px; font-family: Arial; font-size: 14px; line-height: 26px;"><p style="margin-top: 0px; margin-bottom: 0px; padding-top: 0px; padding-bottom: 0px; font-family: Arial; font-size: 14px; line-height: 26px;">Thread 1 is running.<br>Thread 2 is running.<br>Active Threads : 2<br>Thread 3 is running.<br>Active Threads : 3<br>Active Threads : 3<br>Active Threads : 3<br>Active Threads : 3<br>Thread 1 is running again.<br>Thread 2 is running again.<br>Thread 3 is running again.<br>Active Threads : 1<br>Active Threads : 0<br><br><strong>从这三个简单的实例中，你是不是发现了Spring框架在多线程方面的强大之处！！</strong></p><div><br></div><div><br></div><a target="_blank" href="http://download.csdn.net/detail/hejingyuan6/9530859" target="_blank">demo下载地址</a><br><br></div><div><br></div><div><br></div>   
</div><div class="ArcitleLink"><a href='http://blog.csdn.net/hejingyuan6/article/details/51498401'>原文链接</a>