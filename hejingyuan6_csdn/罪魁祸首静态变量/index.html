<div style="color:blue" align=center>罪魁祸首静态变量</div><br><div id="article_content" class="article_content tracking-ad" data-mod="popu_307" data-dsm="post">

<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px"><span lang="en-US">&nbsp; &nbsp;</span><span lang="zh-CN">在做考试系统的时候，考试完成后需要教师判分，给我们的任务是允许多个教师同时判分，且判的题是不重复的，针对这个需求我设计了一个判分页面，每个教师按照题型，答题顺序判答题记录表的前</span><span lang="en-US">20</span><span lang="zh-CN">个题，但是，因为我设计的页面使用了静态变量，导致了一系列问题！</span></span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px">&nbsp;</span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px">教师判分时出现的问题：</span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px"><br>
</span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px"><span lang="en-US">1</span><span lang="zh-CN">，查的题型与显示不对应</span></span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px"><span lang="en-US">2</span><span lang="zh-CN">，下一批不起作用</span></span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px"><span lang="en-US">3</span><span lang="zh-CN">，报黄页</span></span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px">&nbsp;</span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px">问题图示：</span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px"><br>
</span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px"><span lang="en-US">1</span><span lang="zh-CN">，查的题型与显示不对应</span></span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px"><span lang="zh-CN"><br>
</span></span></p>
<p style="margin:0in"><span lang="zh-CN"><span style="font-family:KaiTi_GB2312; font-size:24px">&nbsp; &nbsp; &nbsp; &nbsp;<img src="16461527985211" alt=""><br>
</span></span></p>
<p style="margin:0in"><span lang="zh-CN"><span style="font-family:KaiTi_GB2312; font-size:24px"></span></span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px"><span lang="en-US">说明：要判作文题，可是显示的却为翻译题，如上图：</span></span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px"><span lang="en-US"><br>
</span></span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px"><span lang="en-US">2</span><span lang="zh-CN">，下一批不起作用</span></span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px"><span lang="zh-CN"><br>
</span></span></p>
<span style="font-family:KaiTi_GB2312; font-size:24px"><img src="221566210205528" alt="" width="900" height="460"><br>
</span>
<p style="margin:0in"><span lang="zh-CN"><span style="font-family:KaiTi_GB2312; font-size:24px"></span></span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px"><br>
</span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px">说明：</span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px"><span lang="zh-CN">要判的题型为整句翻译，可是</span><span lang="en-US">tableName</span><span lang="zh-CN">却为作文题题库表名，其他参数如试题</span><span lang="en-US">id</span><span lang="zh-CN">和题型都正确，导致找不到试题。也就是在作文题库中在试题</span><span lang="en-US">id</span><span lang="zh-CN">为翻译题的试题</span></span></p>
<span style="font-family:KaiTi_GB2312; font-size:24px"><br>
</span>
<p style="margin:0in"><span lang="zh-CN"><span style="font-family:KaiTi_GB2312; font-size:24px"></span></span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px"><span lang="en-US">3</span><span lang="zh-CN">，报黄页</span></span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px">&nbsp;</span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px"><span lang="zh-CN">找不到某个表。例如：</span><span lang="en-US">T_daxueyingyuoneyubeiji_Writing_Detail</span></span></p>
<p lang="en-US" style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px">&nbsp;</span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px">原因：</span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px"><span lang="en-US">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span lang="zh-CN">如上的表在数据库中根本就不存在，也就是拼的表名不正确，</span><span lang="en-US">why</span><span lang="zh-CN">？</span></span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px"><span lang="zh-CN">我们根据题型类型反射到具体的</span><span lang="en-US">D</span><span lang="zh-CN">层，然后根据题库名查询试题</span><span lang="en-US">id</span><span lang="zh-CN">的答题记录，正巧此题型无从表。也就是反射到复合式听力的</span><span lang="en-US">D</span><span lang="zh-CN">层，然后拼接表名时，复合式听力有从表固存在</span><span lang="en-US">D</span><span lang="en-US">etail</span><span lang="zh-CN">，而我们传过来的</span><span lang="en-US">TableName</span><span lang="zh-CN">却为</span><span lang="en-US">T_daxueyingyuoneyubeiji_Writing</span><span lang="zh-CN">导致给作文添加了</span><span lang="en-US">D</span><span lang="en-US">etail--</span><span lang="zh-CN">报错！</span></span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px"><span lang="zh-CN"><br>
</span></span></p>
<span style="font-family:KaiTi_GB2312; font-size:24px"><img src="24766679257793" alt="" width="900" height="456"><br>
</span>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px"><span lang="zh-CN"></span></span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px"><span lang="zh-CN"><br>
</span></span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px"><span lang="zh-CN">调试症状：静态变量中存放着题库表名，题库表名不正确，试题</span><span lang="en-US">id</span><span lang="zh-CN">和题型正确</span></span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px">&nbsp;</span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px"><span lang="zh-CN">问题</span><span lang="en-US">1</span><span lang="zh-CN">，根据正确的题型，在错误的题库表中找到了此试题</span><span lang="en-US">id</span><span lang="zh-CN">的答题记录</span><span lang="en-US">---</span><span lang="zh-CN">显示错位</span></span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px"><span lang="zh-CN">问题</span><span lang="en-US">2</span><span lang="zh-CN">，根据正确的题型，在错误的题库表中找不到试题</span><span lang="en-US">id---</span><span lang="zh-CN">下一批不起作用</span></span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px"><span lang="zh-CN">问题</span><span lang="en-US">3</span><span lang="zh-CN">，根据正确的题型，反射到此题型的</span><span lang="en-US">D</span><span lang="zh-CN">层，然后拼答题记录表，而正巧此题型不存在从表，也就是拼的表名数据库中根本不存在！</span></span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px">&nbsp;</span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px">现在我们来看一下为什么会出现错位的情况：</span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px"><br>
</span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px">前提：将题库表名存放在静态变量中</span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px">&nbsp;</span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px">判分流程图示：</span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;<img src="26471569947260" alt=""><br>
</span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<img src="38861148494520" alt=""><br>
</span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;<img src="39934706835248" alt=""><br>
</span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<img src="8788699319005" alt=""><br>
</span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px"><br>
</span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px">预想：<br>
</span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<img src="7027967772332" alt=""><br>
</span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px">结果：<br>
</span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<img src="50373335638688" alt=""><br>
</span></p>
<p style="margin:0in">
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px"><br>
</span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px">总结：</span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px"><br>
</span></p>
<p style="margin:0in 0in 0in 0.375in"><span style="font-family:KaiTi_GB2312; font-size:24px">定义：静态变量始终存在着，也就是说它的生存期为整个源程序（程序中只保存一份）。</span></p>
<p style="margin:0in 0in 0in 0.375in"><span style="font-family:KaiTi_GB2312; font-size:24px">优点：访问频繁资源-速度快</span></p>
<p style="margin:0in 0in 0in 0.375in"><span style="font-family:KaiTi_GB2312; font-size:24px">缺点：</span></p>
<p style="margin:0in 0in 0in 0.75in"><span style="font-family:KaiTi_GB2312; font-size:24px">一直占用内存</span></p>
<p style="margin:0in 0in 0in 0.75in"><span style="font-family:KaiTi_GB2312; font-size:24px">高并发——逻辑混乱</span></p>
<p style="margin:0in 0in 0in 0.75in"><span style="font-family:KaiTi_GB2312; font-size:24px">影响多进程，多线程</span></p>
<p style="margin:0in 0in 0in 0.375in"><span style="font-family:KaiTi_GB2312; font-size:24px">&nbsp; &nbsp;耦合高</span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px">&nbsp; &nbsp;如上，大家已经看到了静态变量带来的问题，所以大家在使用时一定要慎用！</span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px">&nbsp;</span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px">反思：</span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px"><br>
</span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:24px">不做什么很重要：做事情之前，一定要明白什么不能用，即使要用，也要先了解清楚。<br>
调试的重要性：当时的侧重点在于多个教师同时判同一类题是不是有问题，会不会出现并发的错误。当测试正常了，就以为没有问题了，万事大吉了，却忽略了多个教师判不同题型，不同试卷的问题了。因为判同类试卷同类题型，静态变量一直保持正确，不会触发错误！<br>
遇到问题的态度：计算机不会欺骗我们，是什么就是什么，无论是静态变量还是锁或其他的，出现错误一定有它的触发点，只有弄明白到底是什么问题，以后遇到才不会惧怕，才知道什么时候可以用，什么时候不可以用，俗话说，知己知彼，百战不殆！<br>
</span></p>
<p style="margin:0in 0in 0in 0.375in"><span style="font-family:KaiTi_GB2312; font-size:24px">&nbsp;</span></p>
<span style="font-family:KaiTi_GB2312; font-size:24px"><br>
</span><br>
   
</div><div class="ArcitleLink"><a href='http://blog.csdn.net/hejingyuan6/article/details/18812719'>原文链接</a>