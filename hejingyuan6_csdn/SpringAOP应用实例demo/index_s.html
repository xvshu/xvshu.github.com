<div class="articleLocationOnion"><a href='../../index.html'>首页: </a> &gt; <a href='../index_s.html'>未分类</a> &gt; SpringAOP应用实例demo</div><div style="color:blue" align=center>SpringAOP应用实例demo</div><br><div id="article_content" class="article_content tracking-ad" data-mod="popu_307" data-dsm="post">

<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:18px"><span lang="zh-CN"><br>
</span></span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:18px"><span lang="zh-CN">AOP</span><span lang="zh-CN">（</span><span lang="en-US">Aspect-Oriented Programming</span><span lang="en-US">，面向方面编程），可以说是</span><span lang="en-US">OOP</span><span lang="en-US">（</span><span lang="en-US">Object-OrientedPrograming</span><span lang="en-US">，面向对象编程）的补充和完善。</span></span><span lang="en-US" style="font-family:KaiTi_GB2312; font-size:18px">OOP</span><span lang="en-US" style="font-family:KaiTi_GB2312; font-size:18px">引入封装、继承和多态性等概念来建立一种对象层次结构，用以模拟公共行为的一个集合。</span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:18px"><span lang="en-US"><br>
</span></span></p>
<h1 style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:18px"><span lang="en-US">OOP的问题，AOP的补充</span></span></h1>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:18px"><span lang="en-US"><br>
</span></span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:18px"><span lang="en-US">当我们需要为分散的对象引入公共行为的时候，</span><span lang="en-US">OOP</span><span lang="en-US">则显得无能为力。也就是说，</span><span lang="en-US">OOP</span><span lang="en-US">允许你定义从上到下的关系，但并不适合定义从左到右的关系。例如日志功能。日志代码往往水平地散布在所有对象层次中，而与它所散布到的对象的核心功能毫无关系。对于其他类型的代码，如安全性、异常处理和透明的持续性也是如此。这种散布在各处的无关的代码被称为横切（</span><span lang="en-US">cross-cutting</span><span lang="en-US">）代码，在</span><span lang="en-US">OOP</span><span lang="en-US">设计中，它导致了大量代码的重复，而不利于各个模块的重用。</span></span></p>
<p lang="en-US" style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:18px">&nbsp;</span></p>
<p lang="en-US" style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:18px">所谓“方面”，简单地说，就是将那些与业务无关，却为业务模块所共同调用的逻辑或责任封装起来，便于减少系统的重复代码，降低模块间的耦合度，并有利于未来的可操作性和可维护性。</span></p>
<p lang="en-US" style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:18px">&nbsp;</span></p>
<h1 style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:18px"><span lang="zh-CN">Spring</span><span lang="zh-CN">中对</span><span lang="en-US"> AOP</span><span lang="en-US">的支持</span></span></h1>
<p lang="en-US" style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:18px">&nbsp;</span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:18px"><span lang="zh-CN">Spring</span><span lang="zh-CN">中</span><span lang="en-US"> AOP</span><span lang="en-US">代理由</span><span lang="en-US">Spring</span><span lang="en-US">的</span><span lang="en-US">
 IoC</span><span lang="en-US">容器负责生成、管理，其依赖关系也由</span><span lang="en-US"> IoC</span><span lang="en-US">容器负责管理。因此，</span><span lang="en-US">AOP</span><span lang="en-US">代理可以直接使用容器中的其他</span><span lang="en-US"> Bean</span><span lang="en-US">实例作为目标，这种关系可由</span><span lang="en-US">
 IoC</span><span lang="en-US">容器的依赖注入提供。</span><span lang="en-US">Spring</span><span lang="en-US">默认使用</span><span lang="en-US"> Java</span><span lang="en-US">动态代理来创建</span><span lang="en-US">AOP</span><span lang="en-US">代理，</span><span lang="en-US"></span><span lang="en-US">这样就可以为任何接口实例创建代理了。当需要代理的类不是代理接口的时候，</span><span lang="en-US">
 Spring</span><span lang="en-US">自动会切换为使用</span><span lang="en-US"> CGLIB</span><span lang="en-US">代理，也可强制使用</span><span lang="en-US"> CGLIB</span><span lang="en-US">。</span><span lang="en-US"></span></span></p>
<p lang="en-US" style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:18px"><br>
</span></p>
<h1 style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:18px">程序员参与部分&nbsp;</span></h1>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:18px"><span lang="zh-CN"><br>
</span></span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:18px"><span lang="zh-CN">AOP</span><span lang="zh-CN">编程其实是很简单的事情。纵观</span><span lang="en-US"> AOP</span><span lang="en-US">编程，</span><span lang="en-US"></span><span lang="en-US">其中需要程序员参与的只有三个部分：</span></span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:18px">&nbsp;</span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:18px">&nbsp; &nbsp;定义普通业务组件。</span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:18px">&nbsp; &nbsp;定义切入点，一个切入点可能横切多个业务组件。</span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:18px"><span lang="zh-CN">&nbsp; &nbsp;定义增强处理，增强处理就是在</span><span lang="en-US">AOP</span><span lang="en-US">框架为普通业务组件织入的处理动作。</span></span></p>
<p lang="en-US" style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:18px">&nbsp;</span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:18px"><span lang="zh-CN">所以进行</span><span lang="en-US"> AOP</span><span lang="en-US">编程的关键就是定义切入点和定义增强处理。一旦定义了合适的切入点和增强处理，</span><span lang="en-US">AOP</span><span lang="en-US">框架将会自动生成</span><span lang="en-US">AOP</span><span lang="en-US">代理，即：代理对象的方法</span><span lang="en-US">
 =</span><span lang="en-US">增强处理</span><span lang="en-US"> &#43;</span><span lang="en-US">被代理对象的方法。</span></span></p>
<p lang="en-US" style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:18px">&nbsp;</span></p>
<h1 style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:18px"><span lang="en-US">Spring</span><span lang="zh-CN">中使用方式：</span></span></h1>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:18px">&nbsp;</span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:18px"><span lang="zh-CN">基于</span><span lang="en-US"> Annotation</span><span lang="en-US">的“零配置”方式。</span></span></p>
<p lang="en-US" style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:18px">&nbsp;</span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:18px"><span lang="zh-CN">（</span><span lang="en-US">1</span><span lang="zh-CN">）启动注解，配置文件</span><span lang="zh-CN">applicationContext.xml</span></span></p>
<p style="margin:0in"><span lang="zh-CN"><span style="font-family:KaiTi_GB2312; font-size:18px"></span></span></p>
<pre code_snippet_id="620376" snippet_file_name="blog_20150316_1_87013" name="code" class="html">&lt;!-- 启动对@AspectJ注解的支持 --&gt;     
&lt;aop:aspectj-autoproxy/&gt;

&lt;bean id=&quot;user&quot; class=&quot;com.tgb.spring.aop.IUserImpl&quot;/&gt;

&lt;bean id=&quot;check&quot; class=&quot;com.tgb.spring.aop.CheckUser&quot;/&gt;</pre>
<p>
<p style="margin:0in"><span lang="zh-CN"><span style="font-family:KaiTi_GB2312; font-size:18px"><span lang="zh-CN">（</span><span lang="en-US">2</span><span lang="zh-CN">）编写切面类</span><br>
</span></span></p>
<p style="margin:0in"><span lang="zh-CN"><span lang="zh-CN"><span style="font-family:KaiTi_GB2312; font-size:18px"></span></span></span></p>
<pre code_snippet_id="620376" snippet_file_name="blog_20150316_2_1119236" name="code" class="java">package com.tgb.spring.aop;

import org.aspectj.lang.ProceedingJoinPoint;
import org.aspectj.lang.annotation.After;
import org.aspectj.lang.annotation.Around;
import org.aspectj.lang.annotation.Aspect;
import org.aspectj.lang.annotation.Before;
import org.aspectj.lang.annotation.Pointcut;

@Aspect 
public class CheckUser {

	@Pointcut(&quot;execution(* com.tgb.spring.aop.*.find*(..))&quot;)
	public void checkUser(){
		System.out.println(&quot;**************The System is Searching Information For You****************&quot;);
	}
	
	@Pointcut(&quot;execution(* com.tgb.spring.aop.*.add*(..))&quot;)
	public void checkAdd(){
		System.out.println(&quot;**************&lt;&lt; Add User &gt;&gt; Checking.....***************&quot;);
	}
	
	@Before(&quot;checkUser()&quot;)
	public void beforeCheck(){
		System.out.println(&quot;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; 准备搜查用户..........&quot;);
	}
	
	@After(&quot;checkUser()&quot;)
	public void afterCheck(){
		System.out.println(&quot;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;　搜查用户完毕..........&quot;);
	}

	@Before(&quot;checkAdd()&quot;)
	public void beforeAdd(){
		System.out.println(&quot;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;　增加用户--检查ing..........&quot;);
	}
	
	@After(&quot;checkAdd()&quot;)
	public void afterAdd(){
		System.out.println(&quot;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;　增加用户--检查完毕！未发现异常!..........&quot;);
	}
	
	 //声明环绕通知  
    @Around(&quot;checkUser()&quot;)  
    public Object doAround(ProceedingJoinPoint pjp) throws Throwable {  
        System.out.println(&quot;进入方法---环绕通知&quot;);  
        Object o = pjp.proceed();  
        System.out.println(&quot;退出方法---环绕通知&quot;);  
        return o;  
    }  
}</pre>
<p>
<p style="margin:0in"><span lang="zh-CN"><span lang="zh-CN"><span style="font-family:KaiTi_GB2312; font-size:18px"><span lang="zh-CN">（</span><span lang="en-US">3</span><span lang="zh-CN">）定义接口</span><br>
</span></span></span></p>
<p style="margin:0in"><span lang="zh-CN"><span lang="zh-CN"><span lang="zh-CN"><span style="font-family:KaiTi_GB2312; font-size:18px"></span></span></span></span></p>
<pre code_snippet_id="620376" snippet_file_name="blog_20150316_3_9916986" name="code" class="java">package com.tgb.spring.aop;

public interface IUser {

	public String findUser(String username);
	public void addUser(String username);
	public void findAll();
}</pre>
<p>
<p style="margin:0in"><span lang="zh-CN"><span lang="zh-CN"><span lang="zh-CN"><span style="font-family:KaiTi_GB2312; font-size:18px"></span></span></span></span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:18px"><span lang="zh-CN">（</span><span lang="en-US">4</span><span lang="zh-CN">）定义实现</span></span></p>
<span style="font-family:KaiTi_GB2312; font-size:18px"></span><pre code_snippet_id="620376" snippet_file_name="blog_20150316_4_2967096" name="code" class="java">package com.tgb.spring.aop;

import java.util.HashMap;
import java.util.Map;

public class IUserImpl implements IUser {

	public static Map map = null;
	public static void init(){
		String[] list = {&quot;Lucy&quot;, &quot;Tom&quot;, &quot;小明&quot;, &quot;Smith&quot;, &quot;Hello&quot;};
		Map tmp = new HashMap();
		for(int i=0; i&lt;list.length; i++){
			tmp.put(list[i], list[i]+&quot;00&quot;);
		}
		map = tmp;
	}
	public void addUser(String username) {
		init();
		map.put(username, username+&quot;11&quot;);
		System.out.println(&quot;--------------【addUser】: &quot;+username+&quot; --------------&quot;);
		System.out.println(&quot;【The new List:&quot;+map+&quot;】&quot;);
	}

	public void findAll() {
		init();
		System.out.println(&quot;---------------【findAll】: &quot;+map+&quot; ------------------&quot;);
	}

	public String findUser(String username) {
		init();
		String password = &quot;没查到该用户&quot;;
		if(map.containsKey(username)){
			password = map.get(username).toString();
		}
		System.out.println(&quot;-----------------【findUser】-----------------&quot;);
		System.out.println(&quot;-----------------Username:&quot;+username+&quot;-----------------&quot;);
		System.out.println(&quot;-----------------【Result】:&quot;+password+&quot;------------------&quot;);
		return password;
		
	}

}</pre>
<p style="margin:0in"><span lang="zh-CN"><span lang="zh-CN"><span lang="zh-CN"><span style="font-family:KaiTi_GB2312; font-size:18px"></span></span></span></span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:18px"><span lang="zh-CN">（</span><span lang="en-US">5</span><span lang="zh-CN">）测试</span></span></p>
<span style="font-family:KaiTi_GB2312; font-size:18px"></span><pre code_snippet_id="620376" snippet_file_name="blog_20150316_5_2321254" name="code" class="java">public class Test {
	
	public static void main(String as[]){
		BeanFactory factory = new ClassPathXmlApplicationContext(&quot;applicationContext.xml&quot;);
		IUser user = (IUser) factory.getBean(&quot;user&quot;);
		user.findAll();
		
		User u = new User();
//		u.setUsername(&quot;Tom&quot;);
//		user.findUser(u.getUsername());
		
		/*u.setUsername(&quot;haha&quot;);
		user.addUser(u.getUsername());*/
	}
}</pre><br>
<p style="margin:0in"><span lang="zh-CN"><span lang="zh-CN"><span lang="zh-CN"><span style="font-family:KaiTi_GB2312; font-size:18px"></span></span></span></span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:18px">执行结果：</span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:18px">&nbsp;</span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:18px"><span lang="zh-CN">进入方法</span><span lang="en-US">---环绕通知</span></span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:18px"><span lang="zh-CN">&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;准备搜查用户</span><span lang="en-US">..........</span></span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:18px"><span lang="zh-CN">---------------【</span><span lang="en-US">findAll】: {Smith=Smith00, Tom=Tom00, 小明=小明00, Lucy=Lucy00,Hello=Hello00} ------------------</span></span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:18px"><span lang="zh-CN">退出方法</span><span lang="en-US">---环绕通知</span></span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:18px"><span lang="zh-CN">&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;　搜查用户完毕</span><span lang="en-US">..........</span></span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:18px">&nbsp;</span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:18px">注：</span><span style="font-family:KaiTi_GB2312; font-size:18px">@Before是在所拦截方法执行之前执行一段逻辑。@After是在所拦截方法执行之后执行一段逻辑。@Around是可以同时在所拦截方法的前后执行一段逻辑。</span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:18px">&nbsp;</span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:18px">以上是针对注解的方式来实现，那么配置文件也一样，只需要在applicationContext.xml中添加如下代码：</span></p>
<pre code_snippet_id="620376" snippet_file_name="blog_20150316_6_4532332" name="code" class="html">&lt;!--  &lt;aop:config&gt;
		&lt;aop:pointcut id=&quot;find&quot; expression=&quot;execution(* com.tgb.spring.aop.*.find*(..))&quot; /&gt;
		&lt;aop:pointcut id=&quot;add&quot; 	expression=&quot;execution(* com.tgb.spring.aop.*.add*(..))&quot; /&gt;
		
		&lt;aop:aspect id=&quot;checkUser&quot; ref=&quot;check&quot;&gt;
			&lt;aop:before method=&quot;beforeCheck&quot; pointcut-ref=&quot;find&quot;/&gt;
			&lt;aop:after method=&quot;afterCheck&quot; pointcut-ref=&quot;find&quot;/&gt;
		&lt;/aop:aspect&gt;
		
		&lt;aop:aspect id=&quot;checkAdd&quot; ref=&quot;check&quot;&gt;
			&lt;aop:before method=&quot;beforeAdd&quot; pointcut-ref=&quot;add&quot;/&gt;
			&lt;aop:after method=&quot;afterAdd&quot; pointcut-ref=&quot;add&quot;/&gt;
		&lt;/aop:aspect&gt;
	
	&lt;/aop:config&gt;--&gt;</pre><br>
<p style="margin:0in"><span lang="zh-CN"><span lang="zh-CN"><span lang="zh-CN"></span></span></span></p>
<h1 style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:18px">总结：</span></h1>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:18px">&nbsp;</span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:18px"><span lang="zh-CN">以上是简单介绍了一下如何使用</span><span lang="en-US">Spring</span><span lang="en-US"> AOP,</span><span lang="zh-CN">在使用的过程中也加深我们对</span><span lang="en-US">AOP</span><span lang="zh-CN">思想的理解，其实</span><span lang="en-US">AOP</span><span lang="zh-CN">就是要我们实现热插拔效果，下篇会继续介绍</span><span lang="en-US">Spring
 AOP</span><span lang="zh-CN">的实现原理。</span></span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:18px">&nbsp;</span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:18px"><span lang="zh-CN">附：在使用过程中注意JDK版本与易用的</span><span lang="en-US">aspectJrt的版本</span><span lang="zh-CN">问题</span></span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:18px"><span lang="zh-CN"><br>
</span></span></p>
<p style="margin:0in"><span style="font-family:KaiTi_GB2312; font-size:18px"><span lang="zh-CN"><br>
</span></span></p>
<br>
   
</div><div class="ArcitleLink"><a href='http://blog.csdn.net/hejingyuan6/article/details/44279239'>原文链接</a>