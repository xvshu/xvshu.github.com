<div class="articleLocationOnion"><a href='../../index.html'>首页: </a> &gt; <a href='../index_s.html'>未分类</a> &gt; 参数化查询</div><div style="color:blue" align=center>参数化查询</div><br><div id="article_content" class="article_content tracking-ad" data-mod="popu_307" data-dsm="post">

<p><span style="font-family:KaiTi_GB2312; font-size:24px">&nbsp; &nbsp;众所周知，参数化查询有许多好处，例如可以防止SQL注入，提高查询效率等，那么参数化查询为什么就可以解决这些问题呢？</span></p>
<p><span style="font-family:KaiTi_GB2312; font-size:24px"><br>
</span></p>
<span style="font-family:KaiTi_GB2312; font-size:24px">1，参数化查询防止SQL注入<br>
参数化查询顾名思义就是我们写好需要的参数，然后直接给参数赋&#20540;，这就好比是一个sql的框架。sql查询的时候会进行参数分析，如果分析的结果是我们曾使用过这样的框架，那么sql会重用查询计划，否则会重新生成一个查询计划，当然此时的sql的语义肯定是发生了变化，这时我们就可以很好的防止注入的发生。<br>
例如<br>
<br>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<img src="50813385794817.png" alt=""><br>
</span>
<p><span style="font-family:KaiTi_GB2312; font-size:24px">如上的代码就是使用参数化的查询语句，尝试输入注入字符，结果当然是什么都查不到！</span></p>
<p><span style="font-family:KaiTi_GB2312; font-size:24px"><br>
</span></p>
<span style="font-family:KaiTi_GB2312; font-size:24px">2，参数化查询提高查询效率<br>
</span>
<p><span style="font-family:KaiTi_GB2312; font-size:24px">为了提高sql执行速度，请为SqlParameter参数加上SqlDbType和size属性，在参数化查询代码编写过程中很多开发者忽略了指定查询参数的类型，这将导致托管代码在执行过程中不能自动识别参数类型，进而对该字段内容进行全表扫描以确定参数类型并进行转换，消耗了不必要的查询性能所致。</span></p>
<p><span style="font-family:KaiTi_GB2312; font-size:24px"><br>
</span></p>
<span style="font-family:KaiTi_GB2312; font-size:24px">例如：<br>
</span>
<p><span style="font-family:KaiTi_GB2312; font-size:24px">传递过来的&#20540;是&quot;username&quot;，则size&#20540;为8，&quot;username1&quot;，则size&#20540;为9。那么，不同的size&#20540;会引发什么样的结果呢？且经测试发现，size的&#20540;不同时，会导致数据库的执行计划不会重用，这样就会每次执行sql的时候重新生成新的执行计划，而浪费数据库执行时间。</span></p>
<p><span style="font-family:KaiTi_GB2312; font-size:24px"><br>
</span></p>
<span style="font-family:KaiTi_GB2312; font-size:24px">&nbsp; &nbsp; &nbsp;&nbsp;<img src="30255645606851.png" alt=""><br>
<br>
即，如果参数的size&#20540;不同则会重新创建一个查询计划，但是如果我们设定了他们的size&#20540;都为50，那么每次执行sql的时候就会重用查询计划，提高效率。<br>
<br>
<br>
&nbsp; &nbsp; 以上两点的实现都提到了重用查询计划，那么什么是查询计划呢？什么时候才会重用查询计划？<br>
<br>
</span>
<p><span style="font-family:KaiTi_GB2312; font-size:24px">&nbsp; &nbsp; Sql Server在执行一条查询语句之前都对对它进行“编译”并生成“查询计划”，查询计划告诉Sql Server的查询引擎应该用什么方式进行工作。Sql Server会根据当前它可以收集到的各种信息(例如内存大小，索引的统计等等)把一条查询语句编译成它认为“最优”的查询计划。很显然，得到这样一个查询计划需要消耗CPU资源，而大部分的查询语句每次经过编译所得到的查询计划往往是相同的，因此除非指定了RECOMPILE选项，Sql
 Server在执行查询语句时，会对查询计划进行缓存——也就是说，如果是相同的查询语句，Sql Server只会对它进行一次编译操作，然后在每次执行时对查询计划进行复用。</span></p>
<p><span style="font-family:KaiTi_GB2312; font-size:24px"><br>
</span></p>
<p><span style="font-family:KaiTi_GB2312; font-size:24px"><br>
</span></p>
   
</div><div class="ArcitleLink"><a href='http://blog.csdn.net/hejingyuan6/article/details/8726457'>原文链接</a>