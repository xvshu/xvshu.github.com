<div class="articleLocationOnion"><a href='../../index.html'>首页: </a> &gt; <a href='../index_s.html'>未分类</a> &gt; Android开发学习（11）HttpCient</div><div style="color:blue" align=center>Android开发学习（11）HttpCient</div><br><div id="article_content" class="article_content tracking-ad" data-mod="popu_307" data-dsm="post">
        <div class="markdown_views"><p>承接上篇文章，本篇文章，我们使用httpclient访问后台rest接口，返回数据后进行处理，熟悉最简单的这种监护方式。</p>

<h1 id="httpcient">HttpCient：</h1>

<p>HttpClient是Apache开源组织提供的HTTP网络访问接口（一个开源的项目），从名字上就可以看出，它是一个简单的HTTP客户端（并不是浏览器），可以发送HTTP请求，接受HTTP响应。但是不会缓存服务器的响应，不能执行HTTP页面中签入嵌入的JS代码，自然也不会对页面内容进行任何解析、处理，这些都是需要开发人员来完成的。 <br>
现在Android已经成功集成了HttpClient，所以开发人员在Android项目中可以直接使用HttpClient来想Web站点提交请求以及接受响应，如果使用其他的Java项目，需要引入进相应的Jar包。HttpClient可以在官网上下载。官网链接：<a href="http://hc.apache.org/downloads.cgi" target="_blank">http://hc.apache.org/downloads.cgi</a> <br>
HttpClient其实是一个interface类型，HttpClient封装了对象需要执行的Http请求、身份验证、连接管理和其它特性。既然HttpClient是一个接口，因此无法创建它的实例。从文档上看，HttpClient有三个已知的实现类分别是：AbstractHttpClient, AndroidHttpClient, DefaultHttpClient，会发现有一个专门为Android应用准备的实现类AndroidHttpClient，当然使用常规的DefaultHttpClient也可以实现功能。 <br>
从两个类包所有在位置就可以看出区别，AndroidHttpClient定义在android.net.http.AndroidHttpClient包下，属于Android原生的http访问，而DefaultHttpClient定义在org.apache.http.impl.client.DefaultHttpClient包下，属于对apche项目的支持。而AndroidHttpClient没有公开的构造函数，只能通过静态方法newInstance()方法来获得AndroidHttpClient对象。 <br>
简单来说，用HttpClient发送请求、接收响应都很简单，只需要五大步骤即可：（要牢记）</p>

<ul>
<li>创建代表客户端的HttpClient对象。</li>
<li>创建代表请求的对象，如果需要发送GET请求，则创建HttpGet对象，如果需要发送POST请求，则创建HttpPost对象。注：对于发送请求的参数，GET和POST使用的方式不同，GET方式可以使用拼接字符串的方式，把参数拼接在URL结尾；POST方式需要使用setEntity(HttpEntity entity)方法来设置请求参数。</li>
<li><p>调用HttpClient对象的execute（HttpUriRequest request）发送请求，执行该方法后，将获得服务器返回的HttpResponse对象。服务器发还给我们的数据就在这个HttpResponse相应当中。调用HttpResponse的对应方法获取服务器的响应头、响应内容等。</p></li>
<li><p>检查相应状态是否正常。服务器发给客户端的相应，有一个相应码：相应码为200，正常；相应码为404，客户端错误；相应码为505，服务器端错误。</p></li>
<li>获得相应对象当中的数据</li>
</ul>

<p>DefaultHttpClient： <br>
根据上面的五大步骤，我们就拿DefaultHttpClient举例来访问网络。注意这里有一条原则：在主线程中不能访问网络（在android4.0之后的加入的概念）。</p>

<h1 id="实例">实例</h1>

<p>点击按钮，获取百度首页的文本内容 <br>
先睹为快： <br>
<img src="5601165703996" alt="web_repuest" title=""></p>



<h2 id="布局">布局：</h2>

<p>web_request.xml</p>



<pre class="prettyprint"><code class=" hljs xml"><span class="hljs-pi">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">LinearLayout</span> <span class="hljs-attribute">xmlns:android</span>=<span class="hljs-value">"http://schemas.android.com/apk/res/android"</span>
              <span class="hljs-attribute">android:orientation</span>=<span class="hljs-value">"vertical"</span>
              <span class="hljs-attribute">android:layout_width</span>=<span class="hljs-value">"match_parent"</span>
              <span class="hljs-attribute">android:background</span>=<span class="hljs-value">"#fafcfa"</span>
              <span class="hljs-attribute">android:layout_height</span>=<span class="hljs-value">"match_parent"</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-title">include</span> <span class="hljs-attribute">layout</span>=<span class="hljs-value">"@layout/head"</span> /&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-title">Button
</span>            <span class="hljs-attribute">android:layout_marginTop</span>=<span class="hljs-value">"20dp"</span>
            <span class="hljs-attribute">android:layout_marginLeft</span>=<span class="hljs-value">"20dp"</span>
            <span class="hljs-attribute">android:layout_marginRight</span>=<span class="hljs-value">"20dp"</span>
            <span class="hljs-attribute">android:id</span>=<span class="hljs-value">"@+id/btn_send"</span>
            <span class="hljs-attribute">android:layout_width</span>=<span class="hljs-value">"match_parent"</span>
            <span class="hljs-attribute">android:layout_height</span>=<span class="hljs-value">"wrap_content"</span>
            <span class="hljs-attribute">android:text</span>=<span class="hljs-value">"Send Request"</span> /&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-title">ScrollView
</span>            <span class="hljs-attribute">android:layout_marginTop</span>=<span class="hljs-value">"20dp"</span>
            <span class="hljs-attribute">android:layout_marginLeft</span>=<span class="hljs-value">"22dp"</span>
            <span class="hljs-attribute">android:layout_marginRight</span>=<span class="hljs-value">"22dp"</span>
            <span class="hljs-attribute">android:layout_width</span>=<span class="hljs-value">"match_parent"</span>
            <span class="hljs-attribute">android:layout_height</span>=<span class="hljs-value">"match_parent"</span> &gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-title">TextView
</span>                <span class="hljs-attribute">android:id</span>=<span class="hljs-value">"@+id/TextView_Response"</span>
                <span class="hljs-attribute">android:layout_width</span>=<span class="hljs-value">"match_parent"</span>
                <span class="hljs-attribute">android:layout_height</span>=<span class="hljs-value">"wrap_content"</span>
                <span class="hljs-attribute">android:text</span>=<span class="hljs-value">"Hello android !"</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">ScrollView</span>&gt;</span>



<span class="hljs-tag">&lt;/<span class="hljs-title">LinearLayout</span>&gt;</span></code></pre>

<h2 id="后台">后台：</h2>

<p>android\WebRequestActivity.java</p>



<pre class="prettyprint"><code class=" hljs java"><span class="hljs-keyword">package</span> com.xvshu.android;

<span class="hljs-keyword">import</span> android.app.Activity;
<span class="hljs-keyword">import</span> android.content.ContentValues;
<span class="hljs-keyword">import</span> android.content.Intent;
<span class="hljs-keyword">import</span> android.os.Bundle;
<span class="hljs-keyword">import</span> android.os.Handler;
<span class="hljs-keyword">import</span> android.os.Message;
<span class="hljs-keyword">import</span> android.view.View;
<span class="hljs-keyword">import</span> android.widget.Button;
<span class="hljs-keyword">import</span> android.widget.TextView;
<span class="hljs-keyword">import</span> com.xvshu.android.db.CalcHisrory;
<span class="hljs-keyword">import</span> com.xvshu.android.db.SqliteManage;
<span class="hljs-keyword">import</span> org.apache.http.HttpEntity;
<span class="hljs-keyword">import</span> org.apache.http.HttpResponse;
<span class="hljs-keyword">import</span> org.apache.http.client.HttpClient;
<span class="hljs-keyword">import</span> org.apache.http.client.methods.HttpGet;
<span class="hljs-keyword">import</span> org.apache.http.impl.client.DefaultHttpClient;
<span class="hljs-keyword">import</span> org.apache.http.util.EntityUtils;

<span class="hljs-keyword">import</span> java.util.Stack;


<span class="hljs-javadoc">/**
 * Created by xvshu on 2017/7/26.
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WebRequestActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Activity</span> {</span>

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> SHOW_RESPONSE = <span class="hljs-number">0</span>;

    <span class="hljs-keyword">private</span> Button button_sendRequest;
    <span class="hljs-keyword">private</span> TextView textView_response;

    <span class="hljs-comment">//新建Handler的对象，在这里接收Message，然后更新TextView控件的内容</span>
    <span class="hljs-keyword">private</span> Handler handler = <span class="hljs-keyword">new</span> Handler() {

        <span class="hljs-annotation">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">handleMessage</span>(Message msg) {
            <span class="hljs-keyword">super</span>.handleMessage(msg);
            <span class="hljs-keyword">switch</span> (msg.what) {
                <span class="hljs-keyword">case</span> SHOW_RESPONSE:
                    String response = (String) msg.obj;
                    textView_response.setText(response);
                    <span class="hljs-keyword">break</span>;

                <span class="hljs-keyword">default</span>:
                    <span class="hljs-keyword">break</span>;
            }
        }

    };

    <span class="hljs-annotation">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onCreate</span>(Bundle savedInstanceState) {
        <span class="hljs-keyword">super</span>.onCreate(savedInstanceState);
        setContentView(R.layout.web_request);
        textView_response = (TextView)findViewById(R.id.TextView_Response);
        button_sendRequest = (Button)findViewById(R.id.btn_send);

        button_sendRequest.setOnClickListener(<span class="hljs-keyword">new</span> View.OnClickListener() {

            <span class="hljs-comment">//点击按钮时，执行sendRequestWithHttpClient()方法里面的线程</span>
            <span class="hljs-annotation">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onClick</span>(View v) {
                <span class="hljs-comment">// TODO Auto-generated method stub</span>
                sendRequestWithHttpClient();
            }
        });
    }

    <span class="hljs-comment">//方法：发送网络请求，获取百度首页的数据。在里面开启线程</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">sendRequestWithHttpClient</span>() {
        <span class="hljs-keyword">new</span> Thread(<span class="hljs-keyword">new</span> Runnable() {

            <span class="hljs-annotation">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span>() {
                <span class="hljs-comment">//用HttpClient发送请求，分为五步</span>
                <span class="hljs-comment">//第一步：创建HttpClient对象</span>
                HttpClient httpCient = <span class="hljs-keyword">new</span> DefaultHttpClient();
                <span class="hljs-comment">//第二步：创建代表请求的对象,参数是访问的服务器地址</span>
                HttpGet httpGet = <span class="hljs-keyword">new</span> HttpGet(<span class="hljs-string">"http://www.baidu.com"</span>);

                <span class="hljs-keyword">try</span> {
                    <span class="hljs-comment">//第三步：执行请求，获取服务器发还的相应对象</span>
                    HttpResponse httpResponse = httpCient.execute(httpGet);
                    <span class="hljs-comment">//第四步：检查相应的状态是否正常：检查状态码的值是200表示正常</span>
                    <span class="hljs-keyword">if</span> (httpResponse.getStatusLine().getStatusCode() == <span class="hljs-number">200</span>) {
                        <span class="hljs-comment">//第五步：从相应对象当中取出数据，放到entity当中</span>
                        HttpEntity entity = httpResponse.getEntity();
                        String response = EntityUtils.toString(entity,<span class="hljs-string">"utf-8"</span>);<span class="hljs-comment">//将entity当中的数据转换为字符串</span>

                        <span class="hljs-comment">//在子线程中将Message对象发出去</span>
                        Message message = <span class="hljs-keyword">new</span> Message();
                        message.what = SHOW_RESPONSE;
                        message.obj = response.toString();
                        handler.sendMessage(message);
                    }

                } <span class="hljs-keyword">catch</span> (Exception e) {
                    <span class="hljs-comment">// TODO Auto-generated catch block</span>
                    e.printStackTrace();
                }

            }
        }).start();<span class="hljs-comment">//这个start()方法不要忘记了</span>

    }


}
</code></pre>



<h1 id="总结">总结</h1>

<p>服务器返回的是html代码，一般后台接口返回的是json或者xml数据，我们在后期研究这种数据的传输及解析，应该与web项目类似，引入gson或者其他包解决，json解析的问题，敬请期待。</p></div>
        <script>
            $(function () {
                $('pre.prettyprint code').each(function () {
                    var lines = $(this).text().split('\n').length;
                    var $numbering = $('<ul/>').addClass('pre-numbering').hide();
                    $(this).addClass('has-numbering').parent().append($numbering);
                    for (i = 1; i <= lines; i++) {
                        $numbering.append($('<li/>').text(i));
                    };
                    $numbering.fadeIn(1700);
                });
            });
        </script>
   
</div><div class="ArcitleLink"><a href='http://blog.csdn.net/xvshu/article/details/77101725'>原文链接</a>